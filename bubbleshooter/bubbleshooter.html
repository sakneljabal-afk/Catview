<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لعبة المدفع والفقاعات</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>

<style>
body { margin:0; background:#add8e6; overflow:hidden; }
#game-container { width:100vw; height:100vh; }
#questionBox {
    position:fixed; top:0; width:100%;
    background:rgba(0,0,0,.8);
    color:white; text-align:center; padding:15px; z-index:10;
}
#wrongFeedback {
    position:fixed; inset:0;
    background:rgba(255,0,0,0);
    pointer-events:none;
}
#errorIndicator {
    position:fixed; inset:0;
    display:flex; justify-content:center; align-items:center;
    font-size:8em; opacity:0; pointer-events:none;
}
</style>
</head>

<body>
<div id="wrongFeedback"></div>
<div id="errorIndicator">⛔</div>
<div id="questionBox"></div>
<div id="game-container"></div>

<script>
const QUESTIONS = [
 {question:"الكوكب الأحمر؟", options:["الزهرة","المريخ","المشتري"], correctAnswer:"المريخ"},
 {question:"عدد أرجل القط؟", options:["٢","٤","٦"], correctAnswer:"٤"}
];

const config = {
 type: Phaser.AUTO,
 parent:'game-container',
 width:800,
 height:1200,
 physics:{
   default:'arcade',
   arcade:{ gravity:{y:0}, debug:false }
 },
 scene:{ preload, create }
};

new Phaser.Game(config);

let cannon, bubblesGroup;
let questionIndex = 0;

function preload(){
 this.load.image('cannon','assets/cannon.png');
 this.load.image('shoot','assets/shoot.png');
 this.load.image('bubble','assets/bubble1.png');
}

function create(){
 const {width,height} = this.scale;

 cannon = this.add.sprite(width/2, height*0.9,'cannon').setScale(0.4);

 bubblesGroup = this.physics.add.group();

 this.physics.add.overlap(
   bubblesGroup,
   this.physics.add.group(),
   ()=>{},
   null,
   this
 );

 this.input.on('pointermove', p=>{
   cannon.x = Phaser.Math.Clamp(p.x,50,width-50);
 });

 this.input.on('pointerdown', ()=>{
   fire(this);
 });

 showQuestion(this);
}

function fire(scene){
 // ✅ إنشاء القذيفة فعليًا
 const shot = scene.physics.add.sprite(
   cannon.x,
   cannon.y - 60,
   'shoot'
 );

 shot.setScale(0.25);
 shot.setVelocityY(-900);

 // ✅ جسم تصادم مظبوط
 const r = shot.displayWidth/2;
 shot.body.setCircle(r);
 shot.body.setOffset(
   shot.width/2 - r,
   shot.height/2 - r
 );

 // ✅ تصادم مع الفقاعات
 scene.physics.add.overlap(shot, bubblesGroup, (s,b)=>{
   s.destroy();
   b.destroy();
 }, null, scene);

 // حذف القذيفة خارج الشاشة
 scene.time.delayedCall(1500, ()=>shot.destroy());
}

function showQuestion(scene){
 document.getElementById('questionBox').innerHTML =
 `<h3>${QUESTIONS[questionIndex].question}</h3>`;

 bubblesGroup.clear(true,true);

 QUESTIONS[questionIndex].options.forEach((opt,i)=>{
   const b = bubblesGroup.create(
     150 + i*250,
     300,
     'bubble'
   ).setScale(0.2);

   b.setVelocity(
     Phaser.Math.Between(-100,100),
     Phaser.Math.Between(50,150)
   );
   b.setBounce(1);
   b.setCollideWorldBounds(true);
 });
}
</script>
</body>
</html>
