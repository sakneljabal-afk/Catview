<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø¯ÙØ¹ ÙˆØ§Ù„ÙÙ‚Ø§Ø¹Ø§Øª</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>

<style>
/* === ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ù…Ø¶Ø§ÙØ©) === */
.summary-overlay {
    position: fixed; 
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.95);
    display: none; 
    justify-content: center;
    align-items: center;
    z-index: 5000;
}

.summary-content {
    background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%);
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.9);
    border: 4px solid #f72585;
    width: 95%;
    max-width: 750px;
    max-height: 95vh;
    display: flex;
    flex-direction: column;
    text-align: center;
}

.scrollable-review {
    overflow-y: auto;
    max-height: calc(95vh - 120px);
    margin: 5px 0;
    padding: 8px;
    border: 1px dashed #4cc9f0;
    text-align: right;
    line-height: 1.8;
    font-size: 22px;
    white-space: pre-wrap;
    color: #fff;
}

.summary-content h2 {
    font-size: 32px;
    color: #4cc9f0;
    margin-bottom: 5px;
}

.summary-content p {
    font-size: 24px;
    color: #2ecc71;
    font-weight: bold;
    margin-bottom: 5px;
}

.summary-content h3 {
    font-size: 20px;
    color: #fff;
    border-bottom: 1px solid #fff;
    padding-bottom: 3px;
}

.modal-btn {
    display: block;
    width: 80%;
    margin: 20px auto 0;
    padding: 15px 20px;
    background-color: #f72585;
    color: #fff;
    border: none;
    border-radius: 10px;
    font-size: 1.4rem;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.1s;
}

.modal-btn:hover {
    background-color: #d11c70;
}

/* === ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø© === */
body {
    margin: 0;
    background: linear-gradient(135deg, #FFD580 0%, #FFB347 100%);
    font-family: 'Segoe UI', 'Tajawal', Tahoma, Geneva, Verdana, sans-serif;
    touch-action: none;  
    overflow: hidden;  
    height: 100vh;
    display: flex;
    flex-direction: column;
}

/* === Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© (Ø§Ù„Ø³Ø¤Ø§Ù„) === */
header {
    background: #2c3e50;  
    color: #fff;
    text-align: center;
    padding: 10px 15px;
    height: 40vh; 
    min-height: 40vh;
    max-height: 40vh; 
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    z-index: 10;
    overflow-y: hidden; 
}

header h3 {
    margin: 5px 0 5px 0;
    font-size: clamp(1.6rem, 5vw, 2.2rem);  
    color: #FFD700;
    font-weight: bold;
    line-height: 1.3;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.answers {
    flex-grow: 1;Â 
    display: flex;
    flex-direction: column;
    gap: 5px; 
    justify-content: flex-start;Â 
    text-align: right;Â Â 
    padding: 5px 10px; 
    margin-top: 5px; 
    overflow-y: hidden; 
}

.answers span {
    display: block;Â Â 
    font-size: clamp(1.2rem, 4vw, 1.8rem);Â Â 
    margin: 0; 
    padding: 6px 10px;
    border-bottom: 1px solid rgba(255,255,255,0.2); 
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    font-weight: 600;
    line-height: 1.4;
    white-space: normal; 
    height: auto; 
    overflow: hidden;Â 
    text-overflow: ellipsis; 
}

.answers span:last-child {
    border-bottom: none;
}

/* === Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© (Main) === */
main {
    flex: 1;  
    height: 60vh;
    max-height: 60vh;
    min-height: 60vh;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    padding: 5px;
}

/* Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„Ø¹Ø¨Ø© */
#game-frame {
    width: 95vw;  
    height: 100%; 
    flex-grow: 1; 
    max-width: 700px;  
    background: #E8F5E9;  
    border: 10px solid #FF8C42;
    border-radius: 20px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 0 20px rgba(0,0,0,0.2);
}

#game-container {
    width: 100%;
    height: 100%;
}

/* === Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„Ø®Ø·Ø£ === */
#wrongFlash {
    position: fixed;
    inset: 0;
    background: rgba(255, 0, 0, 0);
    pointer-events: none;
    transition: background 0.2s;
    z-index: 999;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø·Ø£ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
#errorMark {
    font-size: 10rem;
    color: white;
    background: rgba(231, 76, 60, 0.9);
    width: 180px;
    height: 180px;
    border-radius: 50%;
    display: none;  
    justify-content: center;
    align-items: center;
    box-shadow: 0 0 30px rgba(0,0,0,0.4);
    border: 8px solid white;
    font-weight: bold;
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù„Ù…Ø³ */
@media (hover: hover) {
    .answers span:hover {
        background-color: rgba(255, 255, 255, 0.2);
        transform: scale(1.02);
        transition: transform 0.2s;
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
@media (max-width: 480px) {
    header {
        height: 40vh;
        min-height: 40vh;  
        padding: 10px 8px;
    }
    
    header h3 {
        font-size: clamp(1.4rem, 4.5vw, 2.0rem);
    }
    
    .answers span {
        font-size: clamp(1.1rem, 3.5vw, 1.6rem);
        padding: 5px 8px;
    }

    main {
        height: 60vh;
        max-height: 60vh;
        min-height: 60vh;
    }
    
    #game-frame {
        height: 100%;
        flex-grow: 1;
        border-width: 8px;
    }
}

/* === ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø´Ø§Ø´Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… === */
#introScreen {
    position: fixed;
    inset: 0;
    background: linear-gradient(135deg, #FFD580 0%, #FFB347 100%); 
    z-index: 1000; 
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 20px;
    color: #2c3e50;
    text-align: center;
    transition: opacity 0.5s ease;
    opacity: 1;
}

#introScreen.hidden {
    opacity: 0;
    pointer-events: none;
}

.intro-content {
    background: #fff;
    color: #2c3e50;
    padding: 30px; 
    border-radius: 15px;
    max-width: 500px;
    width: 90%;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    max-height: 90vh; 
    overflow-y: auto; 
    box-sizing: border-box; 
}

.intro-content h2 {
    color: #FF8C42;
    font-size: 2.5rem;
    margin-top: 0;
    border-bottom: 3px solid #FF8C42;
    padding-bottom: 10px;
    margin-bottom: 20px;
}

.intro-content p {
    font-size: 1.1rem; 
    line-height: 1.6;
    margin-bottom: 15px;
    text-align: center;
}

.intro-content h3 {
    color: #2c3e50;
    font-size: 1.3rem;
    margin-top: 20px;
}

.intro-content ul {
    list-style-type: disc;
    padding-right: 20px;
    text-align: right;
}

.intro-content ul li {
    background: #f8f8f8;
    padding: 8px;
    margin-bottom: 5px;
    border-radius: 5px;
    font-weight: 500;
    font-size: 1rem;
    border-right: 3px solid #2c3e50;
}

#startButton {
    background: #2c3e50;
    color: white;
    border: none;
    padding: 15px 40px;
    font-size: 1.5rem;
    font-weight: bold;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 30px;
    box-shadow: 0 5px 0 #1c2833;
    transition: all 0.1s ease;
}

#startButton:active {
    transform: translateY(5px);
    box-shadow: 0 0 0 #1c2833;
}
</style>
</head>

<body>

<div id="introScreen">
    <div class="intro-content">
        <h1>ğŸš€ Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø¯ÙØ¹ ÙˆØ§Ù„ÙÙ‚Ø§Ø¹Ø§Øª</h1>
        <h3>ğŸ¯ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨</h3>
        <ul>
            <li>**Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø£ÙˆÙ„Ø§Ù‹:** Ø§Ù‚Ø±Ø£ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ©.</li>
            <li>**Ø§Ù„ØªØµÙˆÙŠØ¨:** Ø­Ø±Ù‘Ùƒ Ø§Ù„Ù…Ø¤Ø´Ø± (Ø¨Ø§Ù„Ù„Ù…Ø³) Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø¯ÙØ¹ Ù†Ø­Ùˆ Ø§Ù„ÙÙ‚Ø§Ø¹Ø© Ø§Ù„ØªÙŠ ØªØ­Ù…Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©.</li>
            <li>**Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚:** Ø§Ø¶ØºØ· Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø¥Ø·Ù„Ø§Ù‚ ÙˆØªÙØ¬ÙŠØ± Ø§Ù„ÙÙ‚Ø§Ø¹Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©.</li>
        </ul>
        <button id="startButton">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¢Ù†!</button>
    </div>
</div>
<header id="questionHeader"></header>

<main>
    <section id="game-frame">
        <div id="score-display" style="position: absolute; top: 10px; left: 10px; background: rgba(0, 0, 0, 0.7); color: #fff; padding: 8px 12px; border-radius: 8px; font-size: 1.2rem; border: 2px solid #FFD700; z-index: 100;">
            Ø§Ù„Ù†Ù‚Ø§Ø·: <span>0</span>
        </div>
        <div id="game-container"></div>
    </section>
</main>

<div id="wrongFlash">
    <div id="errorMark">âœ–</div>
</div>

<div class="summary-overlay" id="summaryOverlay">
    <div class="summary-content">
        <h2 id="summaryTitle"></h2>
        <p id="summaryScore"></p>
        <h3>Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©:</h3>
        <div class="scrollable-review" id="scrollableReview">
        </div>
        <button class="modal-btn" id="restartBtn">ğŸ‘ Ø­Ø³Ù†Ø§Ù‹ØŒ Ø£Ø¹Ø¯ Ø§Ù„Ù„Ø¹Ø¨</button>
    </div>
</div>
<script>
/* ======================
    0. Ø¯Ø§Ù„Ø© Ø®Ù„Ø· Ø§Ù„Ù…ØµÙÙˆÙØ© (Shuffle Function)
====================== */
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

/* ======================
    1. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ø£Ø³Ø¦Ù„Ø©) - 7 Ø£Ø³Ø¦Ù„Ø©
====================== */
const QUESTIONS = [
    { "id": 1, "q": "ØªØ¹ÙŠØ´ Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ø§Ù†Ø¬Ø±ÙˆÙ ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ù…Ø§Ù„Ø­Ø©ØŒ ÙˆÙ„Ù‡Ø°Ø§ ØªÙ…ØªÙ„Ùƒ ØªÙƒÙŠÙØ§Ù‹ ØªØ±ÙƒÙŠØ¨ÙŠØ§Ù‹ Ù‡Ùˆ:", "o": [ "Ø£ÙˆØ±Ø§Ù‚ Ø¹Ø±ÙŠØ¶Ø© ØªØ·ÙÙˆ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø§Ø¡", "Ø¬Ø°ÙˆØ± Ù‚ØµÙŠØ±Ø© Ø¶Ø¹ÙŠÙØ©", "Ø¬Ø°ÙˆØ± Ø·ÙˆÙŠÙ„Ø© ÙˆÙ‚ÙˆÙŠØ© Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„Ø£Ù…ÙˆØ§Ø¬" ], "a": 2 },
    { "id": 2, "q": "Ù…Ø§ Ù‡ÙŠ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¬Ø°ÙˆØ± Ø§Ù„Ø·ÙˆÙŠÙ„Ø© ÙˆØ§Ù„Ù‚ÙˆÙŠØ© Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ø§Ù†Ø¬Ø±ÙˆÙØŸ", "o": [ "ØªØ®Ø²ÙŠÙ† ÙƒÙ…ÙŠØ§Øª ÙƒØ¨ÙŠØ±Ø© Ù…Ù† Ø§Ù„Ù…Ø§Ø¡", "Ø§Ù…ØªØµØ§Øµ Ø§Ù„Ø¶ÙˆØ¡ Ù…Ù† Ø³Ø·Ø­ Ø§Ù„Ù…Ø§Ø¡", "Ø§Ù„ØµÙ…ÙˆØ¯ Ø£Ù…Ø§Ù… Ø§Ù„Ø£Ù…ÙˆØ§Ø¬ Ø§Ù„Ù‚ÙˆÙŠØ©" ], "a": 2 },
    { "id": 3, "q": "Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªÙŠ ÙŠÙ†Ù…Ùˆ ÙÙŠÙ‡Ø§ Ù†Ø¨Ø§Øª Ø²Ù†Ø¨Ù‚ Ø§Ù„Ù…Ø§Ø¡ (Ø§Ù„Ù„ÙˆØªØ³) Ù‡ÙŠ Ø§Ù„Ù…Ø³ØªÙ†Ù‚Ø¹Ø§ØªØŒ ÙˆØªØªÙ…ÙŠØ² Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø¨Ù€:", "o": [ "Ù…ÙŠØ§Ù‡ Ù…Ø§Ù„Ø­Ø© ÙˆØ£Ù…ÙˆØ§Ø¬ Ù‚ÙˆÙŠØ©", "ØªØ±Ø¨Ø© Ø¬Ø§ÙØ© ÙˆØ¯Ø±Ø¬Ø§Øª Ø­Ø±Ø§Ø±Ø© Ù…Ø±ØªÙØ¹Ø©", "Ù…ÙŠØ§Ù‡ Ø±Ø§ÙƒØ¯Ø© ÙˆÙƒÙ…ÙŠØ§Øª ÙƒØ¨ÙŠØ±Ø© Ù…Ù† Ø§Ù„Ø·ÙŠÙ†" ], "a": 2 },
    { "id": 4, "q": "ÙŠÙ…ØªÙ„Ùƒ Ù†Ø¨Ø§Øª Ø²Ù†Ø¨Ù‚ Ø§Ù„Ù…Ø§Ø¡ Ø£ÙˆØ±Ø§Ù‚Ø§Ù‹ Ø¹Ø±ÙŠØ¶Ø© ØªØ·ÙÙˆ Ø¹Ù„Ù‰ Ø³Ø·Ø­ Ø§Ù„Ù…Ø§Ø¡ØŒ ÙˆÙ‡Ø°Ø§ Ø§Ù„ØªÙƒÙŠÙ Ø§Ù„ØªØ±ÙƒÙŠØ¨ÙŠ ÙŠØ³Ø§Ø¹Ø¯Ù‡ Ø¹Ù„Ù‰:", "o": [ "Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„ØªÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø§Ø¦ÙŠØ©", "ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø§Ø¡ Ø§Ù„Ø²Ø§Ø¦Ø¯", "Ø§Ù…ØªØµØ§Øµ Ù‚Ø¯Ø± ÙƒØ¨ÙŠØ± Ù…Ù† Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³" ], "a": 2 },
    { "id": 5, "q": "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªÙŠ ØªØªÙƒÙŠÙ Ø´Ø¬Ø±Ø© Ø§Ù„ØµÙ†ÙˆØ¨Ø± Ù„Ù„Ø¹ÙŠØ´ ÙÙŠÙ‡Ø§ØŸ", "o": [ "Ø§Ù„Ù…Ø³ØªÙ†Ù‚Ø¹Ø§Øª Ø§Ù„Ù…Ø§Ø¦ÙŠØ©", "Ø§Ù„ØµØ­Ø§Ø±ÙŠ Ø§Ù„Ø¬Ø§ÙØ©", "Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø«Ù„Ø¬ÙŠØ© Ø´Ø¯ÙŠØ¯Ø© Ø§Ù„Ø¨Ø±ÙˆØ¯Ø©" ], "a": 2 },
    { "id": 6, "q": "ØªÙ†Ù…Ùˆ Ø´Ø¬Ø±Ø© Ø§Ù„ØµÙ†ÙˆØ¨Ø± Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ù…Ø«Ù„Ø«ØŒ ÙˆÙ‡Ø°Ø§ Ø§Ù„ØªÙƒÙŠÙ Ø§Ù„ØªØ±ÙƒÙŠØ¨ÙŠ ÙŠØ³Ù…Ø­ Ø¨Ù€:", "o": [ "Ø¬Ø°Ø¨ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³", "Ø²ÙŠØ§Ø¯Ø© Ø³Ø±Ø¹Ø© Ù†Ù…Ùˆ Ø§Ù„Ø£ØºØµØ§Ù†", "Ø³Ù‡ÙˆÙ„Ø© Ø§Ù†Ø²Ù„Ø§Ù‚ Ø§Ù„Ø«Ù„Ø¬ Ù…Ù† Ø¹Ù„ÙŠÙ‡Ø§ Ø¯ÙˆÙ† ÙƒØ³Ø± Ø§Ù„ÙØ±ÙˆØ¹" ], "a": 2 },
    { "id": 7, "q": "Ø£ÙŠ Ù…Ù† Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© ÙŠÙ…ØªÙ„Ùƒ ØªÙƒÙŠÙØ§Ù‹ Ø³Ù„ÙˆÙƒÙŠØ§Ù‹ Ù„Ù„Ù‡Ø±Ø¨ Ù…Ù† Ø§Ù„Ø­Ø±Ø§Ø±Ø©ØŸ", "o": [ "Ø£Ø°Ù† Ø·ÙˆÙŠÙ„Ø© Ù„ØªØ¨Ø±ÙŠØ¯ Ø§Ù„Ø¬Ø³Ù…", "ÙØ±Ø´ Ø³Ù…ÙŠÙƒ", "Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¬Ø­ÙˆØ± Ù†Ù‡Ø§Ø±Ø§Ù‹" ], "a": 2 } 
];

/* ======================
    2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© (Phaser)
====================== */
const config = {
    type: Phaser.AUTO,
    parent: 'game-container',
    width: 600,
    height: 800,
    backgroundColor: '#E8F5E9',
    scale: {
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH
    },
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 0 },
            debug: false
        }
    },
    scene: { preload, create, update }
};

const game = new Phaser.Game(config);

/* ======================
    3. Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© (Ø§Ù„Ù…ÙØ¹Ø¯Ù„Ø©)
====================== */
let cannon, bubbles, invisibleWall;
let currentQ = 0;
let canShoot = true;
let missedShots = 0;
let shootAngle = -90; 
let aimLine; 

const BUBBLE_IMG_SIZE = 300;
const totalQuestions = QUESTIONS.length; 
let score = 0; 
let wrongQuestions = []; 
let gameFinished = false; 
let scoreDisplay; 

// Ù‚Ø§Ø¦Ù…Ø© Ù„Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªÙŠ ØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ù†Ù‚Ø§Ø·Ù‡Ø§ 
let scoredQuestions = []; 
// Ù‚Ø§Ø¦Ù…Ø© Ù„Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªÙŠ ØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„ÙŠÙ‡Ø§ Ø®Ø·Ø£Ù‹ ÙˆÙ„Ùˆ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© (Ù…Ù…Ø§ ÙŠÙ…Ù†Ø¹ Ø§Ø­ØªØ³Ø§Ø¨ Ù†Ù‚Ø§Ø·Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
let penalizedQuestions = [];


/* ======================
    * Ù…Ù†Ø·Ù‚ Ø´Ø§Ø´Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… (Intro Screen Logic)
====================== */

// Ø¯Ø§Ù„Ø© Ù„Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
function hideIntroScreen() {
    const introScreen = document.getElementById('introScreen');
    introScreen.classList.add('hidden');
    // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ø¹Ø¨Ø© Phaser
    game.scene.start('default');
}

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ Ù„Ø²Ø± "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨"
document.getElementById('startButton').addEventListener('click', hideIntroScreen);


/* ======================
    4. Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Preload)
====================== */
function preload(){
    this.load.image('cannon','bubbleassets/cannon.png');
    this.load.image('shoot','bubbleassets/shoot.png');
    this.load.image('bubble1','bubbleassets/bubble1.png');
    this.load.image('bubble2','bubbleassets/bubble2.png');
    this.load.image('bubble3','bubbleassets/bubble3.png');
    this.load.audio('correct','../assets/correct.mp3');
    this.load.audio('wrong','../assets/wrong.mp3');
    this.load.audio('win','../assets/win.mp3');
}

/* ======================
    5. Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ (Create)
====================== */
function create(){
    // ğŸŒŸ Ø®Ù„Ø· Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
    shuffleArray(QUESTIONS);

    const width = this.scale.width;
    const height = this.scale.height;

    // â¬‡ï¸ Ø¥Ø¶Ø§ÙØ© Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© (ÙÙŠ DOM) â¬‡ï¸
    scoreDisplay = document.getElementById('score-display').querySelector('span');
    scoreDisplay.textContent = '0';
    
    // â¬‡ï¸ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© â¬‡ï¸
    if (currentQ >= totalQuestions && wrongQuestions.length === 0) {
        gameOver(this, true); 
        return;
    }
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ØµÙˆØ§Øª
    this.correctSound = this.sound.add('correct');
    this.wrongSound = this.sound.add('wrong');
    this.winSound = this.sound.add('win');

    this.physics.world.setBounds(0, 0, width, height);

    invisibleWall = this.add.rectangle(width/2, height * 0.55, width, 20, 0x000000, 0);
    this.physics.add.existing(invisibleWall, true);

    const cannonHeight = height * 0.10;
    const cannonScale = cannonHeight / 300;

    cannon = this.add.sprite(width/2, height * 0.8, 'cannon') 
        .setScale(cannonScale)
        .setDepth(1);

    bubbles = this.physics.add.group({
        collideWorldBounds: true,
        bounceX: 1,
        bounceY: 1
    });
    this.physics.add.collider(bubbles, invisibleWall);
    
    aimLine = this.add.graphics({ lineStyle: { width: 4, color: 0xFF5722, alpha: 0.8 } }).setDepth(2);

    this.input.on('pointermove', (pointer) => {
        updateAimLine(this, pointer);
    });

    this.input.on('pointerdown', (pointer) => {
        if (canShoot) updateAimLine(this, pointer);
    });

    this.input.on('pointerup', () => {
        if (canShoot) fire(this);
    });

    showQuestion(this);
}

/* ======================
    6. Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªÙ…Ø± (Update)
====================== */
function update() {
    bubbles.children.iterate((b) => {
        if (b) b.rotation += 0.005;
    });
}


/* ======================
    * Ø¯Ø§Ù„Ø© Ø±Ø³Ù… Ø®Ø· Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
====================== */
function updateAimLine(scene, pointer) {
    // Ù…ÙˆÙ‚Ø¹ Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù…Ù‚Ø°ÙˆÙ
    const cannonX = cannon.x;
    const cannonY = cannon.y - cannon.displayHeight / 2;

    const pointerX = pointer.x;
    const pointerY = pointer.y;

    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¯ÙØ¹ ÙˆÙ†Ù‚Ø·Ø© Ø§Ù„Ù„Ù…Ø³
    shootAngle = Phaser.Math.Angle.Between(cannonX, cannonY, pointerX, pointerY);

    // Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ Ù„Ù„Ø£Ø¹Ù„Ù‰ ÙÙ‚Ø·
    if (shootAngle > 0) {
        if (pointerX < cannonX) {
             shootAngle = Phaser.Math.DegToRad(-179); // Ù„Ù„ÙŠØ³Ø§Ø±
        } else {
             shootAngle = Phaser.Math.DegToRad(-1); // Ù„Ù„ÙŠÙ…ÙŠÙ†
        }
    }

    // Ø±Ø³Ù… Ø§Ù„Ø®Ø· Ø§Ù„Ù…Ù†Ù‚Ø·
    aimLine.clear();
    aimLine.lineStyle(4, 0xFF5722, 0.8);

    // Ø·ÙˆÙ„ ÙƒØ¨ÙŠØ± Ù„Ù„Ø®Ø· Ù„ÙŠÙ…ØªØ¯ Ø­ØªÙ‰ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ø§Ø´Ø©
    const lineLength = 1000;
    const endX = cannonX + Math.cos(shootAngle) * lineLength;
    const endY = cannonY + Math.sin(shootAngle) * lineLength;

    aimLine.beginPath();
    aimLine.moveTo(cannonX, cannonY);
    aimLine.lineTo(endX, endY);
    aimLine.strokePath();
}

/* ======================
    7. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ (Fire)
====================== */
function fire(scene){
    canShoot = false;
    aimLine.clear(); // Ø¥Ø®ÙØ§Ø¡ Ø®Ø· Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ ÙÙˆØ± Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚

    const width = scene.scale.width;
    const shotScale = (width * 0.12) / 300;

    const shot = scene.physics.add.sprite(
        cannon.x,
        cannon.y - cannon.displayHeight/1.5,
        'shoot'
    ).setScale(shotScale);

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³Ø±Ø¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø©
    const speed = 800; // Ø³Ø±Ø¹Ø© Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚
    const velocityX = Math.cos(shootAngle) * speed;
    const velocityY = Math.sin(shootAngle) * speed;
    shot.setVelocity(velocityX, velocityY);

    scene.physics.add.overlap(shot, bubbles, (s, b) => {
        s.destroy();
        missedShots = 0;
        bubbleHit(scene, b);
    });

    shot.setCollideWorldBounds(true);
    shot.body.onWorldBounds = true;

    shot.body.world.on('worldbounds', (body) => {
        if (body.gameObject === shot) {
            shot.destroy();
            missedShots++;
            if (missedShots >= 2) {
                missedShots = 0;
                showQuestion(scene);
            }
        }
    });

    scene.time.delayedCall(1200, () => { if(shot.active) shot.destroy(); });

    scene.time.delayedCall(800, () => { canShoot = true; });
}

/* ======================
    8. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¥ØµØ§Ø¨Ø© (Hit) - ğŸ› ï¸ ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© ØªÙƒØ±Ø§Ø± Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ğŸ› ï¸
====================== */
/* ======================
    8. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¥ØµØ§Ø¨Ø© (Hit) - ğŸ› ï¸ ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ø¯Ø§Ø¦Ù…Ø§Ù‹ ğŸ› ï¸
====================== */
function bubbleHit(scene, bubble){
    const isCorrect = bubble.getData('isCorrect');
    const questionId = bubble.getData('questionId'); 
    bubble.destroy();

    // Ù†Ø¬Ø¯ Ø§Ù„ÙÙ‡Ø±Ø³ Ø³ÙˆØ§Ø¡ ÙƒØ§Ù† Ø³Ø¤Ø§Ù„ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ù… Ù„Ø§ (Ù„Ù… ÙŠØ¹Ø¯ Ù…Ù‡Ù…Ù‹Ø§ØŒ Ù„ÙƒÙ† Ù†ØªØ±ÙƒÙ‡ Ù„Ù„ÙˆØ¶ÙˆØ­)
    const wrongIndex = wrongQuestions.findIndex(q => q.id === questionId); 
    const isReviewQuestion = wrongIndex > -1;

    if(isCorrect){
        scene.correctSound.play();
        
        // â¬‡ï¸ Ù…Ù†Ø·Ù‚ Ø§Ù„Ù†Ù‚Ø§Ø· (Ø«Ø§Ø¨Øª) â¬‡ï¸
        const isPenalized = penalizedQuestions.includes(questionId);
        const alreadyScored = scoredQuestions.includes(questionId);
        
        if (!isPenalized && !alreadyScored) { 
            score += 10;
            scoreDisplay.textContent = score; 
            scoredQuestions.push(questionId); 
        }

        // â¬‡ï¸ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ (Ø§Ù„Ø¬Ø¯ÙŠØ¯) â¬‡ï¸
        if (isReviewQuestion) {
            // Ø§Ù„Ø­Ø§Ù„Ø© 1: Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„ Ù…Ø±Ø§Ø¬Ø¹Ø© (Ù†ÙØ²ÙŠÙ„Ù‡)
            wrongQuestions.splice(wrongIndex, 1);
            
        } else {
            // Ø§Ù„Ø­Ø§Ù„Ø© 2: Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ù†Ù†ØªÙ‚Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©)
            currentQ++;
        }
        
    } else {
        // â¬‡ï¸ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø®Ø·Ø£ (ÙƒÙ…Ø§ Ù‡Ùˆ) â¬‡ï¸
        const flash = document.getElementById('wrongFlash');
        const mark = document.getElementById('errorMark');

        scene.wrongSound.play();
        flash.style.background = 'rgba(255,0,0,0.4)';
        mark.style.display = 'flex';
        setTimeout(() => {
            flash.style.background = 'rgba(255,0,0,0)';
            mark.style.display = 'none';
        }, 400);

        let currentQuestion;
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯)
        if (isReviewQuestion) {
            currentQuestion = wrongQuestions[0]; // Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£ÙˆÙ„
        } else if (currentQ < totalQuestions) {
            currentQuestion = QUESTIONS[currentQ]; // Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        } else {
             return; 
        }

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø© (ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø·)
        if (currentQuestion && !penalizedQuestions.includes(currentQuestion.id)) {
            penalizedQuestions.push(currentQuestion.id);
        }

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹)
        if (currentQuestion && !wrongQuestions.some(q => q.id === currentQuestion.id)) {
             wrongQuestions.push({
                 id: currentQuestion.id,
                 q: currentQuestion.q,
                 a: currentQuestion.a,
                 o: currentQuestion.o
             });
        }
        
        // â¬‡ï¸ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ (Ø§Ù„Ø¬Ø¯ÙŠØ¯): Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø®Ø·Ø£ â¬‡ï¸
        if (!isReviewQuestion) {
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø®Ø·Ø£ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ØŒ Ù†Ø²ÙŠØ¯ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
            currentQ++;
        }
        // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø®Ø·Ø£ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„ Ù…Ø±Ø§Ø¬Ø¹Ø©ØŒ ÙØ¥Ù†Ù‡ ÙŠØ¨Ù‚Ù‰ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø­ÙŠÙ† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„ÙŠÙ‡ ØµØ­ÙŠØ­Ø§Ù‹ØŒ 
        // Ù„ÙƒÙ†Ù†Ø§ Ù†Ù†ØªÙ‚Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… Ù†ÙƒÙ† ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©. 
    }
    
    // â¬‡ï¸ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„Ù…ÙˆØ­Ø¯ Ø¨Ø¹Ø¯ 500 Ù…Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© â¬‡ï¸
    scene.time.delayedCall(500, () => {
         // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©: Ù‡Ù„ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© ÙˆÙ‡Ù„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙØ§Ø±ØºØ©ØŸ
        if (currentQ >= totalQuestions && wrongQuestions.length === 0) {
             gameOver(scene, true); 
        } else {
             // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ: Ø³ÙŠØ¹Ø·ÙŠ showQuestion Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
             showQuestion(scene);
        }
    });
}
/* ======================
    9. Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙÙ‚Ø§Ø¹Ø§Øª 
====================== */
function showQuestion(scene){
    if (gameFinished) return;

    let q;
    
    // â¬‡ï¸ Ø£ÙˆÙ„Ø§Ù‹: Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© â¬‡ï¸
    if (wrongQuestions.length > 0) {
        q = wrongQuestions[0]; 
    } 
    // Ø«Ø§Ù†ÙŠØ§Ù‹: Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ø¨Ø§Ù„ØªØ³Ù„Ø³Ù„
    else if (currentQ < totalQuestions) {
        q = QUESTIONS[currentQ];
    } 
    // Ø«Ø§Ù„Ø«Ø§Ù‹: Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    else {
        gameOver(scene, true);
        return;
    }

    // ğŸŒŸ 1. Ù†Ø­ÙØ¸ Ù†Øµ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø£ØµÙ„ÙŠ
    const correctOptionText = q.o[q.a]; 
    
    // ğŸŒŸ Ù†Ø³ØªØ®Ø¯Ù… .slice() Ù„Ø¶Ù…Ø§Ù† Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ© Ù‚Ø¨Ù„ Ø®Ù„Ø·Ù‡Ø§.
    const optionsToShuffle = q.o.slice(); 
    
    // Ù†Ø®Ù„Ø· Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
    const shuffledOptions = shuffleArray(optionsToShuffle); 

    // ğŸŒŸ 2. Ø¥ÙŠØ¬Ø§Ø¯ Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø®Ù„Ø·
    const newCorrectIndex = shuffledOptions.indexOf(correctOptionText);

    // Ø£Ù„ÙˆØ§Ù† Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
    const colors = ['#81d4fa', '#a5d6a7', '#ffe082'];

    // Ø¨Ù†Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ÙÙŠ Ø§Ù„Ù€ HTML (ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ)
    let answersHtml = '';
    for(let i=0; i<shuffledOptions.length; i++) {
        answersHtml += `<span style="color:${colors[i]}">${i + 1}: ${shuffledOptions[i]}</span>`;
    }

    document.getElementById('questionHeader').innerHTML = `
        <h3>${q.q}</h3>
        <div class="answers">
            ${answersHtml}
        </div>
    `;

    bubbles.clear(true, true);

    const width = scene.scale.width;
    const height = scene.scale.height;

    const bubbleTargetSize = width * 0.18;
    const bubbleScale = bubbleTargetSize / BUBBLE_IMG_SIZE;

    const positions = [0.2, 0.5, 0.8]; // Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ÙÙ‚Ø§Ø¹Ø§Øª

    for(let i=0; i<3; i++){
        const b = bubbles.create(
            width * positions[i],
            height * 0.3,
            'bubble' + (i+1)
        ).setScale(bubbleScale);

        b.setCircle(130 * (bubbleScale / (width * 0.22 / BUBBLE_IMG_SIZE)));

        // ğŸŒŸ ØªØ®Ø²ÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ùˆ Question ID ÙÙŠ Ø§Ù„ÙÙ‚Ø§Ø¹Ø©
        b.setData('isCorrect', i === newCorrectIndex);
        b.setData('questionId', q.id); 
        
        b.setVelocity(
            Phaser.Math.Between(-50, 50),
            Phaser.Math.Between(-30, 30)
        );

        b.setBounce(1);
        b.setCollideWorldBounds(true);
    }
}

/* ======================
    10. ÙˆØ¸Ø§Ø¦Ù Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØ§Ù„Ù…Ù„Ø®Øµ - Ù…Ø¶Ø§ÙØ©
====================== */

// â¬‡ï¸ Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ù„Ø¹Ø¨Ø© â¬‡ï¸
function showSummaryBox(finalScore, title, reviewContent) {
    const summaryOverlay = document.getElementById('summaryOverlay');
    const summaryTitle = document.getElementById('summaryTitle');
    const summaryScore = document.getElementById('summaryScore');
    const scrollableReview = document.getElementById('scrollableReview');
    const restartBtn = document.getElementById('restartBtn');

    // 1. Ù…Ù„Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
    summaryTitle.textContent = title;
    // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù†Ù‚Ø§Ø· Ù„ÙŠØ¹ÙƒØ³ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©: 7 Ø£Ø³Ø¦Ù„Ø© * 10 Ù†Ù‚Ø§Ø· = 70
    summaryScore.textContent = `Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø­ØªØ³Ø¨Ø©: ${finalScore} / ${QUESTIONS.length * 10}`;

    scrollableReview.innerHTML = reviewContent;

    // 2. Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø¥Ø¹Ø§Ø¯Ø©
    restartBtn.onclick = () => {
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©
        window.location.reload(); 
    };

    // 3. Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù„Ø®Øµ (Ù†Ø§ÙØ°Ø© HTML)
    summaryOverlay.style.display = 'flex';
}

// â¬‡ï¸ Ø¯Ø§Ù„Ø© Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© (ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©) â¬‡ï¸
function gameOver(scene, completed) {
    if (gameFinished) return;
    gameFinished = true; 

    scene.physics.pause();
    bubbles.clear(true, true);
    document.getElementById('questionHeader').innerHTML = `<h3>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!</h3>`;

    const finalScore = score;
    // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù†Ù‚Ø§Ø· Ù„ÙŠØ¹ÙƒØ³ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©: 7 Ø£Ø³Ø¦Ù„Ø© * 10 Ù†Ù‚Ø§Ø· = 70
    const maxScore = QUESTIONS.length * 10; 
    let title = 'Ù„Ø¹Ø¨Ø© Ø±Ø§Ø¦Ø¹Ø©! ğŸŒŸ';
    
    if (finalScore === maxScore) {
        title = 'Ù…Ø°Ù‡Ù„! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­! ğŸ†';
    } else if (finalScore < maxScore && finalScore >= 0) {
        title = 'Ù†ØªÙŠØ¬Ø© Ø¬ÙŠØ¯Ø©! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„ØªØ­Ø³ÙŠÙ†Ù‡Ø§! ğŸ’ª';
    } 

    // ØªØ¬Ù‡ÙŠØ² Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    let reviewContent = '';
    
    // Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
    QUESTIONS.forEach((q, index) => {
        const correctAnswer = q.o[q.a];
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¤Ø§Ù„ Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· (Ø£ÙŠ ØªÙ…Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„ÙŠÙ‡ ØµØ­ÙŠØ­Ø§Ù‹ Ù…Ù† Ø£ÙˆÙ„ Ù…Ø±Ø©)
        const wasScored = scoredQuestions.includes(q.id);
        
        const reviewTitleColor = wasScored ? '#2ecc71' : '#f72585'; // Ø£Ø®Ø¶Ø± Ù„Ù€ ScoredØŒ Ø£Ø­Ù…Ø± Ù„Ù€ Not Scored
        const reviewTitleEmoji = wasScored ? 'âœ…' : 'âŒ';
        const reviewTitleText = wasScored ? '(ØªÙ…Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„ÙŠÙ‡Ø§ ØµØ­ÙŠØ­Ø§Ù‹ ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰)' : '(Ù„Ù… ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ù†Ù‚Ø§Ø·Ù‡Ø§)';
        
        reviewContent += `
            <p style="font-weight: bold; color: ${reviewTitleColor};">
                ${reviewTitleEmoji} Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1} ${reviewTitleText}:
            </p>
            <p style="margin-right: 15px;">**${q.q}**</p>
            <p style="margin-right: 15px; color: #4cc9f0;">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${correctAnswer}</p>
            <hr style="border-color: #333; margin: 10px 0;">
        `;
    });

    // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ù„Ø®Øµ
    showSummaryBox(finalScore, title, reviewContent);
    scene.winSound.play();
}
</script>
</body>
</html>
