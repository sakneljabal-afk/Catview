<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø¯ÙØ¹ ÙˆØ§Ù„ÙÙ‚Ø§Ø¹Ø§Øª</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>

<style>
  /* === ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø© === */
  body {
    margin: 0;
    /* Ø®Ù„ÙÙŠØ© Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠØ© Ø¯Ø§ÙØ¦Ø© ÙˆÙ…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø·ÙÙ„ 12 Ø³Ù†Ø© */
    background: linear-gradient(135deg, #FFD580 0%, #FFB347 100%);
    font-family: 'Segoe UI', 'Tajawal', Tahoma, Geneva, Verdana, sans-serif;
    touch-action: none; 
    overflow: hidden; 
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* === Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© (Ø§Ù„Ø³Ø¤Ø§Ù„) === */
  header {
    background: #2c3e50; 
    color: #fff;
    text-align: center;
    padding: 15px;
    height: 25vh; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ù„ÙŠÙƒÙˆÙ† Ø§Ù„Ø³Ø¤Ø§Ù„ Ø£ÙƒØ«Ø± ÙˆØ¶ÙˆØ­Ø§Ù‹ */
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    z-index: 10;
  }

  header h3 {
    margin: 0 0 10px 0;
    /* Ø²ÙŠØ§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø¨Ø´ÙƒÙ„ Ù…Ù„Ø­ÙˆØ¸ Ù„Ù„ÙˆØ¶ÙˆØ­ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    font-size: clamp(2.2rem, 7vw, 2.8rem); 
    color: #FFD700;
    font-weight: bold;
    line-height: 1.4;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }

  .answers {
    display: block; 
    text-align: right; 
    padding: 10px 20px; 
    margin-top: 10px;
  }
  
  .answers span {
    display: block; 
    /* Ø²ÙŠØ§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª */
    font-size: clamp(1.8rem, 6vw, 2.2rem); 
    margin: 8px 0; 
    padding: 8px 12px;
    border-bottom: 2px solid rgba(255,255,255,0.3);
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    font-weight: 600;
    line-height: 1.5;
  }
  
  .answers span:last-child {
      border-bottom: none;
  }

  /* === Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© === */
  main {
    flex: 1; 
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    padding: 10px;
  }

  /* Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„Ø¹Ø¨Ø© */
  #game-frame {
    width: 95vw; 
    height: 70vh; 
    max-width: 700px; 
    /* Ø®Ù„ÙÙŠØ© Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠØ© Ø®ÙÙŠÙØ© ÙˆÙ…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø£Ø·ÙØ§Ù„ */
    background: #E8F5E9; 
    /* Ø¥Ø·Ø§Ø± Ø®Ø§Ø±Ø¬ÙŠ Ù…Ù„ÙˆÙ† ÙˆØ¬Ø°Ø§Ø¨ Ù„Ù„Ø£Ø·ÙØ§Ù„ */
    border: 12px solid #FF8C42; 
    border-radius: 25px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 15px 30px rgba(0,0,0,0.25);
  }

  #game-container {
    width: 100%;
    height: 100%;
  }

  /* === Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„Ø®Ø·Ø£ === */
  #wrongFlash {
    position: fixed;
    inset: 0;
    background: rgba(255, 0, 0, 0);
    pointer-events: none;
    transition: background 0.2s;
    z-index: 999;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø·Ø£ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
  #errorMark {
    font-size: 10rem;
    color: white;
    background: rgba(231, 76, 60, 0.9);
    width: 180px;
    height: 180px;
    border-radius: 50%;
    display: none; 
    justify-content: center;
    align-items: center;
    box-shadow: 0 0 30px rgba(0,0,0,0.4);
    border: 8px solid white;
    font-weight: bold;
  }

  /* ØªØ£Ø«ÙŠØ±Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù„Ù…Ø³ */
  @media (hover: hover) {
    .answers span:hover {
      background-color: rgba(255, 255, 255, 0.2);
      transform: scale(1.02);
      transition: transform 0.2s;
    }
  }

  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
  @media (max-width: 480px) {
    header {
      height: 30vh;
      padding: 12px;
    }
    
    header h3 {
      font-size: clamp(1.8rem, 6vw, 2.4rem);
    }
    
    .answers span {
      font-size: clamp(1.6rem, 5vw, 2rem);
      padding: 6px 10px;
    }
    
    #game-frame {
      height: 65vh;
      border-width: 10px;
    }
  }

</style>
</head>

<body>

<header id="questionHeader"></header>

<main>
  <section id="game-frame">
    <div id="game-container"></div>
  </section>
</main>

<div id="wrongFlash">
  <div id="errorMark">âœ–</div>
</div>

<script>
/* ======================
   1. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ø£Ø³Ø¦Ù„Ø©)
====================== */
const QUESTIONS = [
  {
    "q": "ØªØ¹ÙŠØ´ Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ø§Ù†Ø¬Ø±ÙˆÙ ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ù…Ø§Ù„Ø­Ø©ØŒ ÙˆÙ„Ù‡Ø°Ø§ ØªÙ…ØªÙ„Ùƒ ØªÙƒÙŠÙØ§Ù‹ ØªØ±ÙƒÙŠØ¨ÙŠØ§Ù‹ Ù‡Ùˆ:",
    "o": [
      "Ø£ÙˆØ±Ø§Ù‚ Ø¹Ø±ÙŠØ¶Ø© ØªØ·ÙÙˆ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø§Ø¡",
      "Ø¬Ø°ÙˆØ± Ù‚ØµÙŠØ±Ø© Ø¶Ø¹ÙŠÙØ©",
      "Ø¬Ø°ÙˆØ± Ø·ÙˆÙŠÙ„Ø© ÙˆÙ‚ÙˆÙŠØ© Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„Ø£Ù…ÙˆØ§Ø¬"
    ],
    "a": 2
  },
  {
    "q": "Ù…Ø§ Ù‡ÙŠ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¬Ø°ÙˆØ± Ø§Ù„Ø·ÙˆÙŠÙ„Ø© ÙˆØ§Ù„Ù‚ÙˆÙŠØ© Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ø§Ù†Ø¬Ø±ÙˆÙØŸ",
    "o": [
      "ØªØ®Ø²ÙŠÙ† ÙƒÙ…ÙŠØ§Øª ÙƒØ¨ÙŠØ±Ø© Ù…Ù† Ø§Ù„Ù…Ø§Ø¡",
      "Ø§Ù…ØªØµØ§Øµ Ø§Ù„Ø¶ÙˆØ¡ Ù…Ù† Ø³Ø·Ø­ Ø§Ù„Ù…Ø§Ø¡",
      "Ø§Ù„ØµÙ…ÙˆØ¯ Ø£Ù…Ø§Ù… Ø§Ù„Ø£Ù…ÙˆØ§Ø¬ Ø§Ù„Ù‚ÙˆÙŠØ©"
    ],
    "a": 2
  },
  {
    "q": "Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªÙŠ ÙŠÙ†Ù…Ùˆ ÙÙŠÙ‡Ø§ Ù†Ø¨Ø§Øª Ø²Ù†Ø¨Ù‚ Ø§Ù„Ù…Ø§Ø¡ (Ø§Ù„Ù„ÙˆØªØ³) Ù‡ÙŠ Ø§Ù„Ù…Ø³ØªÙ†Ù‚Ø¹Ø§ØªØŒ ÙˆØªØªÙ…ÙŠØ² Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø¨Ù€:",
    "o": [
      "Ù…ÙŠØ§Ù‡ Ù…Ø§Ù„Ø­Ø© ÙˆØ£Ù…ÙˆØ§Ø¬ Ù‚ÙˆÙŠØ©",
      "ØªØ±Ø¨Ø© Ø¬Ø§ÙØ© ÙˆØ¯Ø±Ø¬Ø§Øª Ø­Ø±Ø§Ø±Ø© Ù…Ø±ØªÙØ¹Ø©",
      "Ù…ÙŠØ§Ù‡ Ø±Ø§ÙƒØ¯Ø© ÙˆÙƒÙ…ÙŠØ§Øª ÙƒØ¨ÙŠØ±Ø© Ù…Ù† Ø§Ù„Ø·ÙŠÙ†"
    ],
    "a": 2
  },
  {
    "q": "ÙŠÙ…ØªÙ„Ùƒ Ù†Ø¨Ø§Øª Ø²Ù†Ø¨Ù‚ Ø§Ù„Ù…Ø§Ø¡ Ø£ÙˆØ±Ø§Ù‚Ø§Ù‹ Ø¹Ø±ÙŠØ¶Ø© ØªØ·ÙÙˆ Ø¹Ù„Ù‰ Ø³Ø·Ø­ Ø§Ù„Ù…Ø§Ø¡ØŒ ÙˆÙ‡Ø°Ø§ Ø§Ù„ØªÙƒÙŠÙ Ø§Ù„ØªØ±ÙƒÙŠØ¨ÙŠ ÙŠØ³Ø§Ø¹Ø¯Ù‡ Ø¹Ù„Ù‰:",
    "o": [
      "Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„ØªÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø§Ø¦ÙŠØ©",
      "ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø§Ø¡ Ø§Ù„Ø²Ø§Ø¦Ø¯",
      "Ø§Ù…ØªØµØ§Øµ Ù‚Ø¯Ø± ÙƒØ¨ÙŠØ± Ù…Ù† Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³"
    ],
    "a": 2
  },
  {
    "q": "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªÙŠ ØªØªÙƒÙŠÙ Ø´Ø¬Ø±Ø© Ø§Ù„ØµÙ†ÙˆØ¨Ø± Ù„Ù„Ø¹ÙŠØ´ ÙÙŠÙ‡Ø§ØŸ",
    "o": [
      "Ø§Ù„Ù…Ø³ØªÙ†Ù‚Ø¹Ø§Øª Ø§Ù„Ù…Ø§Ø¦ÙŠØ©",
      "Ø§Ù„ØµØ­Ø§Ø±ÙŠ Ø§Ù„Ø¬Ø§ÙØ©",
      "Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø«Ù„Ø¬ÙŠØ© Ø´Ø¯ÙŠØ¯Ø© Ø§Ù„Ø¨Ø±ÙˆØ¯Ø©"
    ],
    "a": 2
  },
  {
    "q": "ØªÙ†Ù…Ùˆ Ø´Ø¬Ø±Ø© Ø§Ù„ØµÙ†ÙˆØ¨Ø± Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ù…Ø«Ù„Ø«ØŒ ÙˆÙ‡Ø°Ø§ Ø§Ù„ØªÙƒÙŠÙ Ø§Ù„ØªØ±ÙƒÙŠØ¨ÙŠ ÙŠØ³Ù…Ø­ Ø¨Ù€:",
    "o": [
      "Ø¬Ø°Ø¨ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³",
      "Ø²ÙŠØ§Ø¯Ø© Ø³Ø±Ø¹Ø© Ù†Ù…Ùˆ Ø§Ù„Ø£ØºØµØ§Ù†",
      "Ø³Ù‡ÙˆÙ„Ø© Ø§Ù†Ø²Ù„Ø§Ù‚ Ø§Ù„Ø«Ù„Ø¬ Ù…Ù† Ø¹Ù„ÙŠÙ‡Ø§ Ø¯ÙˆÙ† ÙƒØ³Ø± Ø§Ù„ÙØ±ÙˆØ¹"
    ],
    "a": 2
  }
];

/* ======================
   2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© (Phaser)
====================== */
const config = {
  type: Phaser.AUTO,
  parent: 'game-container', 
  width: 600,  
  height: 800, 
  // Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø®ÙÙŠÙ ÙˆÙ…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø£Ø·ÙØ§Ù„
  backgroundColor: '#E8F5E9', 
  scale: {
    mode: Phaser.Scale.FIT, 
    autoCenter: Phaser.Scale.CENTER_BOTH
  },
  physics: {
    default: 'arcade',
    arcade: {
      gravity: { y: 0 },
      debug: false
    }
  },
  scene: { preload, create, update }
};

const game = new Phaser.Game(config);

/* ======================
   3. Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
====================== */
let cannon, bubbles, invisibleWall;
let currentQ = 0;
let canShoot = true;
let isAiming = false;
let missedShots = 0;
 let shootAngle = -90; // Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø²Ø§ÙˆÙŠØ© let aimLine; // ÙƒØ§Ø¦Ù† Ø®Ø· Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ 

const BUBBLE_IMG_SIZE = 300; 

/* ======================
   4. Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Preload)
====================== */
function preload(){
  this.load.image('cannon','assets/cannon.png');
  this.load.image('shoot','assets/shoot.png');
  this.load.image('bubble1','assets/bubble1.png');
  this.load.image('bubble2','assets/bubble2.png');
  this.load.image('bubble3','assets/bubble3.png');
  this.load.audio('correct','../assets/correct.mp3');
  this.load.audio('wrong','../assets/wrong.mp3');
  this.load.audio('wrong','../assets/win.mp3');
}

/* ======================
   5. Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ (Create)
====================== */
function create(){
  const width = this.scale.width;
  const height = this.scale.height;

  this.correctSound = this.sound.add('correct');
  this.wrongSound = this.sound.add('wrong');

  this.physics.world.setBounds(0, 0, width, height);

  invisibleWall = this.add.rectangle(width/2, height * 0.55, width, 20, 0x000000, 0);
  this.physics.add.existing(invisibleWall, true);

  const cannonHeight = height * 0.10; 
  const cannonScale = cannonHeight / 300; 

  cannon = this.add.sprite(width/2, height * 0.90, 'cannon')
    .setScale(cannonScale)
    .setDepth(1); 

  bubbles = this.physics.add.group({
    collideWorldBounds: true,
    bounceX: 1,
    bounceY: 1
  });
  this.physics.add.collider(bubbles, invisibleWall);

// ğŸ”´ Ø¥Ø²Ø§Ù„Ø© ÙƒØ§Ø¦Ù† Ø§Ù„Ø³Ù‡Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ… (arrow) Ù„Ø£Ù†Ù‡ Ù„Ù† ÙŠØ³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ø¢Ù† 
// Ø£Ø¶Ù Ù‡Ù†Ø§ ÙƒØ§Ø¦Ù† Ø§Ù„Ø®Ø· Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠ 
(aimLine) aimLine = this.add.graphics({ lineStyle: { width: 4, color: 0xFF5722, alpha: 0.8 } }).setDepth(2);
javascript this.input.on('pointermove', (pointer) => { // Ø§Ù„Ù…Ø¯ÙØ¹ Ù„Ù… ÙŠØ¹Ø¯ ÙŠØªØ­Ø±ÙƒØŒ ÙÙ‚Ø· Ù†Ø±Ø³Ù… Ø§Ù„Ø®Ø· updateAimLine(this, pointer); });
 this.input.on('pointerdown', () => { // Ø¥Ù„ØºØ§Ø¡ Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØµÙˆÙŠØ¨ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ if (canShoot) updateAimLine(this, this.input.activePointer); });
 this.input.on('pointerup', () => { // ğŸŸ¢ Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù†Ø§Ø± Ø¹Ù†Ø¯ Ø±ÙØ¹ Ø§Ù„Ø¥ØµØ¨Ø¹ if (canShoot) fire(this); });

  showQuestion(this);
}

/* ======================
   6. Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªÙ…Ø± (Update)
====================== */
function update() {
  bubbles.children.iterate((b) => {
    if (b) b.rotation += 0.005;
  });
}


/* ======================
   * Ø¯Ø§Ù„Ø© Ø±Ø³Ù… Ø®Ø· Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
====================== */
function updateAimLine(scene, pointer) {
  // Ù…ÙˆÙ‚Ø¹ Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù…Ù‚Ø°ÙˆÙ
  const cannonX = cannon.x;
  const cannonY = cannon.y - cannon.displayHeight / 2;
  
  const pointerX = pointer.x;
  const pointerY = pointer.y;

  // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¯ÙØ¹ ÙˆÙ†Ù‚Ø·Ø© Ø§Ù„Ù„Ù…Ø³
  shootAngle = Phaser.Math.Angle.Between(cannonX, cannonY, pointerX, pointerY);

  // Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ Ù„Ù„Ø£Ø¹Ù„Ù‰ ÙÙ‚Ø·
  // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ù…ÙˆØ¬Ø¨Ø© (ØªØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ Ù„Ù„Ø£Ø³ÙÙ„)ØŒ Ù†Ø¬Ø¹Ù„Ù‡Ø§ Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù„ØµÙØ± Ø£Ùˆ -180
  if (shootAngle > 0) {
    if (pointerX < cannonX) {
        shootAngle = Phaser.Math.DegToRad(-179); // Ù„Ù„ÙŠØ³Ø§Ø±
    } else {
        shootAngle = Phaser.Math.DegToRad(-1); // Ù„Ù„ÙŠÙ…ÙŠÙ†
    }
  }

  // Ø±Ø³Ù… Ø§Ù„Ø®Ø· Ø§Ù„Ù…Ù†Ù‚Ø· 
  aimLine.clear();
  aimLine.lineStyle(4, 0xFF5722, 0.8); 
  
  // Ø·ÙˆÙ„ ÙƒØ¨ÙŠØ± Ù„Ù„Ø®Ø· Ù„ÙŠÙ…ØªØ¯ Ø­ØªÙ‰ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ø§Ø´Ø©
  const lineLength = 1000; 
  const endX = cannonX + Math.cos(shootAngle) * lineLength;
  const endY = cannonY + Math.sin(shootAngle) * lineLength;

  aimLine.beginPath();
  aimLine.moveTo(cannonX, cannonY);
  aimLine.lineTo(endX, endY);
  aimLine.strokePath(); 
}

/* ======================
   7. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ (Fire)
====================== */
function fire(scene){ canShoot = false;
aimLine.clear(); // ğŸ”´ Ø¥Ø®ÙØ§Ø¡ Ø®Ø· Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ ÙÙˆØ± Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ //

  const width = scene.scale.width;
  const shotScale = (width * 0.12) / 300; 

  const shot = scene.physics.add.sprite(
    cannon.x,
    cannon.y - cannon.displayHeight/1.5,
    'shoot'
  ).setScale(shotScale);

// ğŸŸ¢ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³Ø±Ø¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© 
const speed = 800; // Ø³Ø±Ø¹Ø© Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ 
const velocityX = Math.cos(shootAngle) * speed; 
const velocityY = Math.sin(shootAngle) * speed; 
shot.setVelocity(velocityX, velocityY);

  scene.physics.add.overlap(shot, bubbles, (s, b) => {
    s.destroy();
    missedShots = 0;
    bubbleHit(scene, b);
  });

  shot.setCollideWorldBounds(true);
  shot.body.onWorldBounds = true;

  shot.body.world.on('worldbounds', (body) => {
    if (body.gameObject === shot) {
      shot.destroy();
      missedShots++;
      if (missedShots >= 2) {
        missedShots = 0;
        showQuestion(scene); 
      }
    }
  });

  scene.time.delayedCall(1200, () => { if(shot.active) shot.destroy(); });
  
scene.time.delayedCall(800, () => { canShoot = true; // aimLine Ø³ÙŠØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø­Ø±ÙƒØ© pointermove Ø¬Ø¯ÙŠØ¯Ø© // Ù„Ø§ Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† isAiming Ø£Ùˆ Ø¥Ø¸Ù‡Ø§Ø± arrow });
}

/* ======================
   8. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¥ØµØ§Ø¨Ø© (Hit)
====================== */
function bubbleHit(scene, bubble){
  const correct = bubble.getData('correct');
  bubble.destroy();

  if(correct){
    scene.correctSound.play();
    scene.time.delayedCall(500, () => {
      currentQ++;
      showQuestion(scene);
    });
  } else {
    const flash = document.getElementById('wrongFlash');
    const mark = document.getElementById('errorMark');
    
    scene.wrongSound.play();
    
    flash.style.background = 'rgba(255,0,0,0.4)';
    mark.style.display = 'flex'; 
    
    setTimeout(() => {
      flash.style.background = 'rgba(255,0,0,0)';
      mark.style.display = 'none';
    }, 400); 

    scene.time.delayedCall(600, () => showQuestion(scene));
  }
}

/* ======================
   9. Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙÙ‚Ø§Ø¹Ø§Øª
====================== */
function showQuestion(scene){
  const q = QUESTIONS[currentQ];
  
  if(!q){
    document.getElementById('questionHeader').innerHTML = '<h3 style="color:#4CAF50">ğŸ‰ Ø£Ø­Ø³Ù†Øª! Ø£Ù†Ù‡ÙŠØª Ø§Ù„Ù„Ø¹Ø¨Ø©</h3><p style="font-size: 1.8rem;">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„ØªØ­Ø¯ÙŠ Ø¬Ø¯ÙŠØ¯!</p>';
    bubbles.clear(true, true);
    return;
  }

  document.getElementById('questionHeader').innerHTML = `
    <h3>${q.q}</h3>
    <div class="answers">
      <span style="color:#81d4fa">1: ${q.o[0]}</span>
      <span style="color:#a5d6a7">2: ${q.o[1]}</span>
      <span style="color:#ffe082">3: ${q.o[2]}</span>
    </div>
  `;

  bubbles.clear(true, true);
  
  const width = scene.scale.width;
  const height = scene.scale.height;

  const bubbleTargetSize = width * 0.18; 
  const bubbleScale = bubbleTargetSize / BUBBLE_IMG_SIZE;

  const positions = [0.2, 0.5, 0.8]; 

  for(let i=0; i<3; i++){
    const b = bubbles.create(
      width * positions[i],
      height * 0.3, 
      'bubble' + (i+1)
    ).setScale(bubbleScale);

    b.setCircle(130 * (bubbleScale / (width * 0.22 / BUBBLE_IMG_SIZE))); 

    b.setData('correct', i === q.a);
    
    b.setVelocity(
      Phaser.Math.Between(-50, 50), 
      Phaser.Math.Between(-30, 30)
    );
    
    b.setBounce(1);
    b.setCollideWorldBounds(true);
  }
}
</script>
</body>
</html>
