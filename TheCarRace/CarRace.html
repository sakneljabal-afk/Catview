<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ù…ØªØ³Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø¹Ø±ÙØ© - Ø¹Ù„ÙˆÙ… Ø±Ø§Ø¨Ø¹Ø©</title>
<style>
body { 
    background: linear-gradient(to bottom, #87CEEB, #E0F6FF);
    font-family: Tahoma, Arial, sans-serif;
    margin: 0;
    padding: 0;
    overflow: hidden;
    height: 100vh;
}

#gameContainer {
    width: 100%;
    height: 100%;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
}

#gameCanvas {
    border: 4px solid #2b6fb3;
    border-radius: 12px;
    background: #ffffff;
    box-shadow: 0 8px 16px rgba(0,0,0,0.2);
}

#sidebar-left {
    position: absolute;
    left: 20px;
    top: 20px;
    width: 250px;
    max-height: 90vh;
    overflow-y: auto;
    background: rgba(240, 248, 255, 0.9);
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    backdrop-filter: blur(5px);
}

#sidebar-left h4 {
    text-align: center;
    margin-top: 0;
    color: #2b6fb3;
    border-bottom: 2px solid #2b6fb3;
    padding-bottom: 8px;
}

.answered {
    margin-bottom: 8px;
    padding: 8px;
    background: #d1ffd1;
    border-radius: 6px;
    border-right: 4px solid #4CAF50;
    font-size: 14px;
    line-height: 1.4;
}

#sidebar-right {
    position: absolute;
    right: 20px;
    top: 20px;
    width: 200px;
    background: rgba(255, 240, 245, 0.9);
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    backdrop-filter: blur(5px);
    text-align: center;
}

#sidebar-right h4 {
    margin-top: 0;
    color: #2b6fb3;
    border-bottom: 2px solid #2b6fb3;
    padding-bottom: 8px;
}

.game-info {
    margin: 10px 0;
    padding: 8px;
    background: white;
    border-radius: 6px;
    font-weight: bold;
}

#header {
    position: absolute;
    top: 20px;
    width: 100%;
    text-align: center;
    font-weight: bold;
    font-size: 18px;
    color: #2b6fb3;
    text-shadow: 1px 1px 2px white;
    z-index: 10;
}

#questionBox {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 0 25px rgba(0,0,0,0.4);
    width: 400px;
    display: none;
    z-index: 1000;
    border: 3px solid #2b6fb3;
}

#questionBox h3 {
    font-size: 18px;
    margin-bottom: 15px;
    color: #2b6fb3;
    line-height: 1.5;
}

.choice {
    background: #e8e8e8;
    padding: 12px;
    margin: 10px 0;
    border-radius: 8px;
    cursor: pointer;
    font-size: 15px;
    transition: all 0.2s;
    border: 2px solid transparent;
}

.choice:hover {
    background: #d0d0d0;
    transform: translateX(-5px);
    border-color: #2b6fb3;
}

.choice.correct {
    background: #d1ffd1;
    border-color: #4CAF50;
}

.choice.wrong {
    background: #ffd1d1;
    border-color: #ff5722;
}

#winScreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 200, 0, 0.95);
    color: white;
    font-size: 36px;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    display: none;
    z-index: 1001;
    text-align: center;
}

#winScreen button {
    margin-top: 20px;
    padding: 15px 30px;
    font-size: 20px;
    background: white;
    color: #2b6fb3;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
}

#speedMeter {
    height: 20px;
    background: #ddd;
    border-radius: 10px;
    margin: 10px 0;
    overflow: hidden;
}

#speedFill {
    height: 100%;
    width: 50%;
    background: linear-gradient(to right, #4CAF50, #FFC107, #FF5722);
    border-radius: 10px;
    transition: width 0.3s;
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
@media only screen and (max-width: 768px) {
    #sidebar-left, #sidebar-right {
        position: relative;
        width: 90%;
        margin: 10px auto;
        max-height: 120px;
        order: 1;
        left: auto;
        right: auto;
        top: auto;
    }
    
    #header {
        font-size: 14px;
        padding: 5px;
        margin-bottom: 5px;
    }
    
    #questionBox {
        width: 90%;
        padding: 15px;
    }
    
    #questionBox h3 {
        font-size: 16px;
    }
    
    .choice {
        padding: 12px;
        font-size: 14px;
    }
    
    #winScreen {
        font-size: 24px;
        padding: 20px;
    }
    
    #winScreen button {
        padding: 12px 24px;
        font-size: 18px;
    }
}

/* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… */
#controls {
    position: absolute;
    bottom: 20px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    gap: 20px;
    display: none; /* Ù…Ø®ÙÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± */
}

.control-btn {
    width: 70px;
    height: 70px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 30px;
    color: white;
    cursor: pointer;
    user-select: none;
    border: 3px solid white;
}

@media only screen and (max-width: 768px) {
    #controls {
        display: flex;
    }
}
</style>
</head>
<body>
<div id="header">
    Ù…ØªØ³Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø¹Ø±ÙØ© - Ø§Ù„Ù…Ø§Ø¯Ø©: Ø¹Ù„ÙˆÙ… Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ
</div>

<div id="gameContainer">
    <canvas id="gameCanvas"></canvas>
</div>

<div id="sidebar-left">
    <h4>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©</h4>
    <div id="answeredList"></div>
</div>

<div id="sidebar-right">
    <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h4>
    <div class="game-info">Ø§Ù„Ø³Ø±Ø¹Ø©: <span id="currentSpeed">50</span> ÙƒÙ…/Ø³</div>
    <div class="game-info">Ø§Ù„Ù†ØªÙŠØ¬Ø©: <span id="score">0</span></div>
    <div class="game-info">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <span id="questionsRemaining">0</span></div>
    <div id="speedMeter">
        <div id="speedFill"></div>
    </div>
    <div class="game-info" style="font-size: 12px; margin-top: 10px;">
        Ø§Ø³ØªØ®Ø¯Ù… â†‘â†“ Ù„ØªØ³Ø±ÙŠØ¹/ÙƒØ¨Ø­ Ø£Ùˆ â†â†’ Ù„Ø¶Ø¨Ø· Ø§Ù„ØªÙˆØ§Ø²Ù†
    </div>
</div>

<div id="questionBox">
    <h3 id="qText"></h3>
    <div id="choices"></div>
</div>

<div id="winScreen">
    ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©! ğŸ‰
    <button onclick="restartGame()">Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
</div>

<div id="controls">
    <div class="control-btn" id="leftBtn">â†</div>
    <div class="control-btn" id="upBtn">â†‘</div>
    <div class="control-btn" id="rightBtn">â†’</div>
    <div class="control-btn" id="downBtn">â†“</div>
</div>

<script>
// ********** Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ù†ÙØ³ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©) **********
const allQuestions = [
    {
        "q": "ØªØ¹ÙŠØ´ Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ø§Ù†Ø¬Ø±ÙˆÙ ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ù…Ø§Ù„Ø­Ø©ØŒ ÙˆÙ„Ù‡Ø°Ø§ ØªÙ…ØªÙ„Ùƒ ØªÙƒÙŠÙØ§Ù‹ ØªØ±ÙƒÙŠØ¨ÙŠØ§Ù‹ Ù‡Ùˆ:",
        "c": [
            "Ø£ÙˆØ±Ø§Ù‚ Ø¹Ø±ÙŠØ¶Ø© ØªØ·ÙÙˆ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø§Ø¡",
            "Ø¬Ø°ÙˆØ± Ù‚ØµÙŠØ±Ø© Ø¶Ø¹ÙŠÙØ©",
            "Ø¬Ø°ÙˆØ± Ø·ÙˆÙŠÙ„Ø© ÙˆÙ‚ÙˆÙŠØ© Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„Ø£Ù…ÙˆØ§Ø¬"
        ],
        "a": 2
    },
    // ... (ÙƒÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ Ù…ÙˆØ¬ÙˆØ¯Ø© Ù‡Ù†Ø§)
    // Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¹Ø±Ø¶ØŒ Ø³Ø£Ø¶Ø¹ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙ‚Ø·
    {
        "q": "Ù…Ø§ Ù‡ÙŠ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¬Ø°ÙˆØ± Ø§Ù„Ø·ÙˆÙŠÙ„Ø© ÙˆØ§Ù„Ù‚ÙˆÙŠØ© Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ø§Ù†Ø¬Ø±ÙˆÙØŸ",
        "c": [
            "ØªØ®Ø²ÙŠÙ† ÙƒÙ…ÙŠØ§Øª ÙƒØ¨ÙŠØ±Ø© Ù…Ù† Ø§Ù„Ù…Ø§Ø¡",
            "Ø§Ù…ØªØµØ§Øµ Ø§Ù„Ø¶ÙˆØ¡ Ù…Ù† Ø³Ø·Ø­ Ø§Ù„Ù…Ø§Ø¡",
            "Ø§Ù„ØµÙ…ÙˆØ¯ Ø£Ù…Ø§Ù… Ø§Ù„Ø£Ù…ÙˆØ§Ø¬ Ø§Ù„Ù‚ÙˆÙŠØ©"
        ],
        "a": 2
    },
    {
        "q": "Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªÙŠ ÙŠÙ†Ù…Ùˆ ÙÙŠÙ‡Ø§ Ù†Ø¨Ø§Øª Ø²Ù†Ø¨Ù‚ Ø§Ù„Ù…Ø§Ø¡ (Ø§Ù„Ù„ÙˆØªØ³) Ù‡ÙŠ Ø§Ù„Ù…Ø³ØªÙ†Ù‚Ø¹Ø§ØªØŒ ÙˆØªØªÙ…ÙŠØ² Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø¨Ù€:",
        "c": [
            "Ù…ÙŠØ§Ù‡ Ù…Ø§Ù„Ø­Ø© ÙˆØ£Ù…ÙˆØ§Ø¬ Ù‚ÙˆÙŠØ©",
            "ØªØ±Ø¨Ø© Ø¬Ø§ÙØ© ÙˆØ¯Ø±Ø¬Ø§Øª Ø­Ø±Ø§Ø±Ø© Ù…Ø±ØªÙØ¹Ø©",
            "Ù…ÙŠØ§Ù‡ Ø±Ø§ÙƒØ¯Ø© ÙˆÙƒÙ…ÙŠØ§Øª ÙƒØ¨ÙŠØ±Ø© Ù…Ù† Ø§Ù„Ø·ÙŠÙ†"
        ],
        "a": 2
    },
    {
        "q": "ÙŠÙ…ØªÙ„Ùƒ Ù†Ø¨Ø§Øª Ø²Ù†Ø¨Ù‚ Ø§Ù„Ù…Ø§Ø¡ Ø£ÙˆØ±Ø§Ù‚Ø§Ù‹ Ø¹Ø±ÙŠØ¶Ø© ØªØ·ÙÙˆ Ø¹Ù„Ù‰ Ø³Ø·Ø­ Ø§Ù„Ù…Ø§Ø¡ØŒ ÙˆÙ‡Ø°Ø§ Ø§Ù„ØªÙƒÙŠÙ Ø§Ù„ØªØ±ÙƒÙŠØ¨ÙŠ ÙŠØ³Ø§Ø¹Ø¯Ù‡ Ø¹Ù„Ù‰:",
        "c": [
            "Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„ØªÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø§Ø¦ÙŠØ©",
            "ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø§Ø¡ Ø§Ù„Ø²Ø§Ø¦Ø¯",
            "Ø§Ù…ØªØµØ§Øµ Ù‚Ø¯Ø± ÙƒØ¨ÙŠØ± Ù…Ù† Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³"
        ],
        "a": 2
    },
    {
        "q": "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªÙŠ ØªØªÙƒÙŠÙ Ø´Ø¬Ø±Ø© Ø§Ù„ØµÙ†ÙˆØ¨Ø± Ù„Ù„Ø¹ÙŠØ´ ÙÙŠÙ‡Ø§ØŸ",
        "c": [
            "Ø§Ù„Ù…Ø³ØªÙ†Ù‚Ø¹Ø§Øª Ø§Ù„Ù…Ø§Ø¦ÙŠØ©",
            "Ø§Ù„ØµØ­Ø§Ø±ÙŠ Ø§Ù„Ø¬Ø§ÙØ©",
            "Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø«Ù„Ø¬ÙŠØ© Ø´Ø¯ÙŠØ¯Ø© Ø§Ù„Ø¨Ø±ÙˆØ¯Ø©"
        ],
        "a": 2
    }
];

// ********** ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© **********
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ù„ÙˆØ­Ø©
function resizeCanvas() {
    const container = document.getElementById('gameContainer');
    canvas.width = Math.min(800, container.clientWidth - 300);
    canvas.height = Math.min(600, container.clientHeight - 100);
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// ********** Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© **********
let gameState = 'playing'; // 'playing' Ø£Ùˆ 'paused' Ø£Ùˆ 'gameOver'
let car = {
    x: 100,
    y: canvas.height / 2,
    width: 60,
    height: 30,
    speed: 2,
    maxSpeed: 10,
    minSpeed: 0.5,
    acceleration: 0.1,
    deceleration: 0.05,
    tilt: 0,
    maxTilt: 30,
    color: '#FF5722',
    wheels: [
        { x: 10, y: 25, radius: 8 },
        { x: 50, y: 25, radius: 8 }
    ]
};

let terrain = [];
let questionBoxes = [];
let answeredQuestions = new Set();
let currentQuestions = [...allQuestions];
let score = 0;
let baseSpeed = 2;
let currentQuestionBox = null;

// ********** ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³ **********
function generateTerrain() {
    terrain = [];
    let y = canvas.height / 2;
    let amplitude = 80;
    let frequency = 0.02;
    
    for (let x = 0; x < canvas.width * 2; x += 10) {
        // Ø¥Ù†Ø´Ø§Ø¡ ØªØ¶Ø§Ø±ÙŠØ³ Ù…ÙˆØ¬ÙŠØ©
        y = canvas.height / 2 + Math.sin(x * frequency) * amplitude;
        
        // Ø¥Ø¶Ø§ÙØ© Ø¨Ø¹Ø¶ Ø§Ù„ØªÙ„Ø§Ù„ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
        if (Math.random() < 0.01) {
            amplitude = Math.random() * 60 + 40;
        }
        
        terrain.push({ x, y });
    }
}

// ********** Ø±Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© **********
function drawCar() {
    ctx.save();
    
    // Ù†Ù‚Ù„ ÙˆÙ†Ù‚Ù„ Ø¥Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    ctx.translate(car.x, car.y);
    ctx.rotate(car.tilt * Math.PI / 180);
    
    // Ø¬Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    ctx.fillStyle = car.color;
    ctx.fillRect(-car.width/2, -car.height/2, car.width, car.height);
    
    // Ù†ÙˆØ§ÙØ° Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    ctx.fillStyle = '#87CEEB';
    ctx.fillRect(-car.width/2 + 5, -car.height/2 + 5, 20, 15);
    ctx.fillRect(-car.width/2 + 30, -car.height/2 + 5, 20, 15);
    
    // Ø§Ù„Ø¹Ø¬Ù„Ø§Øª
    ctx.fillStyle = '#333';
    car.wheels.forEach(wheel => {
        ctx.beginPath();
        ctx.arc(wheel.x - car.width/2, wheel.y - car.height/2, wheel.radius, 0, Math.PI * 2);
        ctx.fill();
        
        // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø¬Ù„Ø©
        ctx.fillStyle = '#666';
        ctx.beginPath();
        ctx.arc(wheel.x - car.width/2, wheel.y - car.height/2, wheel.radius * 0.5, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#333';
    });
    
    ctx.restore();
}

// ********** Ø±Ø³Ù… Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³ **********
function drawTerrain() {
    if (terrain.length < 2) return;
    
    ctx.beginPath();
    ctx.moveTo(terrain[0].x, terrain[0].y);
    
    for (let i = 1; i < terrain.length; i++) {
        ctx.lineTo(terrain[i].x, terrain[i].y);
    }
    
    // Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø´ÙƒÙ„ Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³
    ctx.lineTo(terrain[terrain.length-1].x, canvas.height);
    ctx.lineTo(terrain[0].x, canvas.height);
    ctx.closePath();
    
    // ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ Ù„Ù„ØªØ¶Ø§Ø±ÙŠØ³
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#8BC34A');
    gradient.addColorStop(1, '#689F38');
    ctx.fillStyle = gradient;
    ctx.fill();
    
    // Ø­Ø¯ÙˆØ¯ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³
    ctx.strokeStyle = '#558B2F';
    ctx.lineWidth = 2;
    ctx.stroke();
}

// ********** Ø±Ø³Ù… ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© **********
function drawQuestionBoxes() {
    questionBoxes.forEach(box => {
        // ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø³Ø¤Ø§Ù„
        ctx.fillStyle = box.answered ? '#4CAF50' : '#FFC107';
        ctx.fillRect(box.x, box.y, box.width, box.height);
        
        // Ø­Ø¯ÙˆØ¯ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
        ctx.strokeStyle = box.answered ? '#2E7D32' : '#FF9800';
        ctx.lineWidth = 2;
        ctx.strokeRect(box.x, box.y, box.width, box.height);
        
        // Ø¹Ù„Ø§Ù…Ø© Ø§Ø³ØªÙÙ‡Ø§Ù…
        ctx.fillStyle = 'white';
        ctx.font = 'bold 20px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('?', box.x + box.width/2, box.y + box.height/2);
        
        // Ù…Ø¤Ø´Ø± Ø§Ù„ÙˆÙ‡Ø¬ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø¹Ø¯ Ø§Ù„Ø®Ø·Ø£
        if (box.isRepeat) {
            ctx.shadowColor = '#FF5722';
            ctx.shadowBlur = 15;
            ctx.strokeStyle = '#FF5722';
            ctx.lineWidth = 3;
            ctx.strokeRect(box.x, box.y, box.width, box.height);
            ctx.shadowBlur = 0;
        }
    });
}

// ********** ØªÙˆÙ„ÙŠØ¯ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© **********
function generateQuestionBoxes() {
    questionBoxes = [];
    
    // ÙˆØ¶Ø¹ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³
    for (let i = 0; i < currentQuestions.length; i++) {
        const question = currentQuestions[i];
        
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³ Ù„ÙˆØ¶Ø¹ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
        for (let j = 0; j < terrain.length - 1; j++) {
            if (terrain[j].x > 300 + i * 400 && Math.random() < 0.1) {
                const box = {
                    x: terrain[j].x,
                    y: terrain[j].y - 40,
                    width: 30,
                    height: 30,
                    question: question,
                    answered: false,
                    isRepeat: false
                };
                questionBoxes.push(box);
                break;
            }
        }
    }
}

// ********** Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø³ÙŠØ§Ø±Ø© **********
const keys = {};

window.addEventListener('keydown', (e) => {
    keys[e.key] = true;
});

window.addEventListener('keyup', (e) => {
    keys[e.key] = false;
});

// Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³ Ù„Ù„Ø¬ÙˆØ§Ù„
document.getElementById('upBtn').addEventListener('touchstart', () => keys['ArrowUp'] = true);
document.getElementById('upBtn').addEventListener('touchend', () => keys['ArrowUp'] = false);
document.getElementById('downBtn').addEventListener('touchstart', () => keys['ArrowDown'] = true);
document.getElementById('downBtn').addEventListener('touchend', () => keys['ArrowDown'] = false);
document.getElementById('leftBtn').addEventListener('touchstart', () => keys['ArrowLeft'] = true);
document.getElementById('leftBtn').addEventListener('touchend', () => keys['ArrowLeft'] = false);
document.getElementById('rightBtn').addEventListener('touchstart', () => keys['ArrowRight'] = true);
document.getElementById('rightBtn').addEventListener('touchend', () => keys['ArrowRight'] = false);

// ********** ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© **********
function updateCar() {
    if (gameState !== 'playing') return;
    
    // Ø§Ù„ØªØ³Ø§Ø±Ø¹ ÙˆØ§Ù„ÙƒØ¨Ø­
    if (keys['ArrowUp']) {
        car.speed += car.acceleration;
    } else if (keys['ArrowDown']) {
        car.speed -= car.deceleration;
    }
    
    // Ø¶Ø¨Ø· Ø§Ù„ØªÙˆØ§Ø²Ù† (Ø§Ù„Ù…ÙŠÙ„)
    if (keys['ArrowLeft']) {
        car.tilt = Math.max(car.tilt - 2, -car.maxTilt);
    } else if (keys['ArrowRight']) {
        car.tilt = Math.min(car.tilt + 2, car.maxTilt);
    } else {
        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠØ© Ù„Ù„ØªÙˆØ§Ø²Ù†
        if (car.tilt > 0) car.tilt -= 1;
        else if (car.tilt < 0) car.tilt += 1;
    }
    
    // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø³Ø±Ø¹Ø©
    car.speed = Math.max(car.minSpeed, Math.min(car.speed, car.maxSpeed));
    
    // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    car.x += car.speed;
    
    // Ø¬Ø¹Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ØªØªØ¨Ø¹ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³
    for (let i = 0; i < terrain.length - 1; i++) {
        if (terrain[i].x <= car.x && terrain[i+1].x >= car.x) {
            const progress = (car.x - terrain[i].x) / (terrain[i+1].x - terrain[i].x);
            const groundY = terrain[i].y + (terrain[i+1].y - terrain[i].y) * progress;
            car.y = groundY - car.height/2;
            break;
        }
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… Ø¨ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    checkQuestionBoxCollision();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø±Ø¹Ø© ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    updateUI();
}

// ********** Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… **********
function checkQuestionBoxCollision() {
    for (let i = 0; i < questionBoxes.length; i++) {
        const box = questionBoxes[i];
        
        if (!box.answered && 
            car.x < box.x + box.width &&
            car.x + car.width > box.x &&
            car.y < box.y + box.height &&
            car.y + car.height > box.y) {
            
            currentQuestionBox = box;
            showQuestion(box.question);
            return;
        }
    }
}

// ********** Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ **********
function showQuestion(question) {
    gameState = 'paused';
    
    const qb = document.getElementById("questionBox");
    document.getElementById("qText").textContent = question.q;
    
    const choicesDiv = document.getElementById("choices");
    choicesDiv.innerHTML = "";
    
    question.c.forEach((choice, index) => {
        const choiceDiv = document.createElement("div");
        choiceDiv.className = "choice";
        choiceDiv.textContent = choice;
        choiceDiv.onclick = () => handleAnswer(index, question, choiceDiv);
        choicesDiv.appendChild(choiceDiv);
    });
    
    qb.style.display = "block";
}

// ********** Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© **********
function handleAnswer(selectedIndex, question, choiceElement) {
    const isCorrect = selectedIndex === question.a;
    
    if (isCorrect) {
        // Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
        choiceElement.classList.add('correct');
        
        // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±Ø¹Ø©
        car.speed = Math.min(car.maxSpeed, car.speed + 0.5);
        baseSpeed = car.speed;
        
        // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©
        score += 10;
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
        answeredQuestions.add(question.q);
        addToAnsweredList(question);
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const index = currentQuestions.findIndex(q => q.q === question.q);
        if (index > -1) {
            currentQuestions.splice(index, 1);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
        if (currentQuestionBox) {
            currentQuestionBox.answered = true;
        }
        
        // Ø¥Ø®ÙØ§Ø¡ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ±
        setTimeout(() => {
            document.getElementById("questionBox").style.display = "none";
            gameState = 'playing';
            currentQuestionBox = null;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            if (currentQuestions.length === 0) {
                endGame();
            }
        }, 1000);
        
    } else {
        // Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©
        choiceElement.classList.add('wrong');
        
        // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¹Ø© Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ±
        car.speed = Math.max(car.minSpeed, car.speed * 0.6);
        baseSpeed = car.speed;
        
        // Ø¥Ù†Ø´Ø§Ø¡ ØµÙ†Ø¯ÙˆÙ‚ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ Ù„Ù†ÙØ³ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ù‡Ø¯
        createRepeatQuestionBox(question);
        
        // Ø¥Ø®ÙØ§Ø¡ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ±
        setTimeout(() => {
            document.getElementById("questionBox").style.display = "none";
            gameState = 'playing';
            currentQuestionBox = null;
        }, 1500);
    }
    
    updateUI();
}

// ********** Ø¥Ù†Ø´Ø§Ø¡ ØµÙ†Ø¯ÙˆÙ‚ Ø³Ø¤Ø§Ù„ Ù…ÙƒØ±Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®Ø·Ø£ **********
function createRepeatQuestionBox(question) {
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¢Ø®Ø± Ù†Ù‚Ø·Ø© ÙÙŠ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³
    const lastTerrainPoint = terrain[terrain.length - 1];
    
    const repeatBox = {
        x: lastTerrainPoint.x - 100,
        y: lastTerrainPoint.y - 40,
        width: 30,
        height: 30,
        question: question,
        answered: false,
        isRepeat: true
    };
    
    questionBoxes.push(repeatBox);
}

// ********** Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª **********
function addToAnsweredList(question) {
    const answeredList = document.getElementById("answeredList");
    const div = document.createElement("div");
    div.className = "answered";
    div.textContent = `${question.q} - Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${question.c[question.a]}`;
    answeredList.appendChild(div);
}

// ********** ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… **********
function updateUI() {
    document.getElementById("currentSpeed").textContent = car.speed.toFixed(1);
    document.getElementById("score").textContent = score;
    document.getElementById("questionsRemaining").textContent = currentQuestions.length;
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø±Ø¹Ø©
    const speedPercent = (car.speed / car.maxSpeed) * 100;
    document.getElementById("speedFill").style.width = `${speedPercent}%`;
}

// ********** Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© **********
function endGame() {
    gameState = 'gameOver';
    document.getElementById("winScreen").style.display = "flex";
}

// ********** Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© **********
function restartGame() {
    gameState = 'playing';
    car = {
        x: 100,
        y: canvas.height / 2,
        width: 60,
        height: 30,
        speed: 2,
        maxSpeed: 10,
        minSpeed: 0.5,
        acceleration: 0.1,
        deceleration: 0.05,
        tilt: 0,
        maxTilt: 30,
        color: '#FF5722',
        wheels: [
            { x: 10, y: 25, radius: 8 },
            { x: 50, y: 25, radius: 8 }
        ]
    };
    
    currentQuestions = [...allQuestions];
    answeredQuestions.clear();
    score = 0;
    
    document.getElementById("answeredList").innerHTML = "";
    document.getElementById("winScreen").style.display = "none";
    
    generateTerrain();
    generateQuestionBoxes();
    updateUI();
}

// ********** Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ **********
function draw() {
    // Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Ø´Ø©
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ©
    drawBackground();
    
    // Ø±Ø³Ù… Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³
    drawTerrain();
    
    // Ø±Ø³Ù… ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    drawQuestionBoxes();
    
    // Ø±Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    drawCar();
    
    // Ø±Ø³Ù… ÙˆØ§Ø¬Ù‡Ø© Ø¯Ø§Ø®Ù„ÙŠØ© Ø¨Ø³ÙŠØ·Ø©
    drawHUD();
}

// ********** Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ© **********
function drawBackground() {
    // Ø§Ù„Ø³Ù…Ø§Ø¡
    const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    skyGradient.addColorStop(0, '#87CEEB');
    skyGradient.addColorStop(1, '#E0F6FF');
    ctx.fillStyle = skyGradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Ø³Ø­Ø¨
    ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
    for (let i = 0; i < 5; i++) {
        const x = (car.x * 0.1 + i * 100) % (canvas.width + 200) - 100;
        const y = 50 + i * 30;
        drawCloud(x, y);
    }
    
    // Ø´Ù…Ø³
    ctx.fillStyle = '#FFEB3B';
    ctx.beginPath();
    ctx.arc(canvas.width - 50, 50, 30, 0, Math.PI * 2);
    ctx.fill();
    
    // Ø£Ø´Ø¹Ø© Ø§Ù„Ø´Ù…Ø³
    ctx.strokeStyle = 'rgba(255, 235, 59, 0.3)';
    ctx.lineWidth = 3;
    for (let i = 0; i < 12; i++) {
        const angle = (i / 12) * Math.PI * 2;
        ctx.beginPath();
        ctx.moveTo(
            canvas.width - 50 + Math.cos(angle) * 30,
            50 + Math.sin(angle) * 30
        );
        ctx.lineTo(
            canvas.width - 50 + Math.cos(angle) * 45,
            50 + Math.sin(angle) * 45
        );
        ctx.stroke();
    }
}

// ********** Ø±Ø³Ù… Ø³Ø­Ø§Ø¨Ø© **********
function drawCloud(x, y) {
    ctx.beginPath();
    ctx.arc(x, y, 20, 0, Math.PI * 2);
    ctx.arc(x + 25, y - 10, 25, 0, Math.PI * 2);
    ctx.arc(x + 50, y, 20, 0, Math.PI * 2);
    ctx.arc(x + 25, y + 10, 15, 0, Math.PI * 2);
    ctx.fill();
}

// ********** Ø±Ø³Ù… ÙˆØ§Ø¬Ù‡Ø© Ø¯Ø§Ø®Ù„ÙŠØ© **********
function drawHUD() {
    // Ø³Ø±Ø¹Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
    ctx.fillRect(10, 10, 150, 40);
    
    ctx.fillStyle = 'white';
    ctx.font = 'bold 16px Arial';
    ctx.textAlign = 'left';
    ctx.fillText(`Ø§Ù„Ø³Ø±Ø¹Ø©: ${car.speed.toFixed(1)} ÙƒÙ…/Ø³`, 20, 35);
}

// ********** Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© **********
function gameLoop() {
    if (gameState === 'playing') {
        updateCar();
        
        // ØªØ­Ø±ÙŠÙƒ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³ Ù„Ø®Ù„Ù‚ ÙˆÙ‡Ù… Ø§Ù„Ø­Ø±ÙƒØ©
        if (car.speed > 0) {
            terrain.forEach(point => {
                point.x -= car.speed * 0.5;
            });
            
            // ØªØ­Ø±ÙŠÙƒ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            questionBoxes.forEach(box => {
                box.x -= car.speed * 0.5;
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙŠ Ø®Ø±Ø¬Øª Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©
            terrain = terrain.filter(point => point.x > -100);
            questionBoxes = questionBoxes.filter(box => box.x > -100);
            
            // Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø©
            if (terrain[terrain.length - 1].x < canvas.width * 1.5) {
                const lastPoint = terrain[terrain.length - 1];
                const newY = lastPoint.y + (Math.random() - 0.5) * 20;
                terrain.push({
                    x: lastPoint.x + 10,
                    y: newY
                });
            }
        }
    }
    
    draw();
    requestAnimationFrame(gameLoop);
}

// ********** ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© **********
function initGame() {
    generateTerrain();
    generateQuestionBoxes();
    updateUI();
    gameLoop();
}

// Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('load', initGame);
</script>
</body>
</html>