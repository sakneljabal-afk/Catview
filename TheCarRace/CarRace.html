<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ุณูุงุฑุฉ ุงููุณุงุฑ ุงูุณุฑูุน - ูุนุจุฉ ุชุนููููุฉ</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body {
            background: linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);
            color:#fff; min-height:100vh; display:flex; flex-direction:column; align-items:center; padding:20px;
        }
        .header { text-align:center; margin-bottom:20px; width:100%; max-width:800px; }
        h1 { color:#4cc9f0; font-size:2.5rem; margin-bottom:10px; text-shadow:0 0 10px rgba(76,201,240,.5); }
        .subtitle { color:#b8b8d1; font-size:1.2rem; margin-bottom:20px; }
        .game-container { width:100%; max-width:800px; border-radius:15px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.5); position:relative; }
        #gameCanvas { display:block; background-color:#0d1117; }
        .instructions { background:rgba(22,33,62,.8); border-radius:10px; padding:20px; margin-top:20px; width:100%; max-width:800px; border-left:5px solid #4cc9f0; }
        .instructions h2 { color:#4cc9f0; margin-bottom:10px; }
        .instructions ul { padding-right:20px; line-height:1.6; }
        .highlight { color:#f72585; font-weight:bold; }
        .speed-display { position:absolute; top:15px; left:15px; background:rgba(0,0,0,.7); padding:10px 15px; border-radius:10px; font-size:1.2rem; border:2px solid #4cc9f0; z-index:10; }
        .question-box { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:90%; max-width:600px; background:linear-gradient(135deg,#1a1a2e 0%,#0f3460 100%); border-radius:15px; padding:25px; box-shadow:0 10px 30px rgba(0,0,0,.7); border:3px solid #4cc9f0; z-index:100; display:none; }
        .question-text { font-size:1.4rem; margin-bottom:25px; color:#fff; line-height:1.5; }
        .options-container { display:flex; flex-direction:column; gap:12px; }
        .option { background:rgba(255,255,255,.1); border:2px solid #4361ee; border-radius:10px; padding:15px; font-size:1.1rem; cursor:pointer; transition:all .3s ease; text-align:right; }
        .option:hover { background:rgba(67,97,238,.3); transform:translateX(-5px); }
        .correct { background:rgba(72,187,120,.3); border-color:#48bb78; }
        .incorrect { background:rgba(245,101,101,.3); border-color:#f56565; }
        .question-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; color:#4cc9f0; font-size:1.2rem; }
        .close-btn { background:#f72585; color:white; border:none; border-radius:50%; width:40px; height:40px; font-size:1.5rem; cursor:pointer; display:flex; align-items:center; justify-content:center; }
        .footer { margin-top:20px; text-align:center; color:#b8b8d1; font-size:.9rem; }
        @media (max-width:768px) {
            h1 { font-size:2rem; }
            .game-container { max-width:95%; }
            .question-text { font-size:1.2rem; }
            .option { padding:12px; font-size:1rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>๐ ุณูุงุฑุฉ ุงููุณุงุฑ ุงูุณุฑูุน</h1>
        <p class="subtitle">ูุนุจุฉ ุชุนููููุฉ - ุฃุฌุจ ุนูู ุงูุฃุณุฆูุฉ ูุฒูุงุฏุฉ ุณุฑุนุฉ ุณูุงุฑุชู</p>
    </div>

    <div class="game-container">
        <div class="speed-display">ุงูุณุฑุนุฉ: <span id="speedValue">200</span></div>
        <div id="gameCanvas"></div>
    </div>

    <div class="instructions">
        <h2>๐ ููููุฉ ุงููุนุจ:</h2>
        <ul>
            <li>ุชุณูุฑ ุงูุณูุงุฑุฉ ุชููุงุฆูุงู ุนูู ุงููุณุงุฑ</li>
            <li>ุนูุฏ ุงูุงุตุทุฏุงู <span class="highlight">ุจุตูุฏูู ุงูุฃุณุฆูุฉ</span>ุ ุชุธูุฑ ูู ุณุคุงู</li>
            <li>ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ ุชุฒูุฏ ุณุฑุนุฉ ุณูุงุฑุชู <span class="highlight">+20</span></li>
            <li>ุงูุฅุฌุงุจุฉ ุงูุฎุงุทุฆุฉ ุชููู ุณุฑุนุฉ ุณูุงุฑุชู <span class="highlight">40%</span></li>
            <li>ุงูุฃุณุฆูุฉ ุงูุชู ุชุฌูุจ ุนูููุง ุฎุทุฃู ุชุนูุฏ ุฅููู ูุฑุฉ ุฃุฎุฑู ุจุนุฏ 5 ุซูุงูู</li>
            <li>ูุฏูู: ุงูุฅุฌุงุจุฉ ุนูู ุฃูุจุฑ ุนุฏุฏ ูู ุงูุฃุณุฆูุฉ ูุฒูุงุฏุฉ ุณุฑุนุชู ูุฃูุตู ุญุฏ!</li>
        </ul>
    </div>

    <div class="question-box" id="questionBox">
        <div class="question-header">
            <div>โ ุณุคุงู ุชุนูููู</div>
            <button class="close-btn" id="closeQuestion">โ</button>
        </div>
        <div class="question-text" id="questionText"></div>
        <div class="options-container" id="optionsContainer"></div>
    </div>

    <div class="footer">
        <p>ูุนุจุฉ ุชุนููููุฉ ุจุงุณุชุฎุฏุงู Phaser 3 - ุชุฑูุฒ ุนูู ูุจุงุช ุงููุงูุฌุฑูู ูุชูููุงุชู ูุน ุงูุจูุฆุฉ</p>
    </div>

    <script>
        const allQuestions = [
            {"q":"ุชุนูุด ุดุฌุฑุฉ ุงููุงูุฌุฑูู ูู ุจูุฆุฉ ุงูููุงู ุงููุงูุญุฉุ ูููุฐุง ุชูุชูู ุชูููุงู ุชุฑููุจูุงู ูู:","c":["ุฃูุฑุงู ุนุฑูุถุฉ ุชุทูู ุนูู ุงููุงุก","ุฌุฐูุฑ ูุตูุฑุฉ ุถุนููุฉ","ุฌุฐูุฑ ุทูููุฉ ููููุฉ ูููุงููุฉ ุงูุฃููุงุฌ"],"a":2},
            {"q":"ูุง ูู ูุธููุฉ ุงูุฌุฐูุฑ ุงูุทูููุฉ ูุงููููุฉ ูุดุฌุฑุฉ ุงููุงูุฌุฑููุ","c":["ุชุฎุฒูู ูููุงุช ูุจูุฑุฉ ูู ุงููุงุก","ุงูุชุตุงุต ุงูุถูุก ูู ุณุทุญ ุงููุงุก","ุงูุตููุฏ ุฃูุงู ุงูุฃููุงุฌ ุงููููุฉ"],"a":2},
            {"q":"ููู ุชุชุฎูุต ุดุฌุฑุฉ ุงููุงูุฌุฑูู ูู ุงูููุญ ุงูุฒุงุฆุฏุ","c":["ุนู ุทุฑูู ุงูุฌุฐูุฑ ุงูุชู ุชูุฑุฒ ุงูููุญ","ุนู ุทุฑูู ุงูุฃูุฑุงู ุงูุชู ุชูุฑุฒ ุงูููุญ","ุนู ุทุฑูู ุงูุณุงู ุงูุชู ุชุฎุฒู ุงูููุญ"],"a":1},
            {"q":"ุฃูู ุชูุฌุฏ ุฃุดุฌุงุฑ ุงููุงูุฌุฑูู ุนุงุฏุฉุ","c":["ูู ุงูุตุญุงุฑู ุงูุญุงุฑุฉ","ุนูู ููู ุงูุฌุจุงู","ูู ููุงุทู ุงููุฏ ูุงูุฌุฒุฑ ุนูู ุงูุณูุงุญู"],"a":2},
            {"q":"ูุง ุฃูููุฉ ุฃุดุฌุงุฑ ุงููุงูุฌุฑูู ููุจูุฆุฉ ุงูุจุญุฑูุฉุ","c":["ุชุฒูุฏ ูููุญุฉ ุงูููุงู","ุชููุฑ ุจูุฆุฉ ุขููุฉ ูุชูุงุซุฑ ุงูุฃุณูุงู ูุงููุงุฆูุงุช ุงูุจุญุฑูุฉ","ุชููู ูู ูููุฉ ุงูุฃูุณุฌูู ูู ุงููุงุก"],"a":1},
            {"q":"ููู ุชุณุงุนุฏ ุฌุฐูุฑ ุงููุงูุฌุฑูู ุงูููุงุฆูุฉ ุงูุดุฌุฑุฉ ุนูู ุงูุชููุณุ","c":["ุชูุชุต ุงููุงุก ุงููุงูุญ ููุท","ุชุณูุญ ุจุชุจุงุฏู ุงูุบุงุฒุงุช ูู ุงูุชุฑุจุฉ ุงููููุฑุฉ ุจุงูุฃูุณุฌูู","ุชุฎุฒู ุงูุบุฐุงุก ููุชุฑุงุช ุงูุฌูุงู"],"a":1},
            {"q":"ูุง ูู ุงูุชูุฏูุฏ ุงูุฑุฆูุณู ูุฃุดุฌุงุฑ ุงููุงูุฌุฑููุ","c":["ุงูุญููุงูุงุช ุงูุจุฑูุฉ","ุงูุชููุซ ูุงููุทุน ุงูุฌุงุฆุฑ ูุงูุชูููุฉ ุงูุณุงุญููุฉ","ุฒูุงุฏุฉ ูุทูู ุงูุฃูุทุงุฑ"],"a":1}
        ];

        let game;
        let baseSpeed = 200;
        let scrollSpeed = 200;
        let player;
        let questionBoxGroup;
        let score = 0;
        let activeQuestion = null;
        let questionUI;
        let speedText;
        let wrongQuestions = [];
        let questionTimer = null;
        let stars = [];

        class GameScene extends Phaser.Scene {
            constructor(){ super({ key: 'GameScene' }); }

            preload(){
                // ูุง ููุงุฑุฏ ุฎุงุฑุฌูุฉ ูุทููุจุฉ
            }

            create(){
                // ุฎูููุฉ ุจุงูููู (ุจุณูุทุฉ) ููุฌูู ูุฏุงุฆุฑุฉ objects ูุญููุธุฉ ูู ูุตูููุฉ
                this.cameras.main.setBackgroundColor(0x0e1332);
                for (let i=0;i<100;i++){
                    const x = Phaser.Math.Between(0,800);
                    const y = Phaser.Math.Between(0,300);
                    const r = Phaser.Math.Between(1,3);
                    const c = this.add.circle(x,y,r,0xffffff, Phaser.Math.FloatBetween(0.15,0.9));
                    stars.push(c);
                }

                // ุฑุณู ุงูุทุฑูู (Graphics ููุท)
                const roadGraphics = this.add.graphics();
                roadGraphics.fillStyle(0x333333,1);
                roadGraphics.fillRect(0,500,800,100);
                roadGraphics.fillStyle(0xffffff,1);
                roadGraphics.fillRect(0,540,800,6);
                roadGraphics.fillStyle(0xf72585,1);
                roadGraphics.fillRect(0,500,800,6);
                roadGraphics.fillRect(0,594,800,6);

                // ุฅูุดุงุก ุงูุณูุงุฑุฉ (ููุท ุชูููุฏ ูุณูุฌ)
                const carG = this.make.graphics({});
                carG.fillStyle(0x4285f4,1);
                carG.fillRoundedRect(0,0,80,40,6);
                carG.fillStyle(0x3677ff,1);
                carG.fillRoundedRect(5,5,70,30,3);
                carG.fillStyle(0x222222,1);
                carG.fillCircle(15,35,6); carG.fillCircle(65,35,6);
                carG.fillStyle(0xffffff,0.6);
                carG.fillRect(25,10,30,15);
                carG.generateTexture('car',80,40);
                carG.destroy();

                player = this.physics.add.sprite(200,450,'car');
                player.setCollideWorldBounds(true);
                player.setImmovable(true);
                player.body.setAllowGravity(false);

                // ูุฌููุนุฉ ุตูุงุฏูู ุงูุฃุณุฆูุฉ ูุฌุณู ููุฒูุงุฆู (arcade group)
                questionBoxGroup = this.physics.add.group();
                questionBoxGroup.defaults = { immovable: true, allowGravity: false };

                // overlap ุจูู ุงูุณูุงุฑุฉ ููุฌููุนุฉ ุตูุงุฏูู ุงูุฃุณุฆูุฉ
                this.physics.add.overlap(player, questionBoxGroup, this.hitQuestionBox, null, this);

                // ูุต ุงูุณุฑุนุฉ ูุงูููุงุท (ุฏุงุฎู ูุงููุงุณ)
                speedText = this.add.text(20,20,`ุงูุณุฑุนุฉ: ${baseSpeed}`, { fontSize:'24px', fill:'#4cc9f0' });
                this.scoreText = this.add.text(20,60,`ุงูููุงุท: ${score}`, { fontSize:'24px', fill:'#f72585' });

                // ุญุฏุซ ุฏูุฑู ูุชูููุฏ ุตูุงุฏูู ุงูุฃุณุฆูุฉ
                this.time.addEvent({ delay:3000, callback:this.generateQuestionBox, callbackScope:this, loop:true });
                this.generateQuestionBox();

                scrollSpeed = baseSpeed;

                // ุฑุจุท ูุงุฌูุฉ ุงูุณุคุงู ูู DOM
                questionUI = document.getElementById('questionBox');
                document.getElementById('closeQuestion').addEventListener('click', ()=> { this.resumeGame(); });
            }

            update(time,delta){
                // ุชุญุฑูู ุงููุฌูู ุจุฎูุฉ
                const move = (scrollSpeed/500) * (delta/16.66);
                stars.forEach(s => {
                    s.x -= move;
                    if (s.x < -10) { s.x = 810; s.y = Phaser.Math.Between(0,300); }
                });

                // ุชุญุฑูู ุตูุงุฏูู ุงูุฃุณุฆูุฉ ูููู -> ูุณุงุฑ
                if (questionBoxGroup) {
                    questionBoxGroup.getChildren().forEach(box => {
                        box.x -= (scrollSpeed/60) * (delta/16.66);
                        box.body && box.body.reset && box.body.reset(box.x, box.y); // sync body if needed
                        if (box.x < -50) box.destroy();
                    });
                }

                // ุชุญุฏูุซ ูุต ุงูุณุฑุนุฉ ูุงูููุงุท
                speedText && speedText.setText(`ุงูุณุฑุนุฉ: ${Math.round(baseSpeed)}`);
                document.getElementById('speedValue').textContent = Math.round(baseSpeed);
                this.scoreText && this.scoreText.setText(`ุงูููุงุท: ${score}`);
            }

            createQuestionBoxSprite(x,y,questionData){
                // ูููุฏ ููุงุด (graphics) ููุญููู ููุณูุฌ ูุฑุฉ ูุงุญุฏุฉ ุฅุฐุง ูู ููู ููุฌูุฏุงู
                if (!this.textures.exists('questionBox')) {
                    const g = this.make.graphics({});
                    g.fillStyle(0xf72585,1); g.fillRoundedRect(0,0,50,50,6);
                    g.fillStyle(0xffffff,1); g.fillRoundedRect(5,5,40,40,3);
                    // ุนูุงูุฉ ุงุณุชููุงู ุจุณูุทุฉ
                    g.fillStyle(0x000000,1); g.fillCircle(25,18,6);
                    g.fillStyle(0xffffff,1); g.fillRect(24,27,2,6);
                    g.generateTexture('questionBox',50,50);
                    g.destroy();
                }

                const box = this.physics.add.sprite(x,y,'questionBox');
                box.setScale(0.9);
                box.body.setAllowGravity(false);
                box.body.immovable = true;
                box.setData('question', questionData);
                box.setData('used', false);
                return box;
            }

            generateQuestionBox(){
                let questionData;
                if (wrongQuestions.length > 0 && Math.random() < 0.4) {
                    questionData = wrongQuestions.shift();
                } else {
                    const idx = Phaser.Math.Between(0, allQuestions.length - 1);
                    questionData = allQuestions[idx];
                }

                const box = this.createQuestionBoxSprite(850, 520, questionData);
                questionBoxGroup.add(box);
            }

            hitQuestionBox(playerObj, box){
                if (box.getData('used')) return;
                box.setData('used', true);

                // ุฅููุงู ุงูุญุฑูุฉ ูุชุฌูุฏ ุงูููุฒูุงุก
                scrollSpeed = 0;
                this.physics.world.pause();

                activeQuestion = box.getData('question');
                this.showQuestion(activeQuestion);
            }

            showQuestion(questionData){
                document.getElementById('questionText').textContent = questionData.q;
                const optionsContainer = document.getElementById('optionsContainer');
                optionsContainer.innerHTML = '';

                questionData.c.forEach((opt, idx) => {
                    const el = document.createElement('div');
                    el.className = 'option';
                    el.textContent = `${idx+1}. ${opt}`;
                    el.dataset.index = idx;
                    el.addEventListener('click', () => {
                        this.checkAnswer(parseInt(el.dataset.index), questionData.a);
                        // ุชุนุทูู ุงูุชูุงุนู ูุชูููู
                        const all = optionsContainer.querySelectorAll('.option');
                        all.forEach(o=>{ o.classList.remove('correct','incorrect'); o.style.pointerEvents='none'; });
                        if (parseInt(el.dataset.index) === questionData.a) el.classList.add('correct');
                        else { el.classList.add('incorrect'); all[questionData.a].classList.add('correct'); }
                    });
                    optionsContainer.appendChild(el);
                });

                questionUI.style.display = 'block';
            }

            checkAnswer(selectedIndex, correctIndex){
                if (selectedIndex === correctIndex){
                    baseSpeed += 20;
                    score += 10;
                    this.removeUsedBoxes();
                    setTimeout(()=> this.resumeGame(), 1200);
                } else {
                    baseSpeed *= 0.6;
                    wrongQuestions.push(activeQuestion);
                    this.removeUsedBoxes();
                    setTimeout(()=> {
                        this.resumeGame();
                        if (questionTimer) clearTimeout(questionTimer);
                        questionTimer = setTimeout(()=> { this.generateWrongAppearance(activeQuestion); }, 5000);
                    }, 1800);
                }
            }

            removeUsedBoxes(){
                questionBoxGroup.getChildren().forEach(box=>{
                    if (box.getData('used')){
                        this.tweens.add({
                            targets: box,
                            y: box.y - 40,
                            alpha: 0,
                            duration: 400,
                            onComplete: ()=> box.destroy()
                        });
                    }
                });
            }

            generateWrongAppearance(questionData){
                const b = this.createQuestionBoxSprite(850, 520, questionData);
                questionBoxGroup.add(b);
                this.tweens.add({ targets: b, alpha: 0.4, yoyo:true, repeat:3, duration:400 });
            }

            resumeGame(){
                questionUI.style.display = 'none';
                // ุงุณุชุฆูุงู ููุฒูุงุก ุงููุนุจุฉ
                this.physics.world.resume();
                scrollSpeed = baseSpeed;
                // ุฅุนุงุฏุฉ ุชูููู ุฎูุงุฑุงุช DOM
                const options = document.querySelectorAll('.option');
                options.forEach(o => { o.classList.remove('correct','incorrect'); o.style.pointerEvents='auto'; });
            }
        }

        const config = {
            type: Phaser.CANVAS,
            width: 800,
            height: 600,
            parent: 'gameCanvas',
            physics: { default:'arcade', arcade:{ gravity:{ y:0 }, debug:false } },
            scene: GameScene
        };

        game = new Phaser.Game(config);

        // ุชุญูู ุจุณูุท ุจุงูููุจูุฑุฏ ูููู ุงูุณูุงุฑุฉ ุนููุฏูุงู (ูุนูู ุญุชู ูู ูุงูุช ุงูููุฒูุงุก ูุดุบูุฉ)
        document.addEventListener('keydown', (e) => {
            if (!player) return;
            if (e.key === 'ArrowUp' || e.key === 'w' || e.key === 'W') {
                player.y = Math.max(420, player.y - 20);
            } else if (e.key === 'ArrowDown' || e.key === 's' || e.key === 'S') {
                player.y = Math.min(520, player.y + 20);
            }
        });
    </script>
</body>
</html>
