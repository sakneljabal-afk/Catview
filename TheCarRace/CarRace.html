<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ù…ØªØ³Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø¹Ø±ÙØ© - Ø¹Ù„ÙˆÙ… Ø±Ø§Ø¨Ø¹Ø©</title>
<style>
body { 
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: linear-gradient(to bottom, #87CEEB, #E0F6FF);
    font-family: 'Cairo', Tahoma, Arial, sans-serif;
    touch-action: none;
    user-select: none;
    -webkit-user-select: none;
}

#gameContainer {
    width: 100vw;
    height: 100vh;
    position: relative;
    display: flex;
    flex-direction: column;
}

#header {
    width: 100%;
    padding: 10px 5px;
    text-align: center;
    font-weight: bold;
    font-size: 14px;
    color: #2b6fb3;
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    z-index: 100;
}

#gameArea {
    flex: 1;
    position: relative;
    overflow: hidden;
}

canvas {
    display: block;
    width: 100%;
    height: 100%;
}

#sidebar-left {
    position: absolute;
    right: 5px;
    top: 60px;
    width: 180px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
    background: rgba(240, 248, 255, 0.95);
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    backdrop-filter: blur(5px);
    font-size: 12px;
}

#sidebar-left h4 {
    text-align: center;
    margin: 0 0 10px 0;
    color: #2b6fb3;
    border-bottom: 2px solid #2b6fb3;
    padding-bottom: 5px;
    font-size: 13px;
}

.answered {
    margin-bottom: 6px;
    padding: 6px;
    background: #d1ffd1;
    border-radius: 5px;
    border-right: 3px solid #4CAF50;
    font-size: 11px;
    line-height: 1.3;
}

#sidebar-right {
    position: absolute;
    left: 5px;
    top: 60px;
    width: 150px;
    background: rgba(255, 240, 245, 0.95);
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    backdrop-filter: blur(5px);
    font-size: 12px;
}

#sidebar-right h4 {
    text-align: center;
    margin: 0 0 10px 0;
    color: #2b6fb3;
    border-bottom: 2px solid #2b6fb3;
    padding-bottom: 5px;
    font-size: 13px;
}

.game-info {
    margin: 8px 0;
    padding: 6px;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 5px;
    font-weight: bold;
    text-align: center;
    font-size: 11px;
}

#speedMeter {
    height: 15px;
    background: #ddd;
    border-radius: 8px;
    margin: 8px 0;
    overflow: hidden;
    border: 1px solid #aaa;
}

#speedFill {
    height: 100%;
    width: 50%;
    background: linear-gradient(to right, #4CAF50, #FFC107, #FF5722);
    border-radius: 8px;
    transition: width 0.5s;
}

#questionBox {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 25px rgba(0,0,0,0.4);
    width: 90%;
    max-width: 400px;
    display: none;
    z-index: 1000;
    border: 3px solid #2b6fb3;
}

#questionBox h3 {
    font-size: 16px;
    margin-bottom: 15px;
    color: #2b6fb3;
    line-height: 1.5;
    text-align: center;
}

.choice {
    background: #f0f0f0;
    padding: 12px;
    margin: 8px 0;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s;
    border: 2px solid transparent;
    text-align: center;
}

.choice:hover, .choice:active {
    background: #d0d0d0;
    transform: translateX(-3px);
    border-color: #2b6fb3;
}

.choice.correct {
    background: #d1ffd1;
    border-color: #4CAF50;
}

.choice.wrong {
    background: #ffd1d1;
    border-color: #ff5722;
}

#winScreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 200, 0, 0.95);
    color: white;
    font-size: 28px;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    display: none;
    z-index: 1001;
    text-align: center;
    padding: 20px;
}

#winScreen button {
    margin-top: 20px;
    padding: 12px 24px;
    font-size: 18px;
    background: white;
    color: #2b6fb3;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
}

/* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ø¬ÙˆØ§Ù„ */
#controls {
    position: absolute;
    bottom: 20px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    gap: 15px;
}

.control-btn {
    width: 70px;
    height: 70px;
    background: rgba(43, 111, 179, 0.8);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    color: white;
    cursor: pointer;
    user-select: none;
    border: 4px solid white;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    transition: all 0.1s;
}

.control-btn:active {
    transform: scale(0.95);
    background: rgba(43, 111, 179, 1);
}

#accelerateBtn {
    position: absolute;
    bottom: 100px;
    left: 20px;
    width: 80px;
    height: 80px;
    background: rgba(255, 87, 34, 0.9);
    font-size: 34px;
}

@media only screen and (max-width: 768px) {
    #sidebar-left, #sidebar-right {
        width: 140px;
        font-size: 11px;
    }
    
    #sidebar-left {
        right: 5px;
        top: 50px;
    }
    
    #sidebar-right {
        left: 5px;
        top: 50px;
    }
    
    .game-info {
        font-size: 10px;
        padding: 5px;
    }
    
    #controls {
        gap: 10px;
    }
    
    .control-btn {
        width: 65px;
        height: 65px;
        font-size: 26px;
    }
    
    #accelerateBtn {
        width: 75px;
        height: 75px;
        font-size: 32px;
        bottom: 90px;
        left: 15px;
    }
}

/* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
#startScreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, #87CEEB, #2b6fb3);
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 1002;
    text-align: center;
    padding: 20px;
}

#startScreen h1 {
    font-size: 36px;
    margin-bottom: 20px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

#startScreen p {
    font-size: 18px;
    margin-bottom: 30px;
    max-width: 600px;
    line-height: 1.6;
}

#startScreen button {
    padding: 15px 40px;
    font-size: 20px;
    background: white;
    color: #2b6fb3;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

.hidden {
    display: none !important;
}
</style>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
<div id="startScreen">
    <h1>ğŸš— Ù…ØªØ³Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø¹Ø±ÙØ© ğŸ§ </h1>
    <p>Ø§Ø®ØªØ± Ø³Ø±Ø¹ØªÙƒ ÙˆØ£Ø¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„ØªØ±ØªÙØ¹ Ø¯Ø±Ø¬ØªÙƒ!<br>
    Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± ğŸš€ Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©<br>
    Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø³Ù‡Ù… Ù„Ø¶Ø¨Ø· ØªÙˆØ§Ø²Ù† Ø§Ù„Ø³ÙŠØ§Ø±Ø©<br>
    ÙƒÙ„ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ØªØ²ÙŠØ¯ Ø³Ø±Ø¹ØªÙƒ!<br>
    <strong>Ø§Ù„Ù…Ø§Ø¯Ø©: Ø¹Ù„ÙˆÙ… Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</strong></p>
    <button onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
</div>

<div id="gameContainer" class="hidden">
    <div id="header">
        Ù…ØªØ³Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø¹Ø±ÙØ© - Ø¹Ù„ÙˆÙ… Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ
    </div>
    
    <div id="gameArea">
        <canvas id="gameCanvas"></canvas>
        
        <div id="sidebar-left">
            <h4>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©</h4>
            <div id="answeredList"></div>
        </div>
        
        <div id="sidebar-right">
            <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h4>
            <div class="game-info">Ø§Ù„Ø³Ø±Ø¹Ø©: <span id="currentSpeed">2</span></div>
            <div class="game-info">Ø§Ù„Ù†ØªÙŠØ¬Ø©: <span id="score">0</span></div>
            <div class="game-info">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="questionsRemaining">0</span></div>
            <div id="speedMeter">
                <div id="speedFill"></div>
            </div>
        </div>
        
        <div id="accelerateBtn" class="control-btn">ğŸš€</div>
        
        <div id="controls">
            <div class="control-btn" id="leftBtn">â†</div>
            <div class="control-btn" id="rightBtn">â†’</div>
        </div>
    </div>
</div>

<div id="questionBox">
    <h3 id="qText"></h3>
    <div id="choices"></div>
</div>

<div id="winScreen" class="hidden">
    ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©! ğŸ‰
    <div style="font-size: 20px; margin-top: 20px;">Ù†ØªÙŠØ¬ØªÙƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <span id="finalScore">0</span></div>
    <button onclick="restartGame()">Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
</div>

<script>
// ********** Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ù†ÙØ³ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©) **********
const allQuestions = [
    {
        "q": "ØªØ¹ÙŠØ´ Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ø§Ù†Ø¬Ø±ÙˆÙ ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ù…Ø§Ù„Ø­Ø©ØŒ ÙˆÙ„Ù‡Ø°Ø§ ØªÙ…ØªÙ„Ùƒ ØªÙƒÙŠÙØ§Ù‹ ØªØ±ÙƒÙŠØ¨ÙŠØ§Ù‹ Ù‡Ùˆ:",
        "c": [
            "Ø£ÙˆØ±Ø§Ù‚ Ø¹Ø±ÙŠØ¶Ø© ØªØ·ÙÙˆ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø§Ø¡",
            "Ø¬Ø°ÙˆØ± Ù‚ØµÙŠØ±Ø© Ø¶Ø¹ÙŠÙØ©",
            "Ø¬Ø°ÙˆØ± Ø·ÙˆÙŠÙ„Ø© ÙˆÙ‚ÙˆÙŠØ© Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„Ø£Ù…ÙˆØ§Ø¬"
        ],
        "a": 2
    },
    {
        "q": "Ù…Ø§ Ù‡ÙŠ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¬Ø°ÙˆØ± Ø§Ù„Ø·ÙˆÙŠÙ„Ø© ÙˆØ§Ù„Ù‚ÙˆÙŠØ© Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ø§Ù†Ø¬Ø±ÙˆÙØŸ",
        "c": [
            "ØªØ®Ø²ÙŠÙ† ÙƒÙ…ÙŠØ§Øª ÙƒØ¨ÙŠØ±Ø© Ù…Ù† Ø§Ù„Ù…Ø§Ø¡",
            "Ø§Ù…ØªØµØ§Øµ Ø§Ù„Ø¶ÙˆØ¡ Ù…Ù† Ø³Ø·Ø­ Ø§Ù„Ù…Ø§Ø¡",
            "Ø§Ù„ØµÙ…ÙˆØ¯ Ø£Ù…Ø§Ù… Ø§Ù„Ø£Ù…ÙˆØ§Ø¬ Ø§Ù„Ù‚ÙˆÙŠØ©"
        ],
        "a": 2
    },
    {
        "q": "Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªÙŠ ÙŠÙ†Ù…Ùˆ ÙÙŠÙ‡Ø§ Ù†Ø¨Ø§Øª Ø²Ù†Ø¨Ù‚ Ø§Ù„Ù…Ø§Ø¡ (Ø§Ù„Ù„ÙˆØªØ³) Ù‡ÙŠ Ø§Ù„Ù…Ø³ØªÙ†Ù‚Ø¹Ø§ØªØŒ ÙˆØªØªÙ…ÙŠØ² Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø¨Ù€:",
        "c": [
            "Ù…ÙŠØ§Ù‡ Ù…Ø§Ù„Ø­Ø© ÙˆØ£Ù…ÙˆØ§Ø¬ Ù‚ÙˆÙŠØ©",
            "ØªØ±Ø¨Ø© Ø¬Ø§ÙØ© ÙˆØ¯Ø±Ø¬Ø§Øª Ø­Ø±Ø§Ø±Ø© Ù…Ø±ØªÙØ¹Ø©",
            "Ù…ÙŠØ§Ù‡ Ø±Ø§ÙƒØ¯Ø© ÙˆÙƒÙ…ÙŠØ§Øª ÙƒØ¨ÙŠØ±Ø© Ù…Ù† Ø§Ù„Ø·ÙŠÙ†"
        ],
        "a": 2
    },
    {
        "q": "ÙŠÙ…ØªÙ„Ùƒ Ù†Ø¨Ø§Øª Ø²Ù†Ø¨Ù‚ Ø§Ù„Ù…Ø§Ø¡ Ø£ÙˆØ±Ø§Ù‚Ø§Ù‹ Ø¹Ø±ÙŠØ¶Ø© ØªØ·ÙÙˆ Ø¹Ù„Ù‰ Ø³Ø·Ø­ Ø§Ù„Ù…Ø§Ø¡ØŒ ÙˆÙ‡Ø°Ø§ Ø§Ù„ØªÙƒÙŠÙ Ø§Ù„ØªØ±ÙƒÙŠØ¨ÙŠ ÙŠØ³Ø§Ø¹Ø¯Ù‡ Ø¹Ù„Ù‰:",
        "c": [
            "Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„ØªÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø§Ø¦ÙŠØ©",
            "ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø§Ø¡ Ø§Ù„Ø²Ø§Ø¦Ø¯",
            "Ø§Ù…ØªØµØ§Øµ Ù‚Ø¯Ø± ÙƒØ¨ÙŠØ± Ù…Ù† Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³"
        ],
        "a": 2
    },
    {
        "q": "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªÙŠ ØªØªÙƒÙŠÙ Ø´Ø¬Ø±Ø© Ø§Ù„ØµÙ†ÙˆØ¨Ø± Ù„Ù„Ø¹ÙŠØ´ ÙÙŠÙ‡Ø§ØŸ",
        "c": [
            "Ø§Ù„Ù…Ø³ØªÙ†Ù‚Ø¹Ø§Øª Ø§Ù„Ù…Ø§Ø¦ÙŠØ©",
            "Ø§Ù„ØµØ­Ø§Ø±ÙŠ Ø§Ù„Ø¬Ø§ÙØ©",
            "Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø«Ù„Ø¬ÙŠØ© Ø´Ø¯ÙŠØ¯Ø© Ø§Ù„Ø¨Ø±ÙˆØ¯Ø©"
        ],
        "a": 2
    }
];

// ********** ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© **********
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ù„ÙˆØ­Ø©
function resizeCanvas() {
    const gameArea = document.getElementById('gameArea');
    canvas.width = gameArea.clientWidth;
    canvas.height = gameArea.clientHeight;
}

window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// ********** Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© **********
let gameState = 'playing';
let scrollSpeed = 2; // Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø£Ø¨Ø·Ø£)
let baseSpeed = 2;
let terrain = [];
let questionBoxes = [];
let answeredQuestions = new Set();
let currentQuestions = [...allQuestions];
let score = 0;
let currentQuestionBox = null;
let isAccelerating = false;

// Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø«Ø§Ø¨ØªØ© ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø§Ø´Ø©
const car = {
    x: canvas.width * 0.15, // Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø«Ø§Ø¨ØªØ© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±
    y: canvas.height / 2,
    width: 50,
    height: 25,
    tilt: 0,
    maxTilt: 25,
    color: '#FF5722',
    wheels: [
        { x: 8, y: 20, radius: 6 },
        { x: 42, y: 20, radius: 6 }
    ]
};

// ********** ØªÙˆÙ„ÙŠØ¯ ØªØ¶Ø§Ø±ÙŠØ³ Ù…ØªÙ†ÙˆØ¹Ø© **********
function generateTerrain() {
    terrain = [];
    let currentY = canvas.height * 0.6;
    let terrainType = 'flat';
    let segmentLength = 0;
    
    for (let x = 0; x < canvas.width * 3; x += 20) {
        // ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³ Ø¨Ø´ÙƒÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
        if (segmentLength <= 0) {
            const types = ['flat', 'hill', 'mountain', 'valley'];
            terrainType = types[Math.floor(Math.random() * types.length)];
            segmentLength = 50 + Math.random() * 100;
        }
        
        // Ø­Ø³Ø§Ø¨ Y Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³
        switch(terrainType) {
            case 'flat':
                currentY += (Math.random() - 0.5) * 3;
                break;
            case 'hill':
                currentY = canvas.height * 0.5 + Math.sin(x * 0.02) * 30;
                break;
            case 'mountain':
                currentY = canvas.height * 0.4 + Math.sin(x * 0.015) * 60;
                break;
            case 'valley':
                currentY = canvas.height * 0.7 + Math.sin(x * 0.025) * 40;
                break;
        }
        
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¨Ù‚Ø§Ø¡ Y Ø¶Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯
        currentY = Math.max(canvas.height * 0.4, Math.min(canvas.height * 0.8, currentY));
        
        terrain.push({ x, y: currentY });
        segmentLength--;
    }
}

// ********** Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ© **********
function drawBackground() {
    // Ø§Ù„Ø³Ù…Ø§Ø¡
    const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    skyGradient.addColorStop(0, '#87CEEB');
    skyGradient.addColorStop(1, '#E0F6FF');
    ctx.fillStyle = skyGradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Ø³Ø­Ø¨ Ø¨Ø¹ÙŠØ¯Ø©
    drawClouds();
    
    // Ø¬Ø¨Ø§Ù„ Ø¨Ø¹ÙŠØ¯Ø©
    drawDistantMountains();
}

function drawClouds() {
    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
    const time = Date.now() * 0.0001;
    
    for (let i = 0; i < 3; i++) {
        const x = (canvas.width + (car.x * 0.1) + i * 200 + time * 20) % (canvas.width + 400) - 200;
        const y = 30 + i * 40;
        
        ctx.beginPath();
        ctx.arc(x, y, 25, 0, Math.PI * 2);
        ctx.arc(x + 30, y - 10, 30, 0, Math.PI * 2);
        ctx.arc(x + 60, y, 25, 0, Math.PI * 2);
        ctx.arc(x + 30, y + 10, 20, 0, Math.PI * 2);
        ctx.fill();
    }
}

function drawDistantMountains() {
    ctx.fillStyle = 'rgba(100, 100, 150, 0.3)';
    
    for (let i = 0; i < 5; i++) {
        const xStart = (car.x * 0.05 + i * 300) % (canvas.width + 400) - 200;
        const height = 100 + Math.sin(i) * 30;
        
        ctx.beginPath();
        ctx.moveTo(xStart, canvas.height * 0.6);
        for (let j = 0; j < 10; j++) {
            const x = xStart + j * 40;
            const y = canvas.height * 0.6 - height * Math.sin(j * 0.3) * (1 - j * 0.1);
            ctx.lineTo(x, y);
        }
        ctx.lineTo(xStart + 400, canvas.height * 0.6);
        ctx.closePath();
        ctx.fill();
    }
}

// ********** Ø±Ø³Ù… Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³ **********
function drawTerrain() {
    if (terrain.length < 2) return;
    
    // Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    ctx.beginPath();
    ctx.moveTo(terrain[0].x, terrain[0].y);
    
    for (let i = 1; i < terrain.length; i++) {
        ctx.lineTo(terrain[i].x, terrain[i].y);
    }
    
    // Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø´ÙƒÙ„
    ctx.lineTo(terrain[terrain.length-1].x, canvas.height);
    ctx.lineTo(terrain[0].x, canvas.height);
    ctx.closePath();
    
    // ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ Ù„Ù„ØªØ¶Ø§Ø±ÙŠØ³
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#8BC34A');
    gradient.addColorStop(0.8, '#689F38');
    gradient.addColorStop(1, '#558B2F');
    ctx.fillStyle = gradient;
    ctx.fill();
    
    // ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³
    ctx.strokeStyle = '#558B2F';
    ctx.lineWidth = 2;
    ctx.stroke();
    
    // Ø¹Ø´Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø·Ø­
    drawGrass();
}

function drawGrass() {
    ctx.strokeStyle = '#7CB342';
    ctx.lineWidth = 1;
    
    for (let i = 0; i < terrain.length; i += 5) {
        if (terrain[i].x > -20 && terrain[i].x < canvas.width + 20) {
            const height = 5 + Math.sin(terrain[i].x * 0.1) * 3;
            ctx.beginPath();
            ctx.moveTo(terrain[i].x, terrain[i].y);
            ctx.lineTo(terrain[i].x, terrain[i].y - height);
            ctx.stroke();
        }
    }
}

// ********** Ø±Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© **********
function drawCar() {
    ctx.save();
    
    // Ù†Ù‚Ù„ ÙˆÙ†Ù‚Ù„ Ø¥Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    ctx.translate(car.x, car.y);
    ctx.rotate(car.tilt * Math.PI / 180);
    
    // Ø¬Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    ctx.fillStyle = car.color;
    ctx.fillRect(-car.width/2, -car.height/2, car.width, car.height);
    
    // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    ctx.fillStyle = '#333';
    ctx.fillRect(-car.width/2 + 5, -car.height/2 + 3, 15, 8); // Ù†Ø§ÙØ°Ø© Ø£Ù…Ø§Ù…ÙŠØ©
    ctx.fillRect(-car.width/2 + 25, -car.height/2 + 3, 15, 8); // Ù†Ø§ÙØ°Ø© Ø®Ù„ÙÙŠØ©
    
    // Ø£Ø¶ÙˆØ§Ø¡
    ctx.fillStyle = '#FFEB3B';
    ctx.fillRect(-car.width/2 - 2, -car.height/2 + 8, 4, 6); // Ø¶ÙˆØ¡ Ø£Ù…Ø§Ù…ÙŠ
    
    // Ø§Ù„Ø¹Ø¬Ù„Ø§Øª
    ctx.fillStyle = '#333';
    car.wheels.forEach(wheel => {
        ctx.beginPath();
        ctx.arc(wheel.x - car.width/2, wheel.y - car.height/2, wheel.radius, 0, Math.PI * 2);
        ctx.fill();
        
        // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø¬Ù„Ø©
        ctx.fillStyle = '#666';
        ctx.beginPath();
        ctx.arc(wheel.x - car.width/2, wheel.y - car.height/2, wheel.radius * 0.5, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#333';
    });
    
    ctx.restore();
}

// ********** Ø±Ø³Ù… ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© **********
function drawQuestionBoxes() {
    questionBoxes.forEach(box => {
        // ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø³Ø¤Ø§Ù„
        ctx.fillStyle = box.answered ? '#4CAF50' : '#FFC107';
        ctx.fillRect(box.x, box.y, box.width, box.height);
        
        // Ø­Ø¯ÙˆØ¯ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
        ctx.strokeStyle = box.answered ? '#2E7D32' : '#FF9800';
        ctx.lineWidth = 2;
        ctx.strokeRect(box.x, box.y, box.width, box.height);
        
        // Ø¹Ù„Ø§Ù…Ø© Ø§Ø³ØªÙÙ‡Ø§Ù…
        ctx.fillStyle = 'white';
        ctx.font = 'bold 18px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('?', box.x + box.width/2, box.y + box.height/2);
        
        // ØªØ£Ø«ÙŠØ± Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…ÙƒØ±Ø±
        if (box.isRepeat) {
            ctx.shadowColor = '#FF5722';
            ctx.shadowBlur = 10;
            ctx.strokeStyle = '#FF5722';
            ctx.lineWidth = 3;
            ctx.strokeRect(box.x - 2, box.y - 2, box.width + 4, box.height + 4);
            ctx.shadowBlur = 0;
        }
    });
}

// ********** ØªÙˆÙ„ÙŠØ¯ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© **********
function generateQuestionBoxes() {
    questionBoxes = [];
    
    currentQuestions.forEach((question, index) => {
        // ÙˆØ¶Ø¹ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø¹Ù„Ù‰ Ù…Ø³Ø§ÙØ§Øª Ù…Ù†ØªØ¸Ù…Ø©
        const spacing = canvas.width * 1.5 / currentQuestions.length;
        const baseX = canvas.width + index * spacing;
        
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³
        for (let j = 0; j < terrain.length - 1; j++) {
            if (terrain[j].x >= baseX && terrain[j].x < baseX + 100) {
                const box = {
                    x: terrain[j].x,
                    y: terrain[j].y - 35,
                    width: 25,
                    height: 25,
                    question: question,
                    answered: false,
                    isRepeat: false
                };
                questionBoxes.push(box);
                break;
            }
        }
    });
}

// ********** Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø© **********
const keys = {};

// Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³ Ù„Ù„Ø¬ÙˆØ§Ù„
const leftBtn = document.getElementById('leftBtn');
const rightBtn = document.getElementById('rightBtn');
const accelerateBtn = document.getElementById('accelerateBtn');

leftBtn.addEventListener('touchstart', (e) => {
    e.preventDefault();
    keys['ArrowLeft'] = true;
});

leftBtn.addEventListener('touchend', (e) => {
    e.preventDefault();
    keys['ArrowLeft'] = false;
});

rightBtn.addEventListener('touchstart', (e) => {
    e.preventDefault();
    keys['ArrowRight'] = true;
});

rightBtn.addEventListener('touchend', (e) => {
    e.preventDefault();
    keys['ArrowRight'] = false;
});

accelerateBtn.addEventListener('touchstart', (e) => {
    e.preventDefault();
    isAccelerating = true;
});

accelerateBtn.addEventListener('touchend', (e) => {
    e.preventDefault();
    isAccelerating = false;
});

// ********** ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø¹Ø¨Ø© **********
function updateGame() {
    if (gameState !== 'playing') return;
    
    // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    if (keys['ArrowLeft']) {
        car.tilt = Math.max(car.tilt - 2, -car.maxTilt);
    } else if (keys['ArrowRight']) {
        car.tilt = Math.min(car.tilt + 2, car.maxTilt);
    } else {
        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠØ© Ù„Ù„ØªÙˆØ§Ø²Ù†
        if (car.tilt > 0) car.tilt = Math.max(0, car.tilt - 1);
        else if (car.tilt < 0) car.tilt = Math.min(0, car.tilt + 1);
    }
    
    // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø³Ø±Ø¹Ø©
    if (isAccelerating) {
        scrollSpeed = Math.min(baseSpeed + 1, 5); // Ø³Ø±Ø¹Ø© Ù…Ø­Ø¯ÙˆØ¯Ø©
    } else {
        scrollSpeed = Math.max(baseSpeed, 1);
    }
    
    // ØªØ­Ø±ÙŠÙƒ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³ ÙˆØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    terrain.forEach(point => {
        point.x -= scrollSpeed * 0.8; // Ø³Ø±Ø¹Ø© Ø£Ø¨Ø·Ø£ Ù„Ù„Ø®Ù„ÙÙŠØ©
    });
    
    questionBoxes.forEach(box => {
        box.x -= scrollSpeed * 0.8;
    });
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ Ø®Ø±Ø¬Øª Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©
    terrain = terrain.filter(point => point.x > -100);
    questionBoxes = questionBoxes.filter(box => box.x > -100);
    
    // Ø¥Ø¶Ø§ÙØ© ØªØ¶Ø§Ø±ÙŠØ³ Ø¬Ø¯ÙŠØ¯Ø©
    while (terrain[terrain.length - 1].x < canvas.width * 3) {
        const lastPoint = terrain[terrain.length - 1];
        const newX = lastPoint.x + 20;
        
        // ØªÙˆÙ„ÙŠØ¯ ØªØ¶Ø§Ø±ÙŠØ³ Ù…ØªÙ†ÙˆØ¹Ø©
        let newY = lastPoint.y + (Math.random() - 0.5) * 8;
        newY = Math.max(canvas.height * 0.4, Math.min(canvas.height * 0.8, newY));
        
        terrain.push({ x: newX, y: newY });
    }
    
    // ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³
    updateCarPosition();
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù…
    checkCollisions();
    
    updateUI();
}

function updateCarPosition() {
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³ ØªØ­Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    for (let i = 0; i < terrain.length - 1; i++) {
        if (terrain[i].x <= car.x && terrain[i+1].x >= car.x) {
            const progress = (car.x - terrain[i].x) / (terrain[i+1].x - terrain[i].x);
            const groundY = terrain[i].y + (terrain[i+1].y - terrain[i].y) * progress;
            car.y = groundY - car.height/2 - 5;
            break;
        }
    }
}

function checkCollisions() {
    for (let i = 0; i < questionBoxes.length; i++) {
        const box = questionBoxes[i];
        
        if (!box.answered && 
            car.x < box.x + box.width &&
            car.x + car.width > box.x &&
            car.y < box.y + box.height &&
            car.y + car.height > box.y) {
            
            currentQuestionBox = box;
            showQuestion(box.question);
            return;
        }
    }
}

// ********** Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ **********
function showQuestion(question) {
    gameState = 'paused';
    
    const qb = document.getElementById("questionBox");
    document.getElementById("qText").textContent = question.q;
    
    const choicesDiv = document.getElementById("choices");
    choicesDiv.innerHTML = "";
    
    // Ø®Ù„Ø· Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
    const choices = [...question.c];
    const shuffled = [];
    while (choices.length) {
        const idx = Math.floor(Math.random() * choices.length);
        shuffled.push(choices.splice(idx, 1)[0]);
    }
    
    shuffled.forEach((choice, index) => {
        const originalIndex = question.c.indexOf(choice);
        const choiceDiv = document.createElement("div");
        choiceDiv.className = "choice";
        choiceDiv.textContent = choice;
        choiceDiv.onclick = () => handleAnswer(originalIndex, question, choiceDiv);
        choicesDiv.appendChild(choiceDiv);
    });
    
    qb.style.display = "block";
}

// ********** Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© **********
function handleAnswer(selectedIndex, question, choiceElement) {
    const isCorrect = selectedIndex === question.a;
    
    if (isCorrect) {
        // Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
        choiceElement.classList.add('correct');
        
        // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±Ø¹Ø©
        baseSpeed = Math.min(4, baseSpeed + 0.3);
        
        // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©
        score += 10;
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
        answeredQuestions.add(question.q);
        addToAnsweredList(question);
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const index = currentQuestions.findIndex(q => q.q === question.q);
        if (index > -1) {
            currentQuestions.splice(index, 1);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
        if (currentQuestionBox) {
            currentQuestionBox.answered = true;
        }
        
        setTimeout(() => {
            document.getElementById("questionBox").style.display = "none";
            gameState = 'playing';
            currentQuestionBox = null;
            
            if (currentQuestions.length === 0) {
                endGame();
            }
        }, 1000);
        
    } else {
        // Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©
        choiceElement.classList.add('wrong');
        
        // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¹Ø© Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ±
        baseSpeed = Math.max(1, baseSpeed * 0.6);
        
        // Ø¥Ù†Ø´Ø§Ø¡ ØµÙ†Ø¯ÙˆÙ‚ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ù‡Ø¯
        createRepeatQuestionBox(question);
        
        setTimeout(() => {
            document.getElementById("questionBox").style.display = "none";
            gameState = 'playing';
            currentQuestionBox = null;
        }, 1500);
    }
    
    updateUI();
}

function createRepeatQuestionBox(question) {
    // ÙˆØ¶Ø¹ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ù…Ø±Ø¦ÙŠ
    const lastVisibleX = canvas.width + 200;
    
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³
    let terrainY = canvas.height * 0.6;
    for (let i = 0; i < terrain.length; i++) {
        if (terrain[i].x >= lastVisibleX) {
            terrainY = terrain[i].y;
            break;
        }
    }
    
    const repeatBox = {
        x: lastVisibleX,
        y: terrainY - 35,
        width: 25,
        height: 25,
        question: question,
        answered: false,
        isRepeat: true
    };
    
    questionBoxes.push(repeatBox);
}

function addToAnsweredList(question) {
    const answeredList = document.getElementById("answeredList");
    const div = document.createElement("div");
    div.className = "answered";
    div.textContent = question.q;
    answeredList.appendChild(div);
    answeredList.scrollTop = answeredList.scrollHeight;
}

// ********** ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… **********
function updateUI() {
    document.getElementById("currentSpeed").textContent = baseSpeed.toFixed(1);
    document.getElementById("score").textContent = score;
    document.getElementById("questionsRemaining").textContent = currentQuestions.length;
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø±Ø¹Ø©
    const speedPercent = (baseSpeed / 4) * 100;
    document.getElementById("speedFill").style.width = `${speedPercent}%`;
}

// ********** Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© **********
function endGame() {
    gameState = 'gameOver';
    document.getElementById("finalScore").textContent = score;
    document.getElementById("winScreen").classList.remove("hidden");
}

// ********** Ø§Ù„Ø±Ø³Ù… **********
function draw() {
    // Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Ø´Ø©
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ©
    drawBackground();
    
    // Ø±Ø³Ù… Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³
    drawTerrain();
    
    // Ø±Ø³Ù… ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    drawQuestionBoxes();
    
    // Ø±Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    drawCar();
}

// ********** Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© **********
function gameLoop() {
    updateGame();
    draw();
    requestAnimationFrame(gameLoop);
}

// ********** Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© **********
function startGame() {
    document.getElementById("startScreen").classList.add("hidden");
    document.getElementById("gameContainer").classList.remove("hidden");
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©
    gameState = 'playing';
    baseSpeed = 2;
    score = 0;
    currentQuestions = [...allQuestions];
    answeredQuestions.clear();
    
    document.getElementById("answeredList").innerHTML = "";
    document.getElementById("winScreen").classList.add("hidden");
    
    generateTerrain();
    generateQuestionBoxes();
    updateUI();
    
    gameLoop();
}

function restartGame() {
    document.getElementById("winScreen").classList.add("hidden");
    startGame();
}

// Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('load', () => {
    // Ù„Ø§ Ù†Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ù†Ù†ØªØ¸Ø± Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
});
</script>
</body>
</html>
