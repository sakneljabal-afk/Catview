<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„Ø¹Ø¨Ø© Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ø²Ù…Ù† - Mobile Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body {
            background: linear-gradient(to bottom, #87CEEB, #E0F6FF);
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            color: #333;
            touch-action: none;
        }
        
        #game-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            margin: 0 auto;
            max-width: 1000px;
            width: 100%;
            height: 100%;
        }
        
        #game-canvas {
            display: block;
            background-color: #87CEEB;
            width: 100%;
            height: 100%;
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        
        #hud {
            position: absolute;
            top: 10px;
            width: 100%;
            padding: 0 15px;
            display: flex;
            justify-content: space-between;
            z-index: 10;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 1px 1px 2px white;
            pointer-events: none;
        }
        
        #score {
            background-color: rgba(255, 255, 255, 0.85);
            padding: 8px 15px;
            border-radius: 10px;
            border: 2px solid #8B4513;
            min-width: 120px;
            text-align: center;
        }
        
        #lives {
            display: flex;
            gap: 8px;
            background-color: rgba(255, 255, 255, 0.85);
            padding: 8px 15px;
            border-radius: 10px;
            border: 2px solid #8B4513;
        }
        
        .heart {
            color: #FF4757;
            font-size: 22px;
        }
        
        #controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 10;
        }
        
        .d-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 5px;
            width: 150px;
            height: 150px;
        }
        
        .control-btn {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            border: 2px solid white;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            border-radius: 10px;
            transition: all 0.1s;
        }
        
        .control-btn:active {
            background-color: rgba(255, 255, 255, 0.8);
            color: black;
            transform: scale(0.95);
        }
        
        #up-btn {
            grid-column: 2;
            grid-row: 1;
        }
        
        #left-btn {
            grid-column: 1;
            grid-row: 2;
        }
        
        #right-btn {
            grid-column: 3;
            grid-row: 2;
        }
        
        #down-btn {
            grid-column: 2;
            grid-row: 3;
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: flex-end;
        }
        
        .action-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            font-size: 32px;
            border: 3px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            transition: all 0.1s;
        }
        
        #jump-btn {
            background-color: rgba(46, 204, 113, 0.9);
        }
        
        #attack-btn {
            background-color: rgba(231, 76, 60, 0.9);
        }
        
        .action-btn:active {
            transform: scale(0.9);
            opacity: 0.8;
        }
        
        #touch-joystick-area {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 180px;
            height: 180px;
            z-index: 5;
            display: none;
        }
        
        #touch-joystick {
            position: absolute;
            width: 70px;
            height: 70px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            border: 3px solid white;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: transform 0.1s;
        }
        
        #start-screen, #question-screen, #game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #1a2980, #26d0ce);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            text-align: center;
            padding: 20px;
        }
        
        #question-screen, #game-over-screen {
            background: linear-gradient(to bottom, #2c3e50, #3498db);
            display: none;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 3px 3px 5px rgba(0, 0, 0, 0.5);
            color: #FFD700;
        }
        
        h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #FFD700;
        }
        
        p {
            font-size: 1.2rem;
            margin-bottom: 20px;
            max-width: 800px;
            line-height: 1.6;
        }
        
        .character-select {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .character {
            width: 90px;
            height: 110px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .character.selected {
            border-color: #FFD700;
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        
        .character-icon {
            font-size: 40px;
            margin-bottom: 8px;
        }
        
        .character-name {
            font-size: 0.9rem;
        }
        
        .btn {
            background-color: #FFD700;
            color: #333;
            border: none;
            padding: 12px 30px;
            font-size: 1.3rem;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 15px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            touch-action: manipulation;
        }
        
        .btn:active {
            background-color: #FFC300;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        .question {
            font-size: 1.5rem;
            margin-bottom: 25px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            max-width: 800px;
        }
        
        .answers {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            max-width: 800px;
            margin-bottom: 25px;
        }
        
        .answer-btn {
            background-color: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 15px;
            font-size: 1.1rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            touch-action: manipulation;
        }
        
        .answer-btn:active {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(0.98);
        }
        
        #result-message {
            font-size: 1.8rem;
            margin: 15px 0;
            font-weight: bold;
            min-height: 50px;
        }
        
        .correct {
            color: #2ecc71;
        }
        
        .wrong {
            color: #e74c3c;
        }
        
        #instructions {
            margin-top: 20px;
            font-size: 1rem;
            background-color: rgba(0, 0, 0, 0.2);
            padding: 12px;
            border-radius: 10px;
            max-width: 800px;
        }
        
        .control-options {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .control-option {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .control-option.selected {
            border-color: #FFD700;
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        #game-over-message {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #FFD700;
        }
        
        #final-score {
            font-size: 1.8rem;
            margin-bottom: 25px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px 30px;
            border-radius: 15px;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.6rem;
            }
            
            .d-pad {
                width: 130px;
                height: 130px;
            }
            
            .control-btn {
                font-size: 24px;
            }
            
            .action-btn {
                width: 70px;
                height: 70px;
                font-size: 28px;
            }
            
            .question {
                font-size: 1.3rem;
            }
            
            .answers {
                grid-template-columns: 1fr;
            }
            
            #touch-joystick-area {
                width: 150px;
                height: 150px;
            }
            
            #touch-joystick {
                width: 60px;
                height: 60px;
            }
            
            #hud {
                font-size: 16px;
            }
            
            #score, #lives {
                padding: 6px 12px;
            }
        }
        
        @media (max-width: 480px) {
            .d-pad {
                width: 110px;
                height: 110px;
            }
            
            .action-btn {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
            
            #controls {
                padding: 0 15px;
                bottom: 15px;
            }
            
            .character {
                width: 80px;
                height: 95px;
            }
            
            .character-icon {
                font-size: 35px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        
        <div id="hud">
            <div id="score">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
            <div id="lives">
                <span class="heart">â¤ï¸</span>
                <span class="heart">â¤ï¸</span>
                <span class="heart">â¤ï¸</span>
            </div>
        </div>
        
        <!-- Ù…Ù†Ø·Ù‚Ø© Ø¬ÙˆÙŠØ³ØªÙŠÙƒ Ø§Ù„Ù„Ù…Ø³ (Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† ÙŠÙØ¶Ù„ÙˆÙ† Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø³Ø­Ø¨) -->
        <div id="touch-joystick-area">
            <div id="touch-joystick"></div>
        </div>
        
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div id="controls">
            <div class="d-pad">
                <div id="up-btn" class="control-btn">â¬†ï¸</div>
                <div id="left-btn" class="control-btn">â¬…ï¸</div>
                <div id="right-btn" class="control-btn">â¡ï¸</div>
                <div id="down-btn" class="control-btn">â¬‡ï¸</div>
            </div>
            
            <div class="action-buttons">
                <div id="jump-btn" class="action-btn">â¬†ï¸</div>
                <div id="attack-btn" class="action-btn">âš”ï¸</div>
            </div>
        </div>
        
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
        <div id="start-screen">
            <h1>Ù„Ø¹Ø¨Ø© Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ø²Ù…Ù†</h1>
            <p>Ø§Ù‡Ù„Ø§ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© ØªØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ø²Ù…Ù†! Ø§Ø¬Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨ØªØ­Ø·ÙŠÙ… Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ ÙˆØ£Ø¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„ØªØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©</p>
            
            <div class="character-select">
                <div class="character selected" data-character="mario">
                    <div class="character-icon">ğŸ‘¨</div>
                    <div class="character-name">Ù…Ø§Ø±ÙŠÙˆ</div>
                </div>
                <div class="character" data-character="aladdin">
                    <div class="character-icon">ğŸ§</div>
                    <div class="character-name">Ø¹Ù„Ø§Ø¡ Ø§Ù„Ø¯ÙŠÙ†</div>
                </div>
                <div class="character" data-character="rambo">
                    <div class="character-icon">ğŸ’ª</div>
                    <div class="character-name">Ø±Ø§Ù…Ø¨Ùˆ</div>
                </div>
            </div>
            
            <div class="control-options">
                <div class="control-option selected" data-control="buttons">
                    Ø£Ø²Ø±Ø§Ø± ØªØ­ÙƒÙ…
                </div>
                <div class="control-option" data-control="joystick">
                    Ø¬ÙˆÙŠØ³ØªÙŠÙƒ Ù„Ù…Ø³
                </div>
            </div>
            
            <button id="start-btn" class="btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
            
            <div id="instructions">
                <strong>ÙƒÙŠÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨:</strong><br>
                - Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø±ÙƒØ© Ù„Ù„ØªØ­Ø±Ùƒ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª<br>
                - Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„Ù‚ÙØ² Ù„Ù„Ù‚ÙØ² ÙÙˆÙ‚ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª<br>
                - Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„Ù‡Ø¬ÙˆÙ… Ù„ØªØ­Ø·ÙŠÙ… Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚<br>
                - Ø¹Ù†Ø¯Ù…Ø§ ØªØ­Ø·Ù… ØµÙ†Ø¯ÙˆÙ‚Ù‹Ø§ØŒ Ø³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„ ÙŠØ¬Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„ÙŠÙ‡
            </div>
        </div>
        
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
        <div id="question-screen">
            <h2>Ø³Ø¤Ø§Ù„!</h2>
            <div id="question" class="question"></div>
            <div id="answers" class="answers"></div>
            <div id="result-message"></div>
            <button id="continue-btn" class="btn" style="display: none;">Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>
        
        <!-- Ø´Ø§Ø´Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
        <div id="game-over-screen">
            <h2>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!</h2>
            <div id="game-over-message"></div>
            <div id="final-score">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: 0</div>
            <button id="restart-btn" class="btn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
            <button id="menu-btn" class="btn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
        </div>
    </div>

    <script>
        // Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('start-screen');
        const questionScreen = document.getElementById('question-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const scoreElement = document.getElementById('score');
        const livesElement = document.getElementById('lives');
        const questionElement = document.getElementById('question');
        const answersElement = document.getElementById('answers');
        const resultMessage = document.getElementById('result-message');
        const continueBtn = document.getElementById('continue-btn');
        const gameOverMessage = document.getElementById('game-over-message');
        const finalScoreElement = document.getElementById('final-score');
        const restartBtn = document.getElementById('restart-btn');
        const menuBtn = document.getElementById('menu-btn');
        const touchJoystickArea = document.getElementById('touch-joystick-area');
        const touchJoystick = document.getElementById('touch-joystick');
        
        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
        const upBtn = document.getElementById('up-btn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');
        const downBtn = document.getElementById('down-btn');
        const jumpBtn = document.getElementById('jump-btn');
        const attackBtn = document.getElementById('attack-btn');
        const startBtn = document.getElementById('start-btn');
        
        // Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ­ÙƒÙ…
        let controlType = 'buttons'; // 'buttons' Ø£Ùˆ 'joystick'
        const controlOptions = document.querySelectorAll('.control-option');
        
        controlOptions.forEach(option => {
            option.addEventListener('click', () => {
                controlOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                controlType = option.getAttribute('data-control');
                
                // ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
                if (controlType === 'joystick') {
                    document.getElementById('controls').style.display = 'none';
                    touchJoystickArea.style.display = 'block';
                } else {
                    document.getElementById('controls').style.display = 'flex';
                    touchJoystickArea.style.display = 'none';
                }
            });
        });
        
        // Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø©
        function resizeCanvas() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø®ØµÙŠØ©
        let selectedCharacter = 'mario';
        document.querySelectorAll('.character').forEach(character => {
            character.addEventListener('click', () => {
                document.querySelectorAll('.character').forEach(c => c.classList.remove('selected'));
                character.classList.add('selected');
                selectedCharacter = character.getAttribute('data-character');
            });
        });
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        let gameRunning = false;
        let score = 0;
        let lives = 3;
        let player = {};
        let boxes = [];
        let platforms = [];
        let keys = {};
        let currentQuestion = null;
        let questionActive = false;
        let lastTime = 0;
        let deltaTime = 0;
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¬ÙˆÙŠØ³ØªÙŠÙƒ Ø§Ù„Ù„Ù…Ø³
        let joystickActive = false;
        let joystickStartX = 0;
        let joystickStartY = 0;
        let joystickCurrentX = 0;
        let joystickCurrentY = 0;
        let joystickRadius = 60;
        
        // Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯)
        const questions = [
            {
                question: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ù…ØµØ±ØŸ",
                answers: ["Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©", "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©", "Ø§Ù„Ø¬ÙŠØ²Ø©", "Ø£Ø³ÙˆØ§Ù†"],
                correct: 0
            },
            {
                question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£ÙˆØ¬Ù‡ Ø§Ù„Ù…ÙƒØ¹Ø¨ØŸ",
                answers: ["4", "6", "8", "12"],
                correct: 1
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„ÙƒÙˆÙƒØ¨ Ø§Ù„Ø£Ø­Ù…Ø±ØŸ",
                answers: ["Ø§Ù„Ø£Ø±Ø¶", "Ø§Ù„Ù…Ø±ÙŠØ®", "Ø§Ù„Ù…Ø´ØªØ±ÙŠ", "Ø§Ù„Ø²Ù‡Ø±Ø©"],
                correct: 1
            },
            {
                question: "Ù…Ø§ Ù‡ÙŠ Ø£ÙƒØ¨Ø± Ù‚Ø§Ø±Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ",
                answers: ["Ø£ÙØ±ÙŠÙ‚ÙŠØ§", "Ø£ÙˆØ±ÙˆØ¨Ø§", "Ø¢Ø³ÙŠØ§", "Ø£Ù…Ø±ÙŠÙƒØ§ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©"],
                correct: 2
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠ Ø§Ù„Ø°ÙŠ Ø±Ù…Ø²Ù‡ OØŸ",
                answers: ["Ø°Ù‡Ø¨", "Ø£ÙƒØ³Ø¬ÙŠÙ†", "Ø­Ø¯ÙŠØ¯", "ÙØ¶Ø©"],
                correct: 1
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø§Ù„ÙˆØ·Ù†ÙŠ Ù„Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§ØŸ",
                answers: ["Ø§Ù„ÙƒÙ†ØºØ±", "Ø§Ù„Ø¯Ø¨", "Ø§Ù„Ù†Ù…Ø±", "Ø§Ù„ÙÙŠÙ„"],
                correct: 0
            },
            {
                question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ØŸ",
                answers: ["5", "6", "7", "8"],
                correct: 2
            }
        ];
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        function initGame() {
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨
            player = {
                x: canvas.width * 0.1,
                y: canvas.height * 0.7,
                width: 40,
                height: 60,
                velocityX: 0,
                velocityY: 0,
                speed: 6,
                jumpPower: 16,
                isJumping: false,
                isAttacking: false,
                attackTime: 0,
                character: selectedCharacter,
                color: selectedCharacter === 'mario' ? '#E52521' : 
                       selectedCharacter === 'aladdin' ? '#F9C80E' : '#8B4513',
                facingRight: true
            };
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚
            boxes = [];
            for (let i = 0; i < 10; i++) {
                boxes.push({
                    x: canvas.width * 0.2 + (i % 5) * 80,
                    y: canvas.height * 0.5 - Math.floor(i / 5) * 90,
                    width: 50,
                    height: 50,
                    broken: false,
                    type: Math.floor(Math.random() * 3) // 0: Ø³Ø¤Ø§Ù„ØŒ 1: Ù†Ù‚Ø§Ø·ØŒ 2: Ø­ÙŠØ§Ø©
                });
            }
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù†ØµØ§Øª
            platforms = [
                {x: 0, y: canvas.height * 0.85, width: canvas.width, height: 25},
                {x: canvas.width * 0.2, y: canvas.height * 0.65, width: 140, height: 20},
                {x: canvas.width * 0.6, y: canvas.height * 0.55, width: 140, height: 20},
                {x: canvas.width * 0.4, y: canvas.height * 0.45, width: 140, height: 20},
                {x: canvas.width * 0.1, y: canvas.height * 0.35, width: 120, height: 20}
            ];
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ­ÙƒÙ…
            keys = {
                up: false,
                down: false,
                left: false,
                right: false,
                jump: false,
                attack: false
            };
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ø­ÙŠØ§Ø©
            score = 0;
            lives = 3;
            updateHUD();
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø§Ø´Ø§Øª
            startScreen.style.display = 'none';
            questionScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            gameRunning = true;
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ÙˆÙ‚Øª
            lastTime = performance.now();
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            requestAnimationFrame(gameLoop);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
        function updateHUD() {
            scoreElement.textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}`;
            
            const hearts = livesElement.querySelectorAll('.heart');
            hearts.forEach((heart, index) => {
                heart.style.opacity = index < lives ? '1' : '0.3';
            });
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        function setupButtonControls() {
            // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø±ÙƒØ©
            const movementButtons = [upBtn, downBtn, leftBtn, rightBtn];
            
            movementButtons.forEach(button => {
                button.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const direction = button.id.replace('-btn', '');
                    keys[direction] = true;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù„Ø§Ø¹Ø¨
                    if (direction === 'left') player.facingRight = false;
                    if (direction === 'right') player.facingRight = true;
                });
                
                button.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    const direction = button.id.replace('-btn', '');
                    keys[direction] = false;
                });
                
                // Ø¥Ø¶Ø§ÙØ© Ø¯Ø¹Ù… Ù„Ù„Ù†Ù‚Ø± Ø¨Ø§Ù„ÙØ£Ø±Ø© Ø£ÙŠØ¶Ù‹Ø§ (Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨)
                button.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    const direction = button.id.replace('-btn', '');
                    keys[direction] = true;
                    
                    if (direction === 'left') player.facingRight = false;
                    if (direction === 'right') player.facingRight = true;
                });
                
                button.addEventListener('mouseup', (e) => {
                    e.preventDefault();
                    const direction = button.id.replace('-btn', '');
                    keys[direction] = false;
                });
            });
            
            // Ø²Ø± Ø§Ù„Ù‚ÙØ²
            jumpBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!player.isJumping) {
                    player.velocityY = -player.jumpPower;
                    player.isJumping = true;
                }
                keys.jump = true;
            });
            
            jumpBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                keys.jump = false;
            });
            
            jumpBtn.addEventListener('mousedown', (e) => {
                e.preventDefault();
                if (!player.isJumping) {
                    player.velocityY = -player.jumpPower;
                    player.isJumping = true;
                }
                keys.jump = true;
            });
            
            jumpBtn.addEventListener('mouseup', (e) => {
                e.preventDefault();
                keys.jump = false;
            });
            
            // Ø²Ø± Ø§Ù„Ù‡Ø¬ÙˆÙ…
            attackBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!player.isAttacking) {
                    player.isAttacking = true;
                    player.attackTime = 15;
                    checkAttack();
                }
                keys.attack = true;
            });
            
            attackBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                keys.attack = false;
            });
            
            attackBtn.addEventListener('mousedown', (e) => {
                e.preventDefault();
                if (!player.isAttacking) {
                    player.isAttacking = true;
                    player.attackTime = 15;
                    checkAttack();
                }
                keys.attack = true;
            });
            
            attackBtn.addEventListener('mouseup', (e) => {
                e.preventDefault();
                keys.attack = false;
            });
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬ÙˆÙŠØ³ØªÙŠÙƒ Ø§Ù„Ù„Ù…Ø³
        function setupJoystickControls() {
            touchJoystickArea.addEventListener('touchstart', handleJoystickStart);
            touchJoystickArea.addEventListener('touchmove', handleJoystickMove);
            touchJoystickArea.addEventListener('touchend', handleJoystickEnd);
            
            // Ø¯Ø¹Ù… Ø§Ù„Ù…Ø§ÙˆØ³ Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨
            touchJoystickArea.addEventListener('mousedown', handleJoystickStart);
            document.addEventListener('mousemove', handleJoystickMove);
            document.addEventListener('mouseup', handleJoystickEnd);
            
            // Ø²Ø± Ø§Ù„Ù‚ÙØ² ÙˆØ§Ù„Ù‡Ø¬ÙˆÙ… ÙŠØ¸Ù„Ø§Ù† ÙŠØ¹Ù…Ù„Ø§Ù†
            jumpBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!player.isJumping) {
                    player.velocityY = -player.jumpPower;
                    player.isJumping = true;
                }
                keys.jump = true;
            });
            
            jumpBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                keys.jump = false;
            });
            
            attackBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!player.isAttacking) {
                    player.isAttacking = true;
                    player.attackTime = 15;
                    checkAttack();
                }
                keys.attack = true;
            });
            
            attackBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                keys.attack = false;
            });
        }
        
        function handleJoystickStart(e) {
            e.preventDefault();
            joystickActive = true;
            
            const touch = e.touches ? e.touches[0] : e;
            const rect = touchJoystickArea.getBoundingClientRect();
            
            joystickStartX = rect.left + rect.width / 2;
            joystickStartY = rect.top + rect.height / 2;
            
            joystickCurrentX = touch.clientX;
            joystickCurrentY = touch.clientY;
            
            updateJoystickPosition();
            updateJoystickInput();
        }
        
        function handleJoystickMove(e) {
            if (!joystickActive) return;
            e.preventDefault();
            
            const touch = e.touches ? e.touches[0] : e;
            joystickCurrentX = touch.clientX;
            joystickCurrentY = touch.clientY;
            
            updateJoystickPosition();
            updateJoystickInput();
        }
        
        function handleJoystickEnd(e) {
            if (!joystickActive) return;
            e.preventDefault();
            
            joystickActive = false;
            joystickCurrentX = joystickStartX;
            joystickCurrentY = joystickStartY;
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¬ÙˆÙŠØ³ØªÙŠÙƒ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø±ÙƒØ²
            touchJoystick.style.transform = `translate(-50%, -50%)`;
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø­Ø±ÙƒØ©
            keys.left = false;
            keys.right = false;
            keys.up = false;
            keys.down = false;
        }
        
        function updateJoystickPosition() {
            const rect = touchJoystickArea.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ù…Ø±ÙƒØ²
            let deltaX = joystickCurrentX - centerX;
            let deltaY = joystickCurrentY - centerY;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø­Ø±ÙƒØ©
            if (distance > joystickRadius) {
                deltaX = (deltaX / distance) * joystickRadius;
                deltaY = (deltaY / distance) * joystickRadius;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ÙˆÙŠØ³ØªÙŠÙƒ Ø§Ù„Ù…Ø±Ø¦ÙŠ
            touchJoystick.style.transform = `translate(calc(-50% + ${deltaX}px), calc(-50% + ${deltaY}px))`;
        }
        
        function updateJoystickInput() {
            const rect = touchJoystickArea.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª
            const deltaX = joystickCurrentX - centerX;
            const deltaY = joystickCurrentY - centerY;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            keys.left = false;
            keys.right = false;
            keys.up = false;
            keys.down = false;
            
            if (distance > 20) { // Ø¹ØªØ¨Ø© Ù„Ù„Ø­Ø±ÙƒØ©
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø£ÙÙ‚ÙŠ
                if (deltaX < -20) {
                    keys.left = true;
                    player.facingRight = false;
                } else if (deltaX > 20) {
                    keys.right = true;
                    player.facingRight = true;
                }
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø±Ø£Ø³ÙŠ (Ù„Ù„Ù‚ÙØ² Ø£Ùˆ Ø§Ù„Ù†Ø²ÙˆÙ„)
                if (deltaY < -30) {
                    keys.up = true;
                    if (!player.isJumping) {
                        player.velocityY = -player.jumpPower;
                        player.isJumping = true;
                    }
                } else if (deltaY > 30) {
                    keys.down = true;
                }
            }
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡Ø¬ÙˆÙ…
        function checkAttack() {
            if (!player.isAttacking) return;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ù„Ù„ØªØ­Ø·ÙŠÙ…
            for (let box of boxes) {
                if (!box.broken) {
                    // Ø­Ø³Ø§Ø¨ Ù…Ø³Ø§ÙØ© Ø§Ù„Ù‡Ø¬ÙˆÙ… (Ø£Ù…Ø§Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨)
                    const attackX = player.facingRight ? player.x + player.width : player.x - 30;
                    const attackY = player.y + player.height / 2;
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØµØ§Ø¯Ù…
                    if (attackX > box.x && attackX < box.x + box.width &&
                        attackY > box.y && attackY < box.y + box.height) {
                        
                        // ØªØ­Ø·ÙŠÙ… Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
                        box.broken = true;
                        
                        if (box.type === 0) { // ØµÙ†Ø¯ÙˆÙ‚ Ø³Ø¤Ø§Ù„
                            showQuestion();
                        } else if (box.type === 1) { // ØµÙ†Ø¯ÙˆÙ‚ Ù†Ù‚Ø§Ø·
                            score += 50;
                            updateHUD();
                        } else if (box.type === 2) { // ØµÙ†Ø¯ÙˆÙ‚ Ø­ÙŠØ§Ø©
                            lives = Math.min(3, lives + 1);
                            updateHUD();
                        }
                    }
                }
            }
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        startBtn.addEventListener('click', () => {
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
            if (controlType === 'buttons') {
                setupButtonControls();
                document.getElementById('controls').style.display = 'flex';
                touchJoystickArea.style.display = 'none';
            } else {
                setupJoystickControls();
                document.getElementById('controls').style.display = 'none';
                touchJoystickArea.style.display = 'block';
            }
            
            initGame();
        });
        
        // Ø¹Ø±Ø¶ Ø³Ø¤Ø§Ù„
        function showQuestion() {
            gameRunning = false;
            questionActive = true;
            
            // Ø§Ø®ØªÙŠØ§Ø± Ø³Ø¤Ø§Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
            currentQuestion = questions[Math.floor(Math.random() * questions.length)];
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„
            questionElement.textContent = currentQuestion.question;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
            answersElement.innerHTML = '';
            currentQuestion.answers.forEach((answer, index) => {
                const button = document.createElement('div');
                button.className = 'answer-btn';
                button.textContent = answer;
                button.addEventListener('click', () => checkAnswer(index));
                answersElement.appendChild(button);
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
            questionScreen.style.display = 'flex';
            resultMessage.textContent = '';
            continueBtn.style.display = 'none';
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        function checkAnswer(selectedIndex) {
            if (currentQuestion.correct === selectedIndex) {
                resultMessage.textContent = "Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! +100 Ù†Ù‚Ø·Ø©";
                resultMessage.className = "correct";
                score += 100;
                updateHUD();
            } else {
                resultMessage.textContent = "Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©! -1 Ø­ÙŠØ§Ø©";
                resultMessage.className = "wrong";
                lives--;
                updateHUD();
                
                if (lives <= 0) {
                    resultMessage.textContent += " - Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!";
                }
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
            continueBtn.style.display = 'block';
        }
        
        // Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø¤Ø§Ù„
        continueBtn.addEventListener('click', () => {
            if (lives <= 0) {
                // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
                gameOver();
                return;
            }
            
            questionScreen.style.display = 'none';
            questionActive = false;
            gameRunning = true;
            lastTime = performance.now();
            requestAnimationFrame(gameLoop);
        });
        
        // Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø¹Ø¨Ø©
        function gameLoop(currentTime) {
            if (!gameRunning) return;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ù‚Ø¶ÙŠ
            deltaTime = (currentTime - lastTime) / 1000; // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø«ÙˆØ§Ù†ÙŠ
            lastTime = currentTime;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ±
            updatePlayer(deltaTime);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‡Ø¬ÙˆÙ…
            if (player.isAttacking) {
                player.attackTime--;
                if (player.attackTime <= 0) {
                    player.isAttacking = false;
                }
            }
            
            // Ø§Ù„Ù…Ø³Ø­ ÙˆØ§Ù„Ø±Ø³Ù…
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ©
            drawBackground();
            
            // Ø±Ø³Ù… Ø§Ù„Ù…Ù†ØµØ§Øª
            drawPlatforms();
            
            // Ø±Ø³Ù… Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚
            drawBoxes();
            
            // Ø±Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨
            drawPlayer();
            
            // Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø­Ù„Ù‚Ø©
            requestAnimationFrame(gameLoop);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨
        function updatePlayer(dt) {
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©
            player.velocityY += 35 * dt; // Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©
            
            // Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø£ÙÙ‚ÙŠØ©
            let moveX = 0;
            if (keys.left) moveX -= player.speed;
            if (keys.right) moveX += player.speed;
            
            player.velocityX = moveX;
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³Ø±Ø¹Ø© Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ù‚Ø¶ÙŠ
            player.x += player.velocityX * dt * 60;
            player.y += player.velocityY * dt;
            
            // Ù…Ù†Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… Ù…Ø¹ Ø§Ù„Ù…Ù†ØµØ§Øª
            player.isJumping = true;
            for (let platform of platforms) {
                if (player.x < platform.x + platform.width &&
                    player.x + player.width > platform.x &&
                    player.y + player.height > platform.y &&
                    player.y + player.height < platform.y + 30 &&
                    player.velocityY > 0) {
                    
                    player.y = platform.y - player.height;
                    player.velocityY = 0;
                    player.isJumping = false;
                }
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆÙ‚ÙˆØ¹ Ø®Ø§Ø±Ø¬ Ø§Ù„Ø´Ø§Ø´Ø©
            if (player.y > canvas.height) {
                lives--;
                updateHUD();
                
                if (lives <= 0) {
                    gameOver();
                } else {
                    player.x = canvas.width * 0.1;
                    player.y = canvas.height * 0.7;
                    player.velocityX = 0;
                    player.velocityY = 0;
                }
            }
        }
        
        // Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ©
        function drawBackground() {
            // Ø§Ù„Ø³Ù…Ø§Ø¡
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Ø§Ù„Ø³Ø­Ø¨
            ctx.fillStyle = 'white';
            for (let i = 0; i < 3; i++) {
                const x = (canvas.width / 4) * (i + 1);
                const y = canvas.height * 0.2 + Math.sin(Date.now() / 2000 + i) * 10;
                
                ctx.beginPath();
                ctx.arc(x - 30, y, 25, 0, Math.PI * 2);
                ctx.arc(x, y - 15, 30, 0, Math.PI * 2);
                ctx.arc(x + 30, y, 25, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Ø§Ù„Ø£Ø±Ø¶
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, canvas.height * 0.85, canvas.width, canvas.height * 0.15);
            
            // Ø§Ù„Ø¹Ø´Ø¨
            ctx.fillStyle = '#2E8B57';
            ctx.fillRect(0, canvas.height * 0.85, canvas.width, 10);
        }
        
        // Ø±Ø³Ù… Ø§Ù„Ù…Ù†ØµØ§Øª
        function drawPlatforms() {
            ctx.fillStyle = '#8B4513';
            platforms.forEach(platform => {
                // Ø¬Ø³Ù… Ø§Ù„Ù…Ù†ØµØ©
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                
                // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ©
                ctx.fillStyle = '#A0522D';
                for (let i = 0; i < platform.width / 20; i++) {
                    ctx.fillRect(platform.x + i * 20, platform.y, 15, 5);
                }
                
                ctx.fillStyle = '#8B4513';
            });
        }
        
        // Ø±Ø³Ù… Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚
        function drawBoxes() {
            boxes.forEach(box => {
                if (box.broken) {
                    // Ø±Ø³Ù… Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø­Ø·Ù…
                    ctx.fillStyle = '#654321';
                    ctx.fillRect(box.x, box.y, box.width, box.height);
                    
                    // Ø±Ø³Ù… Ø´Ø±Ø® ÙÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
                    ctx.strokeStyle = '#8B4513';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(box.x + 10, box.y + 10);
                    ctx.lineTo(box.x + box.width - 10, box.y + box.height - 10);
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(box.x + box.width - 10, box.y + 10);
                    ctx.lineTo(box.x + 10, box.y + box.height - 10);
                    ctx.stroke();
                } else {
                    // Ø±Ø³Ù… Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø³Ù„ÙŠÙ…
                    ctx.fillStyle = box.type === 0 ? '#FFD700' : 
                                    box.type === 1 ? '#1E90FF' : '#32CD32';
                    ctx.fillRect(box.x, box.y, box.width, box.height);
                    
                    // Ø±Ø³Ù… Ø­Ø¯ÙˆØ¯ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
                    ctx.strokeStyle = '#8B4513';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(box.x, box.y, box.width, box.height);
                    
                    // Ø±Ø³Ù… ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                    ctx.fillRect(box.x + 5, box.y + 5, box.width - 10, 10);
                    
                    // Ø±Ø³Ù… Ø±Ù…Ø² Ø¹Ù„Ù‰ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 20px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    const symbol = box.type === 0 ? '?' : 
                                   box.type === 1 ? '50' : 'â™¥';
                    ctx.fillText(symbol, box.x + box.width/2, box.y + box.height/2 + 5);
                }
            });
        }
        
        // Ø±Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨
        function drawPlayer() {
            // Ø¬Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            // ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚ÙØ² (Ø¸Ù„)
            if (player.isJumping) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                ctx.fillRect(player.x + 5, player.y + player.height, player.width - 10, 10);
            }
            
            // Ø±Ø£Ø³ Ø§Ù„Ù„Ø§Ø¹Ø¨
            ctx.fillStyle = '#FFE4C4';
            ctx.beginPath();
            ctx.arc(player.x + player.width/2, player.y + 15, 15, 0, Math.PI * 2);
            ctx.fill();
            
            // Ø¹ÙŠÙˆÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(player.x + player.width/2 - (player.facingRight ? 5 : -5), player.y + 12, 3, 0, Math.PI * 2);
            ctx.arc(player.x + player.width/2 + (player.facingRight ? 5 : -5), player.y + 12, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // ÙÙ… Ø§Ù„Ù„Ø§Ø¹Ø¨
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(player.x + player.width/2, player.y + 18, 5, 0, Math.PI);
            ctx.stroke();
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠÙ‡Ø§Ø¬Ù…ØŒ Ø±Ø³Ù… Ø³Ù„Ø§Ø­
            if (player.isAttacking) {
                ctx.strokeStyle = '#C0C0C0';
                ctx.lineWidth = 4;
                ctx.beginPath();
                
                if (player.facingRight) {
                    ctx.moveTo(player.x + player.width, player.y + player.height/2);
                    ctx.lineTo(player.x + player.width + 40, player.y + player.height/2 - 20);
                } else {
                    ctx.moveTo(player.x, player.y + player.height/2);
                    ctx.lineTo(player.x - 40, player.y + player.height/2 - 20);
                }
                ctx.stroke();
                
                ctx.fillStyle = '#FFD700';
                ctx.beginPath();
                if (player.facingRight) {
                    ctx.arc(player.x + player.width + 40, player.y + player.height/2 - 20, 8, 0, Math.PI * 2);
                } else {
                    ctx.arc(player.x - 40, player.y + player.height/2 - 20, 8, 0, Math.PI * 2);
                }
                ctx.fill();
            }
        }
        
        // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
        function gameOver() {
            gameRunning = false;
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø´Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
            gameOverMessage.textContent = lives <= 0 ? "Ù„Ù‚Ø¯ Ø®Ø³Ø±Øª!" : "ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ ÙØ²Øª!";
            finalScoreElement.textContent = `Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${score}`;
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
            gameOverScreen.style.display = 'flex';
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        restartBtn.addEventListener('click', () => {
            initGame();
        });
        
        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
        menuBtn.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            startScreen.style.display = 'flex';
        });
        
        // ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ©
        updateHUD();
    </script>
</body>
</html>
