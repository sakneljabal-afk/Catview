<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© (Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù…Ù†ØµØ§Øª)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <style>
        body { margin: 0; padding: 0; background-color: #f0f0f0; overflow: hidden; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© Ù„Ù„Ø³Ø¤Ø§Ù„ */
        #question-modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© ÙˆØ¬Ø°Ø§Ø¨Ø© */
            z-index: 10;
            justify-content: center;
            align-items: center;
            font-family: 'Arial', sans-serif;
            color: white;
            text-align: center;
        }
        .q-container {
            background: #2c3e50; /* Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ Ø¯Ø§ÙƒÙ† */
            border-radius: 15px;
            padding: 30px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 0 30px rgba(52, 152, 219, 0.7); /* Ø¸Ù„ Ù…Ø¶ÙŠØ¡ */
            border: 3px solid #3498db;
        }
        #q-text {
            font-size: 20px;
            margin-bottom: 25px;
            color: #ecf0f1; /* Ø£Ø¨ÙŠØ¶ Ù†Ø§ØµØ¹ */
        }
        .option-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background 0.3s, transform 0.1s;
        }
        .option-button:hover {
            background: #2980b9;
            transform: translateY(-2px); /* ØªØ£Ø«ÙŠØ± Ø¶ØºØ· Ù„Ø·ÙŠÙ */
        }
    </style>
</head>
<body>

    <div id="game-container"></div>

    <div id="question-modal">
        <div class="q-container">
            <h3 id="q-text">Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§</h3>
            <button class="option-button" id="option-0"></button>
            <button class="option-button" id="option-1"></button>
            <button class="option-button" id="option-2"></button>
        </div>
    </div>

    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø«Ø§Ø¨ØªØ© (Ø³Ù†Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Supabase Ù„Ø§Ø­Ù‚Ø§Ù‹)
        const CURRENT_QUESTION = { 
            q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªÙƒÙŠÙ Ø§Ù„ØªØ±ÙƒÙŠØ¨ÙŠ Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ø§Ù†Ø¬Ø±ÙˆÙ Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„Ø£Ù…ÙˆØ§Ø¬ØŸ", 
            o: ["Ø£ÙˆØ±Ø§Ù‚ ØªØ·ÙÙˆ", "Ø¬Ø°ÙˆØ± Ù‚ØµÙŠØ±Ø©", "Ø¬Ø°ÙˆØ± Ø·ÙˆÙŠÙ„Ø© ÙˆÙ‚ÙˆÙŠØ©"], 
            a: 2 // Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø« (ÙÙ‡Ø±Ø³ 2)
        };

        // ====================================================================
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        // ====================================================================

        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 480,
            parent: 'game-container',
            scale: {
                mode: Phaser.Scale.FIT,
                autoCenter: Phaser.Scale.CENTER_BOTH
            },
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 600 }, // Ù‚ÙˆØ© Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©
                    debug: false // Ø§Ø¬Ø¹Ù„Ù‡Ø§ true Ù„Ø±Ø¤ÙŠØ© Ø­Ø¯ÙˆØ¯ Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        const game = new Phaser.Game(config);

        let player;
        let platforms;
        let questionBlock;
        let cursors;
        let touchControls; 

        // ====================================================================
        // ğŸš€ 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆÙ„ (PRELOAD)
        // ====================================================================

        function preload() {
            // Ø£ØµÙˆÙ„ Ù…Ø¬Ø§Ù†ÙŠØ© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©
            this.load.image('sky', 'https://labs.phaser.io/assets/skies/space3.png'); // Ø®Ù„ÙÙŠØ© Ø¬Ø°Ø§Ø¨Ø©
            this.load.image('ground', 'https://labs.phaser.io/assets/platform.png'); // Ø£Ø±Ø¶ÙŠØ©
            this.load.image('block', 'https://labs.phaser.io/assets/sprites/block.png'); // ÙƒØªÙ„Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
            
            // Ø¨Ø·Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø© (Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø«Ø§Ù„ Ø¨Ø³ÙŠØ·)
            this.load.spritesheet('dude', 'https://labs.phaser.io/assets/sprites/dude.png', { frameWidth: 32, frameHeight: 48 });
            
            // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… (Ù„Ù„Ù…Ø³)
            this.load.image('button_left', 'https://labs.phaser.io/assets/buttons/left-button.png');
            this.load.image('button_right', 'https://labs.phaser.io/assets/buttons/right-button.png');
            this.load.image('button_up', 'https://labs.phaser.io/assets/buttons/up-button.png');
        }

        // ====================================================================
        // ğŸ—ï¸ 2. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù„Ù… (CREATE)
        // ====================================================================

        function create() {
            // 1. Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¬Ø°Ø§Ø¨Ø©
            this.add.image(400, 300, 'sky').setScale(2);

            // 2. Ø§Ù„Ø£Ø±Ø¶ÙŠØ§Øª (Platforms)
            platforms = this.physics.add.staticGroup();
            
            // Ø§Ù„Ø£Ø±Ø¶ÙŠØ© Ø§Ù„Ø³ÙÙ„ÙŠØ© Ø§Ù„Ø«Ø§Ø¨ØªØ©
            platforms.create(400, 480 - 32, 'ground').setScale(2).refreshBody(); 
            // Ù…Ù†ØµØ§Øª Ù‚ÙØ² Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
            platforms.create(500, 300, 'ground');
            platforms.create(50, 250, 'ground');
            platforms.create(750, 220, 'ground');

            // 3. ÙƒØªÙ„Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ (Question Block)
            questionBlock = platforms.create(600, 150, 'block');
            questionBlock.setTint(0xff8800); // Ù„ÙˆÙ† Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù…Ù…ÙŠØ²
            questionBlock.body.immovable = true; 
            
            // 4. Ø§Ù„Ù„Ø§Ø¹Ø¨ (Player)
            player = this.physics.add.sprite(100, 400, 'dude');
            player.setBounce(0.2); 
            player.setCollideWorldBounds(true); 

            // Ø¥Ø¶Ø§ÙØ© Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø±ÙƒØ¶ ÙˆØ§Ù„Ù‚ÙØ² (Ù„Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¨ØµØ±ÙŠ)
            this.anims.create({ key: 'left', frames: this.anims.generateFrameNumbers('dude', { start: 0, end: 3 }), frameRate: 10, repeat: -1 });
            this.anims.create({ key: 'turn', frames: [{ key: 'dude', frame: 4 }], frameRate: 20 });
            this.anims.create({ key: 'right', frames: this.anims.generateFrameNumbers('dude', { start: 5, end: 8 }), frameRate: 10, repeat: -1 });

            // 5. Ø§Ù„ØªØµØ§Ø¯Ù…Ø§Øª
            this.physics.add.collider(player, platforms);

            // 6. Ø§Ù„ØªØ­ÙƒÙ… (Keyboard & Touch)
            cursors = this.input.keyboard.createCursorKeys();
            
            // 7. Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³ (Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© Ø§Ù„Ø¨ØµØ±ÙŠØ© ÙÙŠ Ø§Ù„Ù€ UI)
            createTouchControls(this);
            
            // 8. Ø¥Ø¶Ø§ÙØ© ÙƒØ§Ø´Ù Ø§Ù„ØªØµØ§Ø¯Ù… Ø¨ÙŠÙ† Ø±Ø£Ø³ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙˆÙƒØªÙ„Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
            this.physics.world.on('collide', (object1, object2) => {
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† player Ù‡Ùˆ object1 ÙˆØ£Ù† block Ù‡Ùˆ object2
                if (object1 === player && object2 === questionBlock) {
                    handleBlockHit.call(this, player, questionBlock); // Ø§Ø³ØªØ®Ø¯Ø§Ù… .call(this) Ù„ØªÙ…Ø±ÙŠØ± Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø´Ù‡Ø¯
                }
            });

        }

        // ====================================================================
        // âš™ï¸ 3. Ø§Ù„Ø­Ø±ÙƒØ© ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ« (UPDATE)
        // ====================================================================

        function update() {
            handleMovement();
        }

        function handleMovement() {
            const velocityX = 160;

            // Ø­Ø±ÙƒØ© Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ÙˆØ§Ù„Ù„Ù…Ø³
            if (cursors.left.isDown || (touchControls && touchControls.left.isDown)) {
                player.setVelocityX(-velocityX);
                player.anims.play('left', true);
            } else if (cursors.right.isDown || (touchControls && touchControls.right.isDown)) {
                player.setVelocityX(velocityX);
                player.anims.play('right', true);
            } else {
                player.setVelocityX(0);
                player.anims.play('turn');
            }

            // Ø§Ù„Ù‚ÙØ²
            if ((cursors.up.isDown || (touchControls && touchControls.up.isDown)) && player.body.touching.down) {
                player.setVelocityY(-400);
            }
        }

        // ====================================================================
        // ğŸ•¹ï¸ 4. Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³ (Touch Controls)
        // ====================================================================

        function createTouchControls(scene) {
            touchControls = {
                left: { isDown: false },
                right: { isDown: false },
                up: { isDown: false }
            };
            
            // Ø²Ø± Ø§Ù„ÙŠØ³Ø§Ø±
            let leftBtn = scene.add.image(50, scene.scale.height - 50, 'button_left')
                .setScrollFactor(0)
                .setInteractive()
                .setAlpha(0.7) 
                .setDepth(10)
                .on('pointerdown', () => touchControls.left.isDown = true)
                .on('pointerup', () => touchControls.left.isDown = false)
                .on('pointerout', () => touchControls.left.isDown = false);
                
            // Ø²Ø± Ø§Ù„ÙŠÙ…ÙŠÙ†
            let rightBtn = scene.add.image(120, scene.scale.height - 50, 'button_right')
                .setScrollFactor(0)
                .setInteractive()
                .setAlpha(0.7)
                .setDepth(10)
                .on('pointerdown', () => touchControls.right.isDown = true)
                .on('pointerup', () => touchControls.right.isDown = false)
                .on('pointerout', () => touchControls.right.isDown = false);

            // Ø²Ø± Ø§Ù„Ù‚ÙØ²
            let upBtn = scene.add.image(scene.scale.width - 50, scene.scale.height - 50, 'button_up')
                .setScrollFactor(0)
                .setInteractive()
                .setAlpha(0.7)
                .setDepth(10)
                .on('pointerdown', () => touchControls.up.isDown = true)
                .on('pointerup', () => touchControls.up.isDown = false)
                .on('pointerout', () => touchControls.up.isDown = false);
        }

        // ====================================================================
        // â“ 5. Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ ÙƒØªÙ„Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
        // ====================================================================

        function handleBlockHit(player, block) {
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„ (Ø±Ø£Ø³ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙŠØ¶Ø±Ø¨ Ø§Ù„ÙƒØªÙ„Ø©)
            if (player.body.touching.up && block.body.touching.down) {
                
                // Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¶Ø±Ø¨Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø±ØªØ¯Ø§Ø¯
                if (!block.canBeHit) return;
                block.canBeHit = false;
                
                player.body.velocity.y = 0; 
                
                // Ù…Ø¤Ø«Ø± Ø¨ØµØ±ÙŠ: Ø§Ø±ØªØ¯Ø§Ø¯ Ø§Ù„ÙƒØªÙ„Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰
                this.tweens.add({
                    targets: block,
                    y: block.y - 10, 
                    duration: 100,
                    yoyo: true, 
                    onComplete: () => {
                        block.setTint(0x555555); // ÙŠØµØ¨Ø­ Ù„ÙˆÙ†Ù‡ Ø¯Ø§ÙƒÙ†Ø§Ù‹ Ù„Ù„Ø¥Ø´Ø§Ø±Ø© Ù„ÙƒÙˆÙ†Ù‡ ÙØ§Ø±ØºØ§Ù‹
                        displayQuestionModal(CURRENT_QUESTION);
                    }
                });
            }
        }


        function displayQuestionModal(questionData) {
            const modal = document.getElementById('question-modal');
            document.getElementById('q-text').textContent = questionData.q;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ÙˆØªØ¬Ù‡ÙŠØ²Ù‡Ø§
            questionData.o.forEach((optionText, index) => {
                const btn = document.getElementById(`option-${index}`);
                btn.textContent = optionText;
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù‚Ø¨Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                btn.style.backgroundColor = '#3498db'; 
                btn.onclick = () => checkAnswer(index, questionData.a, modal);
            });

            modal.style.display = 'flex'; 
            game.scene.scenes[0].physics.pause(); // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø©
        }

        function checkAnswer(selectedIndex, correctAnswerIndex, modal) {
            const correctBtn = document.getElementById(`option-${correctAnswerIndex}`);
            const clickedBtn = document.getElementById(`option-${selectedIndex}`);
            
            // ØªÙ„ÙˆÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„Ù…Ù†Ø¹ Ø§Ù„Ù†Ù‚Ø± Ù…Ø¬Ø¯Ø¯Ø§Ù‹
            document.querySelectorAll('.option-button').forEach(btn => btn.onclick = null);

            // 1. Ù…Ø¤Ø«Ø± Ø¨ØµØ±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø®ØªØ§Ø±
            if (selectedIndex === correctAnswerIndex) {
                clickedBtn.style.backgroundColor = '#27ae60'; // Ø£Ø®Ø¶Ø± Ø¬Ù…ÙŠÙ„ Ù„Ù„Ù†Ø¬Ø§Ø­
            } else {
                clickedBtn.style.backgroundColor = '#e74c3c'; // Ø£Ø­Ù…Ø± Ù„Ù„Ø¬ÙŠØ¨ Ø§Ù„Ø®Ø§Ø·Ø¦
                correctBtn.style.backgroundColor = '#27ae60'; // ØªØ³Ù„ÙŠØ· Ø§Ù„Ø¶ÙˆØ¡ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
            }
            
            // 2. Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ù‚ØµÙŠØ±Ø©
            setTimeout(() => {
                modal.style.display = 'none';
                game.scene.scenes[0].physics.resume();
                
                // Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒØªÙ„Ø© (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙÙ‚Ø·)
                questionBlock.canBeHit = true; 
                
            }, 2000); 
        }
    </script>
</body>
</html>
