<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù‚Ø·Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© (Ù…Ù„Ù ÙˆØ§Ø­Ø¯)</title>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden; 
            background-color: #f0f0f0;
            font-family: 'Arial', sans-serif;
        }
        
        #gameContainer {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        canvas {
            display: block;
        }
        
        /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø«Ø§Ø¨Øª */
        #questionBox {
            position: fixed; 
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px 0;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.75); 
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 1000; 
        }
        
        #questionText {
            margin: 0 0 15px 0;
            font-size: 1.5em;
        }
        
        #choicesContainer {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 0 10px;
        }
        
        .choiceBtn {
            background-color: #4CAF50; 
            color: white;
            border: 3px solid #2e7d32;
            border-radius: 12px;
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            flex: 1; 
            max-width: 250px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .choiceBtn:hover {
            background-color: #66bb6a;
        }
        
        .choiceBtn:active {
            transform: scale(0.98);
        }
        
        /* ÙÙŠØ¯Ø¨Ø§Ùƒ Ø¨ØµØ±ÙŠ Ù„Ù„Ø®Ø·Ø£ */
        .error-feedback {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(255, 0, 0, 0.4); 
            z-index: 2000;
            pointer-events: none; 
            opacity: 1;
            transition: opacity 0.2s ease-out;
        }
        .error-feedback.hidden {
            opacity: 0;
        }
    </style>

    <script src="//cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.js"></script>
</head>
<body>

    <div id="questionBox">
        <h2 id="questionText"></h2>
        <div id="choicesContainer">
            <button class="choiceBtn" data-choice-index="0"></button>
            <button class="choiceBtn" data-choice-index="1"></button>
            <button class="choiceBtn" data-choice-index="2"></button>
        </div>
    </div>

    <div id="gameContainer"></div>

    <script>
        // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ ÙÙˆÙ„Ø¯Ø± assets Ø¨Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: 
        // cat.png, platform.png, correct.mp3, wrong.mp3
        
        // --- 1. Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª (JSON) ---
        const QUESTIONS = [
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ø£ÙƒØ¨Ø± Ø­ÙŠÙˆØ§Ù† Ø¹Ù„Ù‰ ÙˆØ¬Ù‡ Ø§Ù„Ø£Ø±Ø¶ØŸ",
                choices: ["Ø§Ù„ÙÙŠÙ„", "Ø§Ù„Ø­ÙˆØª Ø§Ù„Ø£Ø²Ø±Ù‚", "Ø§Ù„Ø²Ø±Ø§ÙØ©"],
                correctIndex: 1
            },
            {
                question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙˆØ§ÙƒØ¨ ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹ØªÙ†Ø§ Ø§Ù„Ø´Ù…Ø³ÙŠØ©ØŸ",
                choices: ["ØªØ³Ø¹Ø©", "Ø«Ù…Ø§Ù†ÙŠØ©", "Ø¹Ø´Ø±Ø©"],
                correctIndex: 1
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ù„ÙˆÙ† Ø§Ù„Ø³Ù…Ø§Ø¡ ÙÙŠ ÙŠÙˆÙ… Ù…Ø´Ù…Ø³ØŸ",
                choices: ["Ø£Ø®Ø¶Ø±", "Ø£Ø²Ø±Ù‚", "Ø£Ø­Ù…Ø±"],
                correctIndex: 1
            },
            {
                question: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©ØŸ",
                choices: ["Ø¬Ø¯Ø©", "Ù…ÙƒØ©", "Ø§Ù„Ø±ÙŠØ§Ø¶"],
                correctIndex: 2
            }
        ];
        
        // --- 2. Ø«ÙˆØ§Ø¨Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ---
        const PLATFORM_SCALE_X = 0.2; 
        const PLATFORM_SCALE_Y = 0.05; 
        const CAT_JUMP_HEIGHT = 150; 
        const CAT_MOVE_DURATION = 800; 
        const GRAVITY_Y = 0; 
        
        // --- 3. Ù…ØªØºÙŠØ±Ø§Øª Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ---
        let cat;
        let platforms;
        let currentPlatformIndex = 0;
        let isMoving = false;
        let correctSound;
        let wrongSound;
        
        // --- 4. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Phaser ---
        const config = {
            type: Phaser.AUTO,
            parent: 'gameContainer', 
            width: window.innerWidth,
            height: window.innerHeight,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: GRAVITY_Y },
                    debug: false 
                }
            },
            scale: {
                mode: Phaser.Scale.RESIZE, 
                autoCenter: Phaser.Scale.CENTER_BOTH
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };
        
        const game = new Phaser.Game(config);
        
        // --- 5. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Preload) ---
        function preload ()
        {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆÙ„ (Assets) - ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù…Ù„ÙØ§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ ÙÙˆÙ„Ø¯Ø± assets
            this.load.image('cat', 'assets/cat.png');
            this.load.image('platform', 'assets/platform.png');
            this.load.audio('correct', 'assets/correct.mp3');
            this.load.audio('wrong', 'assets/wrong.mp3');
        }
        
        // --- 6. Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ (Create) ---
        function create ()
        {
            // Ø­ÙØ¸ Ø§Ù„Ø£ØµÙˆØ§Øª
            correctSound = this.sound.add('correct');
            wrongSound = this.sound.add('wrong');
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ù†ØµØ§Øª
            platforms = this.physics.add.staticGroup();
        
            // Ù…ÙˆØ§Ù‚Ø¹ Ø£ÙˆÙ„ÙŠØ© Ù„Ù„Ù…Ù†ØµØ§Øª (4 Ù…Ù†ØµØ§Øª)
            const platformPositions = [
                { x: this.scale.width * 0.2, y: this.scale.height * 0.75 },
                { x: this.scale.width * 0.75, y: this.scale.height * 0.55 },
                { x: this.scale.width * 0.25, y: this.scale.height * 0.35 },
                { x: this.scale.width * 0.65, y: this.scale.height * 0.15 }
            ];
        
            // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù†ØµØ§Øª
            platformPositions.forEach(pos => {
                const platform = platforms.create(pos.x, pos.y, 'platform');
                platform.setScale(PLATFORM_SCALE_X, PLATFORM_SCALE_Y).refreshBody();
            });
        
            // Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø®ØµÙŠØ© Ø§Ù„Ù‚Ø·Ø© (Ø§Ù„Ù„Ø§Ø¹Ø¨)
            const startPlatform = platforms.getChildren()[0];
            cat = this.physics.add.sprite(startPlatform.x, startPlatform.y - startPlatform.displayHeight/2, 'cat').setOrigin(0.5, 1);
            cat.setCollideWorldBounds(true);
            this.physics.add.collider(cat, platforms);
        
            // Ø­Ø±ÙƒØ© Ø±Ø£Ø³ Ø§Ù„Ù‚Ø·Ø© Ø§Ù„Ø®ÙÙŠÙØ© Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø©
            this.tweens.add({
                targets: cat,
                y: cat.y - 5, 
                duration: 800,
                yoyo: true, 
                repeat: -1 
            });
        
            // Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            setupQuestionListeners();
            // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„
            if (QUESTIONS.length > 0) {
                displayQuestion(QUESTIONS[0]);
            }
        }
        
        // --- 7. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« (Update) ---
        function update ()
        {
            // Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø´ÙŠØ¡ Ù‡Ù†Ø§ Ø­Ø§Ù„ÙŠÙ‹Ø§ Ù„Ø£Ù† Ø§Ù„Ø­Ø±ÙƒØ© ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù€ Tweens
        }
        
        // --- 8. Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ù†ØµØ§Øª (Cat Movement) ---
        function moveCatToPlatform(scene, targetPlatformIndex) {
            if (isMoving || targetPlatformIndex < 0 || targetPlatformIndex >= platforms.getLength()) return;
        
            isMoving = true;
            const targetPlatform = platforms.getChildren()[targetPlatformIndex];
            const targetX = targetPlatform.x;
            const targetY = targetPlatform.y - targetPlatform.displayHeight/2; 
        
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ø±Ø£Ø³ Ø§Ù„Ù‚Ø·Ø© Ù…Ø¤Ù‚ØªØ§Ù‹
            scene.tweens.killTweensOf(cat);
        
            // 1. Ø§Ù„Ù‚ÙØ²Ø© Ø§Ù„Ø±Ø£Ø³ÙŠØ© (ØµØ¹ÙˆØ¯)
            scene.tweens.add({
                targets: cat,
                y: targetY - CAT_JUMP_HEIGHT, 
                duration: CAT_MOVE_DURATION / 2,
                ease: 'Sine.easeOut', 
                onComplete: () => {
                    // 2. Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø£ÙÙ‚ÙŠØ© ÙˆØ§Ù„Ù†Ø²ÙˆÙ„
                    scene.tweens.add({
                        targets: cat,
                        x: targetX,
                        y: targetY,
                        duration: CAT_MOVE_DURATION / 2,
                        ease: 'Sine.easeIn', 
                        onComplete: () => {
                            // 3. Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø­Ø±ÙƒØ©
                            currentPlatformIndex = targetPlatformIndex;
                            isMoving = false;
                            
                            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø­Ø±ÙƒØ© Ø§Ù„Ø±Ø£Ø³ Ø§Ù„Ø®ÙÙŠÙØ©
                            scene.tweens.add({
                                targets: cat,
                                y: cat.y - 5,
                                duration: 800,
                                yoyo: true,
                                repeat: -1
                            });
        
                            // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
                            const nextQuestionIndex = currentPlatformIndex;
                            if (nextQuestionIndex < QUESTIONS.length) {
                                displayQuestion(QUESTIONS[nextQuestionIndex]);
                            } else {
                                // ØªÙ‡Ù†Ø¦Ø© Ø§Ù„ÙÙˆØ² Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø¢Ø®Ø± Ø³Ø¤Ø§Ù„ ÙˆÙ…Ù†ØµØ©
                                document.getElementById('questionText').textContent = "ğŸ‰ Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©! ğŸ‰";
                                document.getElementById('choicesContainer').innerHTML = ""; 
                            }
                        }
                    });
                }
            });
        }
        
        // --- 9. Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ (HTML UI) ---
        function displayQuestion(q) {
            document.getElementById('questionText').textContent = q.question;
            const choiceButtons = document.querySelectorAll('.choiceBtn');
            const scene = game.scene.scenes[0]; // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø´Ù‡Ø¯ Phaser
            
            choiceButtons.forEach((btn, index) => {
                btn.textContent = q.choices[index];
                btn.onclick = () => checkAnswer(scene, index, q.correctIndex);
                btn.disabled = false; // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            });
        }
        
        // --- 10. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (Answer Check) ---
        function checkAnswer(scene, selectedIndex, correctIndex) {
            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø±ØªÙŠÙ†
            document.querySelectorAll('.choiceBtn').forEach(btn => btn.disabled = true);
        
            if (selectedIndex === correctIndex) {
                // Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
                correctSound.play();
                
                // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ§Ù„ÙŠØ©
                const nextIndex = currentPlatformIndex + 1;
                if (nextIndex < platforms.getLength()) {
                    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø·Ø§Ù„Ù…Ø§ Ù‡Ù†Ø§Ùƒ Ù…Ù†ØµØ§Øª
                    moveCatToPlatform(scene, nextIndex);
                } else {
                    // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ù†ØµØ§Øª Ø£Ø®Ø±Ù‰ØŒ ÙˆÙ„ÙƒÙ† Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø³Ø¤Ø§Ù„ Ù†Ù‡Ø§Ø¦ÙŠ
                    // ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø©ØŒ Ø³Ù†Ø¹ØªØ¨Ø± Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ø®ÙŠØ± Ù‡Ùˆ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
                    document.getElementById('questionText').textContent = "ğŸ‰ Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©! ğŸ‰";
                    document.getElementById('choicesContainer').innerHTML = "";
                }

            } else {
                // Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©
                wrongSound.play();
                
                // * Ù…ØªØ·Ù„Ø¨: ÙÙŠØ¯Ø¨Ø§Ùƒ Ø¨ØµØ±ÙŠ Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø±
                showErrorFeedback(() => {
                    // Ø§Ù„ØªØ­Ø±Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„Ø£ÙˆÙ„Ù‰)
                    const prevIndex = currentPlatformIndex - 1;
                    if (prevIndex >= 0) {
                        moveCatToPlatform(scene, prevIndex);
                    } else {
                        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ØŒ Ù†Ø¹ÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙ‚Ø· Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                        document.querySelectorAll('.choiceBtn').forEach(btn => btn.disabled = false);
                    }
                });
            }
        }
        
        // --- 11. Ø¥Ø¸Ù‡Ø§Ø± ÙÙŠØ¯Ø¨Ø§Ùƒ Ø§Ù„Ø®Ø·Ø£ (Visual Feedback) ---
        function showErrorFeedback(callback) {
            const errorDiv = document.createElement('div');
            errorDiv.classList.add('error-feedback');
            document.body.appendChild(errorDiv);
        
            // Ø¥Ø¸Ù‡Ø§Ø±Ù‡
            setTimeout(() => {
                // Ø¥Ø®ÙØ§Ø¤Ù‡
                errorDiv.classList.add('hidden');
                setTimeout(() => {
                    document.body.removeChild(errorDiv);
                    if (callback) callback();
                }, 300); // Ù…Ø¯Ø© Ø§Ø®ØªÙØ§Ø¡ Ø§Ù„ÙÙŠØ¯Ø¨Ø§Ùƒ
            }, 400); // Ù…Ø¯Ø© Ø¸Ù‡ÙˆØ± Ø§Ù„ÙÙŠØ¯Ø¨Ø§Ùƒ
        }
        
        // --- 12. Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Initial Setup) ---
        function setupQuestionListeners() {
            // Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ù„Ù„ØªÙ†Ø¸ÙŠÙ…ØŒ Ù„ÙƒÙ† ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù€ onclick ÙŠØªÙ… Ø¯Ø§Ø®Ù„ displayQuestion Ù„Ø¶Ù…Ø§Ù† Ø§Ø±ØªØ¨Ø§Ø·Ù‡Ø§ Ø¨Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ.
        }
    </script>
</body>
</html>
