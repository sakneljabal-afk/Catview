<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù‚Ø·Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    <style>
        /* ğŸ¨ 2. CSS Ø§Ù„ØªØµÙ…ÙŠÙ… */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden; 
            font-family: 'Arial', sans-serif;
            direction: rtl; 
            background-color: #add8e6; 
        }

        #game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø³Ø¤Ø§Ù„ HTML (#questionBox) */
        #questionBox {
            position: fixed; 
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000; 
            background-color: rgba(0, 0, 0, 0.8); 
            color: white;
            padding: 15px;
            box-sizing: border-box;
            text-align: center;
            display: none; 
        }

        #questionBox h3 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: clamp(1.2em, 3vw, 1.5em); 
            line-height: 1.4;
        }

        .options-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; 
            gap: 10px;
        }

        .option-button {
            background-color: #3f88c5; 
            color: white;
            border: 3px solid #285f8f;
            border-radius: 10px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: clamp(1em, 2.5vw, 1.2em);
            transition: background-color 0.3s, transform 0.1s;
            flex-grow: 1;
            max-width: 250px;
        }

        .option-button:hover {
            background-color: #5599d1;
            transform: scale(1.03); 
        }

        .option-button:active {
            transform: scale(0.98);
        }

        /* Ø§Ù„ÙÙŠØ¯Ø¨Ø§Ùƒ Ø§Ù„Ø®Ø§Ø·Ø¦ Ø§Ù„Ø£Ø­Ù…Ø± */
        #wrongFeedback {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(255, 0, 0, 0); 
            z-index: 999; 
            pointer-events: none;
            transition: background-color 0.1s; 
        }
    </style>
</head>
<body>

    <div id="wrongFeedback"></div>

    <div id="questionBox">
        </div>

    <div id="game-container"></div>

    <script>
        // ğŸ’¾ 7. Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© - Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        const QUESTIONS = [
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„ÙƒÙˆÙƒØ¨ Ø§Ù„Ø°ÙŠ ÙŠØ³Ù…Ù‰ 'Ø§Ù„ÙƒÙˆÙƒØ¨ Ø§Ù„Ø£Ø­Ù…Ø±'ØŸ",
                options: ["Ø§Ù„Ø²Ù‡Ø±Ø©", "Ø§Ù„Ù…Ø±ÙŠØ®", "Ø§Ù„Ù…Ø´ØªØ±ÙŠ"],
                correctAnswer: "Ø§Ù„Ù…Ø±ÙŠØ®"
            },
            {
                question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£Ø±Ø¬Ù„ Ø§Ù„Ù‚Ø·Ø·ØŸ",
                options: ["Ø§Ø«Ù†ÙŠÙ†", "Ø£Ø±Ø¨Ø¹Ø©", "Ø³ØªØ©"],
                correctAnswer: "Ø£Ø±Ø¨Ø¹Ø©"
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ø£ÙƒØ¨Ø± Ù…Ø­ÙŠØ· ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ",
                options: ["Ø§Ù„Ø£Ø·Ù„Ø³ÙŠ", "Ø§Ù„Ù‡Ù†Ø¯ÙŠ", "Ø§Ù„Ù‡Ø§Ø¯Ø¦"],
                correctAnswer: "Ø§Ù„Ù‡Ø§Ø¯Ø¦"
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø«Ù„Ø§Ø«Ø© Ø£Ø¶Ù„Ø§Ø¹ØŸ",
                options: ["Ø§Ù„Ù…Ø±Ø¨Ø¹", "Ø§Ù„Ù…Ø«Ù„Ø«", "Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©"],
                correctAnswer: "Ø§Ù„Ù…Ø«Ù„Ø«"
            }
        ];

        // ğŸ–¼ï¸ 4. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        const config = {
            type: Phaser.AUTO,
            width: 800, 
            height: 600, 
            parent: 'game-container',
            scale: {
                mode: Phaser.Scale.FIT,
                autoCenter: Phaser.Scale.CENTER_BOTH
            },
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 }, 
                    debug: false 
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        let game = new Phaser.Game(config);

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø´Ù‡Ø¯
        let cat;
        let platforms;
        let platformPositions;
        let currentPlatformIndex = 0;
        let isMoving = false; 
        let questionBox;
        let wrongFeedbackDiv;
        let correctSound;
        let wrongSound;
        let catBreathingTween; // Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø­Ø±ÙƒØ© Ø§Ù„ØªÙ†ÙØ³

        // ğŸ“¦ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆÙ„ (Preload)
        function preload() {
            this.load.image('cat', 'assets/cat.png'); 
            this.load.image('platform', 'assets/platform.png');
            // ØªØ£ÙƒØ¯ Ø£Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ assets/
            this.load.audio('correct', 'assets/correct.mp3'); 
            this.load.audio('wrong', 'assets/wrong.mp3');
        }

        // ğŸ› ï¸ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ù‡Ø¯ (Create)
        function create() {
            const { width, height } = this.scale;
            questionBox = document.getElementById('questionBox');
            wrongFeedbackDiv = document.getElementById('wrongFeedback');

            correctSound = this.sound.add('correct');
            wrongSound = this.sound.add('wrong');
            
            platforms = this.physics.add.staticGroup();

            // ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ù†ØµØ§Øª (x, y)
            platformPositions = [
                { x: width * 0.2, y: height * 0.8 },
                { x: width * 0.8, y: height * 0.65 },
                { x: width * 0.35, y: height * 0.5 },
                { x: width * 0.65, y: height * 0.35 }
            ];

            platformPositions.forEach(pos => {
                let platform = platforms.create(pos.x, pos.y, 'platform');
                platform.setScale(0.2, 0.05).refreshBody(); 
                platform.setImmovable(true);
            });

            const startPlatform = platforms.getChildren()[0];
            
            cat = this.physics.add.sprite(startPlatform.x, startPlatform.y, 'cat');
            cat.setScale(0.15); 
            cat.body.allowGravity = false; 
            cat.setDepth(1); 
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ø§Ù„Ø¯Ù‚ÙŠÙ‚ Ù„Ù„Ù‚Ø·Ø© ÙÙˆÙ‚ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰
            const startPlatformTopY = startPlatform.y - startPlatform.displayHeight / 2;
            const initialCatY = startPlatformTopY - cat.displayHeight / 2;
            cat.y = initialCatY;

            this.physics.add.collider(cat, platforms, () => {
                cat.setVelocity(0);
                isMoving = false;
            });

            // ØªØ®Ø²ÙŠÙ† Ø­Ø±ÙƒØ© Ø§Ù„ØªÙ†ÙØ³ ÙÙŠ Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯ (catBreathingTween)
            catBreathingTween = this.tweens.add({ 
                targets: cat,
                y: initialCatY - 5, // ØªØªØ­Ø±Ùƒ 5 Ø¨ÙƒØ³Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù…Ù† Ù…ÙˆÙ‚Ø¹Ù‡Ø§ Ø§Ù„Ø£ÙˆÙ„ÙŠ
                duration: 1000,
                yoyo: true, 
                repeat: -1, 
                ease: 'Sine.easeInOut'
            });

            showQuestion(this, 0);
        }

        // ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´Ù‡Ø¯ (Update)
        function update() {
            // Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù…Ù†Ø·Ù‚ Ø®Ø§Øµ Ù‡Ù†Ø§
        }

        // 3. Ø¯Ø§Ù„Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø³Ø¤Ø§Ù„ ÙÙŠ Ù…Ø±Ø¨Ø¹ HTML
        function showQuestion(scene, index) {
            const currentQ = QUESTIONS[index];
            if (!currentQ) {
                questionBox.innerHTML = '<h3>Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­!</h3>';
                questionBox.style.display = 'block';
                return;
            }

            questionBox.style.display = 'block';

            let html = `<h3>${currentQ.question}</h3><div class="options-container">`;
            
            currentQ.options.forEach(option => {
                html += `<button class="option-button" onclick="checkAnswer(this, '${option}', ${index})">${option}</button>`;
            });

            html += `</div>`;
            questionBox.innerHTML = html;
        }

        // 3. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        window.checkAnswer = function(button, selectedAnswer, questionIndex) {
            const currentQ = QUESTIONS[questionIndex];
            const scene = game.scene.getScene('default'); 

            document.querySelectorAll('.option-button').forEach(btn => btn.disabled = true);

            if (selectedAnswer === currentQ.correctAnswer) {
                // Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
                correctSound.play(); 
                questionBox.style.display = 'none'; 
                
                let nextIndex = questionIndex + 1;
                if (nextIndex < platformPositions.length) {
                    currentPlatformIndex = nextIndex;
                    moveCat(scene, nextIndex, true); 
                } else {
                    showQuestion(scene, nextIndex); 
                }

            } else {
                // Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©
                wrongSound.play(); 
                
                // ÙÙŠØ¯Ø¨Ø§Ùƒ Ø¨ØµØ±ÙŠ Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø±
                wrongFeedbackDiv.style.backgroundColor = 'rgba(255, 0, 0, 0.5)';
                scene.time.delayedCall(200, () => {
                    wrongFeedbackDiv.style.backgroundColor = 'rgba(255, 0, 0, 0)';
                    document.querySelectorAll('.option-button').forEach(btn => btn.disabled = false);
                });

                // Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
                if (questionIndex > 0) {
                    let prevIndex = questionIndex - 1;
                    currentPlatformIndex = prevIndex;
                    moveCat(scene, prevIndex, false); 
                    
                    scene.time.delayedCall(1500, () => {
                        showQuestion(scene, prevIndex);
                    });
                } else {
                    document.querySelectorAll('.option-button').forEach(btn => btn.disabled = false);
                }
            }
        }

        // 4. Ø¯Ø§Ù„Ø© Ø­Ø±ÙƒØ© Ø§Ù„Ù‚Ø·Ø© Ø¨ÙŠÙ† Ø§Ù„Ù…Ù†ØµØ§Øª (Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙØ­Ø³Ù‘ÙÙ†)
        function moveCat(scene, targetIndex, isCorrect) {
            if (isMoving) return;
            isMoving = true;

            // ğŸ›‘ Ø¥ÙŠÙ‚Ø§Ù Ø­Ø±ÙƒØ© Ø§Ù„ØªÙ†ÙØ³ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø§Ø®Ù„
            if (catBreathingTween) {
                catBreathingTween.pause();
            }

            const targetPlatform = platforms.getChildren()[targetIndex];
            const startX = cat.x;
            const startY = cat.y;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¯Ù‚ÙŠÙ‚: (Ù‚Ù…Ø© Ø§Ù„Ù…Ù†ØµØ©) - (Ù†ØµÙ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù‚Ø·Ø©)
            const catHeight = cat.displayHeight;
            const platformTopY = targetPlatform.y - targetPlatform.displayHeight / 2;
            const targetY = platformTopY - catHeight / 2; 
            const targetX = targetPlatform.x;
            
            const distance = Phaser.Math.Distance.Between(startX, startY, targetX, targetY);
            const duration = distance * 2.5; 
            
            const jumpHeight = 70; 
            const apexY = Math.min(startY, targetY) - jumpHeight;

            scene.tweens.add({
                targets: cat,
                duration: duration,
                ease: 'Linear', 
                x: targetX,

                onUpdate: (tween, target) => {
                    const progress = tween.progress;
                    const parabolicFactor = 1 - Math.pow(2 * progress - 1, 2); 
                    
                    const linearY = Phaser.Math.Interpolation.Linear([startY, targetY], progress);
                    
                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù‚ÙˆØ³ÙŠ
                    target.y = linearY - (startY - apexY) * parabolicFactor;
                },

                onComplete: () => {
                    // âœ… Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ÙˆÙ‚ÙˆÙ ÙÙˆÙ‚ Ø§Ù„Ù…Ù†ØµØ©
                    cat.x = targetX;
                    cat.y = targetY; 
                    
                    isMoving = false;
                    cat.setVelocity(0); 

                    // âœ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø­Ø±ÙƒØ© Ø§Ù„ØªÙ†ÙØ³ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                    if (catBreathingTween) {
                         // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙ†ÙØ³ Ù„ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                        catBreathingTween.updateTo({ y: targetY - 5 }, true);
                        catBreathingTween.resume(); 
                    }
                    
                    if (isCorrect) {
                        showQuestion(scene, currentPlatformIndex);
                    }
                    if (!isCorrect) {
                        document.querySelectorAll('.option-button').forEach(btn => btn.disabled = false);
                    }
                }
            });
        }
    </script>
</body>
</html>
