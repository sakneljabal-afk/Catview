<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لعبة القطة التعليمية</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>

<style>
body {
    margin: 0;
    overflow: hidden;
    background: #add8e6;
    font-family: Arial;
}

/* صندوق السؤال */
#questionBox {
    position: fixed;
    top: 0;
    width: 100%;
    background: rgba(0,0,0,0.8);
    color: #fff;
    text-align: center;
    padding: 15px;
    display: none;
    z-index: 10;
}

.options-container {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
}

.option-button {
    background: #3f88c5;
    border: none;
    padding: 10px 15px;
    color: white;
    border-radius: 10px;
    font-size: 18px;
    cursor: pointer;
}

/* مؤشر الأخطاء */
#mistakeIndicator {
    position: fixed;
    top: 70px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 28px;
    display: none;
    z-index: 20;
}

/* فلاش خطأ */
#wrongFeedback {
    position: fixed;
    inset: 0;
    background: rgba(255,0,0,0);
    pointer-events: none;
    z-index: 5;
}
</style>
</head>

<body>

<div id="wrongFeedback"></div>
<div id="questionBox"></div>
<div id="mistakeIndicator"></div>
<div id="game-container"></div>

<script>
// ================= البيانات =================
const QUESTIONS = [
 {q:"ما الكوكب الأحمر؟", o:["الزهرة","المريخ","المشتري"], a:"المريخ"},
 {q:"كم عدد أرجل القطة؟", o:["2","4","6"], a:"4"},
 {q:"أكبر محيط؟", o:["الهادئ","الهندي","الأطلسي"], a:"الهادئ"},
 {q:"شكل بثلاثة أضلاع؟", o:["دائرة","مربع","مثلث"], a:"مثلث"},
];

// ================= المتغيرات =================
let cat, platforms;
let currentPlatformIndex = 0;
let currentQuestionIndex = 0;
let mistakeCount = 0;
let isMoving = false;
let breathingTween;

let questionBox = document.getElementById("questionBox");
let indicator = document.getElementById("mistakeIndicator");
let wrongFX = document.getElementById("wrongFeedback");

// ================= إعداد Phaser =================
const game = new Phaser.Game({
 type: Phaser.AUTO,
 width: innerWidth,
 height: innerHeight,
 parent: "game-container",
 physics: { default:"arcade", arcade:{gravity:{y:0}} },
 scene: { preload, create }
});

// ================= تحميل =================
function preload(){
 this.load.image("cat","assets/cat.png");
 this.load.image("platform","assets/platform.png");
}

// ================= إنشاء =================
function create(){
 const w=this.scale.width, h=this.scale.height;

 platforms = this.physics.add.staticGroup();

 QUESTIONS.forEach((_,i)=>{
   let x = w*( i%2?0.7:0.3 );
   let y = h*(0.8 - i*0.13);
   let p = platforms.create(x,y,"platform");
   p.setScale(w/800*0.22, h/600*0.05).refreshBody();
 });

 let first = platforms.getChildren()[0];
 cat = this.physics.add.sprite(first.x, first.y, "cat");
 cat.setScale(w/800*0.18);
 cat.body.allowGravity=false;

 placeCatOnPlatform(0);

 breathingTween = this.tweens.add({
   targets:cat, y:cat.y-6, yoyo:true, repeat:-1, duration:900
 });

 showQuestion();
}

// ================= دوال =================
function placeCatOnPlatform(i){
 let p = platforms.getChildren()[i];
 cat.x = p.x;
 cat.y = p.y - p.displayHeight/2 - cat.displayHeight/2;
}

function updateIndicator(){
 if(mistakeCount==0){
   indicator.style.display="none";
   return;
 }
 indicator.style.display="block";
 indicator.innerHTML = "⛔".repeat(mistakeCount)+"⭐";
}

function showQuestion(){
 let q = QUESTIONS[currentQuestionIndex];
 questionBox.innerHTML = `
  <h3>${q.q}</h3>
  <div class="options-container">
    ${q.o.map(o=>`<button class="option-button" onclick="answer('${o}')">${o}</button>`).join("")}
  </div>`;
 questionBox.style.display="block";
 updateIndicator();
}

window.answer = function(selected){
 let correct = QUESTIONS[currentQuestionIndex].a;
 questionBox.style.display="none";

 if(selected===correct){
   if(mistakeCount>0){
     mistakeCount--;
     currentPlatformIndex++;
   }else{
     currentPlatformIndex++;
     currentQuestionIndex++;
   }
 }else{
   mistakeCount++;
   if(currentPlatformIndex>0) currentPlatformIndex--;
   flashError();
 }

 updateIndicator();
 moveCat();
}

// ================= حركة القطة =================
function moveCat(){
 if(isMoving) return;
 isMoving=true;
 breathingTween.pause();

 let target = platforms.getChildren()[currentPlatformIndex];
 let ty = target.y - target.displayHeight/2 - cat.displayHeight/2;

 game.scene.scenes[0].tweens.add({
   targets: cat,
   x: target.x,
   y: ty,
   duration: 800,
   onComplete:()=>{
     breathingTween.resume();
     isMoving=false;
     setTimeout(showQuestion,500);
   }
 });
}

function flashError(){
 wrongFX.style.background="rgba(255,0,0,0.4)";
 setTimeout(()=>wrongFX.style.background="rgba(255,0,0,0)",300);
}
</script>
</body>
</html>
