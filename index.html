<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù‚Ø·Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    <style>
        /* ğŸ¨ CSS Ø§Ù„ØªØµÙ…ÙŠÙ… */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden; 
            font-family: 'Arial', sans-serif;
            direction: rtl; 
            background-color: #add8e6; 
        }

        #game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø³Ø¤Ø§Ù„ */
        #questionBox {
            position: fixed; 
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000; 
            background-color: rgba(0, 0, 0, 0.8); 
            color: white;
            padding: 15px;
            box-sizing: border-box;
            text-align: center;
            display: none; 
        }

        #questionBox h3 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: clamp(1.2em, 3vw, 1.5em); 
        }

        .options-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; 
            gap: 10px;
        }

        .option-button {
            background-color: #3f88c5; 
            color: white;
            border: 3px solid #285f8f;
            border-radius: 10px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: clamp(1em, 2.5vw, 1.2em);
            transition: background-color 0.3s, transform 0.1s;
            flex-grow: 1;
            max-width: 250px;
        }

        .option-button:hover {
            background-color: #5599d1;
            transform: scale(1.03); 
        }

        .option-button:active {
            transform: scale(0.98);
        }

        /* ÙÙŠØ¯Ø¨Ø§Ùƒ Ø®Ø·Ø£ (Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø±) */
        #wrongFeedback {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(255, 0, 0, 0); 
            z-index: 999; 
            pointer-events: none;
            transition: background-color 0.1s; 
        }
        
        /* Ù…Ø¤Ø´Ø± Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ø¨ØµØ±ÙŠ (â›”) */
        #errorIndicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10em; 
            color: white;
            z-index: 1001; 
            opacity: 0; 
            pointer-events: none;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
            transition: opacity 0.1s;
        }
    </style>
</head>
<body>

    <div id="wrongFeedback"></div>
    <div id="errorIndicator">â›”</div>
    <div id="questionBox"></div>
    <div id="game-container"></div>

<script>
    // ğŸ’¾ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    const QUESTIONS = [
        {question:"Ù…Ø§ Ù‡Ùˆ Ø§Ù„ÙƒÙˆÙƒØ¨ Ø§Ù„Ø°ÙŠ ÙŠØ³Ù…Ù‰ 'Ø§Ù„ÙƒÙˆÙƒØ¨ Ø§Ù„Ø£Ø­Ù…Ø±'ØŸ", options:["Ø§Ù„Ø²Ù‡Ø±Ø©","Ø§Ù„Ù…Ø±ÙŠØ®","Ø§Ù„Ù…Ø´ØªØ±ÙŠ"], correctAnswer:"Ø§Ù„Ù…Ø±ÙŠØ®"},
        {question:"ÙƒÙ… Ø¹Ø¯Ø¯ Ø£Ø±Ø¬Ù„ Ø§Ù„Ù‚Ø·Ø·ØŸ", options:["Ø§Ø«Ù†ÙŠÙ†","Ø£Ø±Ø¨Ø¹Ø©","Ø³ØªØ©"], correctAnswer:"Ø£Ø±Ø¨Ø¹Ø©"},
        {question:"Ù…Ø§ Ù‡Ùˆ Ø£ÙƒØ¨Ø± Ù…Ø­ÙŠØ· ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", options:["Ø§Ù„Ø£Ø·Ù„Ø³ÙŠ","Ø§Ù„Ù‡Ù†Ø¯ÙŠ","Ø§Ù„Ù‡Ø§Ø¯Ø¦"], correctAnswer:"Ø§Ù„Ù‡Ø§Ø¯Ø¦"},
        {question:"Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø«Ù„Ø§Ø«Ø© Ø£Ø¶Ù„Ø§Ø¹ØŸ", options:["Ø§Ù„Ù…Ø±Ø¨Ø¹","Ø§Ù„Ù…Ø«Ù„Ø«","Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©"], correctAnswer:"Ø§Ù„Ù…Ø«Ù„Ø«"}
    ];

    // ğŸ–¼ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
    const config = {
        type: Phaser.AUTO,
        width: window.innerWidth,
        height: window.innerHeight,
        parent: 'game-container',
        scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
        physics: { default:'arcade', arcade:{gravity:{y:0}, debug:false} },
        scene: { preload, create, update }
    };

    let game = new Phaser.Game(config);

    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø¹Ø§Ù…Ø©
    let cat, platforms, platformPositions, currentPlatformIndex=0, isMoving=false;
    let questionBox, wrongFeedbackDiv, errorIndicator;
    let correctSound, wrongSound;
    let catBreathingTween;
    let questionsToReview = []; // Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ÙƒØ±Ø±Ø©
    let currentQuestionIndex = 0; 

    function preload() {
        this.load.image('cat','assets/cat.png');
        this.load.image('platform','assets/platform.png');
        this.load.audio('correct','assets/correct.mp3'); 
        this.load.audio('wrong','assets/wrong.mp3');
    }

    function create() {
        questionBox = document.getElementById('questionBox');
        wrongFeedbackDiv = document.getElementById('wrongFeedback');
        errorIndicator = document.getElementById('errorIndicator');

        correctSound = this.sound.add('correct');
        wrongSound = this.sound.add('wrong');

        platforms = this.physics.add.staticGroup();
        const { width, height } = this.scale;

        const PLATFORM_LOCATIONS_POOL = [
            { x: width*0.2, y: height*0.8 },
            { x: width*0.8, y: height*0.65 },
            { x: width*0.35, y: height*0.5 },
            { x: width*0.65, y: height*0.35 },
            { x: width*0.1, y: height*0.25 },
            { x: width*0.9, y: height*0.4 }
        ];
        
        // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ù†ØµØ§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        platformPositions = PLATFORM_LOCATIONS_POOL.slice(0, QUESTIONS.length); 

        platformPositions.forEach(pos=>{
            let p = platforms.create(pos.x,pos.y,'platform');
            p.setScale(0.2,0.05).refreshBody();
            p.setImmovable(true);
        });

        const startPlatform = platforms.getChildren()[0];
        cat = this.physics.add.sprite(startPlatform.x, startPlatform.y,'cat');
        cat.setScale(0.15);
        cat.body.allowGravity=false;
        cat.setDepth(1);

        const startY = startPlatform.y - startPlatform.displayHeight/2 - cat.displayHeight/2;
        cat.y = startY;

        this.physics.add.collider(cat, platforms, ()=>{cat.setVelocity(0); isMoving=false;});

        catBreathingTween = this.tweens.add({targets:cat, y:startY-5, duration:1000, yoyo:true, repeat:-1, ease:'Sine.easeInOut'});

        showQuestion(0);
    }

    function update(){}

    // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ù„Ø¯Ø¹Ù… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ÙƒØ±Ø±Ø©)
    function showQuestion(index){
        
        // Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…ÙƒØ±Ø±ØŒ ÙˆØ¥Ù„Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ù† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ØµÙ„ÙŠ
        const q = questionsToReview.length > 0 ? questionsToReview[0] : QUESTIONS[index];
        
        if(!q){
            questionBox.innerHTML='<h3>Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø§Ù„Ø¬ÙˆÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­!</h3>';
            questionBox.style.display='block';
            return;
        }

        questionBox.style.display='block';
        currentQuestionIndex = index;

        let html = `<h3>${q.question}</h3><div class="options-container">`;
        q.options.forEach(opt=>{
            html+=`<button class="option-button">${opt}</button>`;
        });
        html+=`</div>`;
        questionBox.innerHTML = html;

        document.querySelectorAll('.option-button').forEach(btn=>{
            btn.onclick = ()=>checkAnswer(btn, btn.textContent, currentQuestionIndex);
        });
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¥ØªÙ‚Ø§Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ)
    function checkAnswer(button, selectedAnswer, originalPlatformIndex){
        
        const isReviewing = questionsToReview.length > 0;
        const currentQ = isReviewing ? questionsToReview[0] : QUESTIONS[originalPlatformIndex];
        const scene = game.scene.getScene('default');

        document.querySelectorAll('.option-button').forEach(btn=>btn.disabled=true);

        if(selectedAnswer===currentQ.correctAnswer){
            // âœ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
            correctSound.play();
            questionBox.style.display='none';
            
            if(isReviewing){
                // 1. Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
                questionsToReview.shift();
                
                // 2. Ø¥Ø°Ø§ Ù„Ù… ÙŠØªØ¨Ù‚ Ø£Ø³Ø¦Ù„Ø© Ù…Ø±Ø§Ø¬Ø¹Ø©ØŒ Ù†ØªÙ‚Ø¯Ù…
                if(questionsToReview.length === 0){
                    let nextIndex = originalPlatformIndex + 1;
                    if(nextIndex < platformPositions.length){
                        currentPlatformIndex = nextIndex;
                        moveCat(scene, nextIndex, true); 
                    } else { showQuestion(nextIndex); }
                    return;
                }
                
                // 3. Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£Ø³Ø¦Ù„Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ø®Ø±Ù‰ØŒ Ù†Ø¨Ù‚Ù‰ ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† ÙˆÙ†Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
                 scene.time.delayedCall(1500, ()=>{
                    document.querySelectorAll('.option-button').forEach(btn=>btn.disabled=false);
                    showQuestion(originalPlatformIndex); 
                });
                return;

            } else {
                // Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ§Ù„ÙŠØ©
                let nextIndex = originalPlatformIndex + 1;
                if(nextIndex<platformPositions.length){
                    currentPlatformIndex=nextIndex;
                    moveCat(scene,nextIndex,true);
                } else { showQuestion(nextIndex); }
            }

        } else {
            // âŒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©
            wrongSound.play();
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ ÙˆØ§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø±
            wrongFeedbackDiv.style.backgroundColor='rgba(255,0,0,0.5)';
            errorIndicator.style.opacity = 1;
            
            scene.time.delayedCall(400, ()=>{
                wrongFeedbackDiv.style.backgroundColor='rgba(255,0,0,0)';
                errorIndicator.style.opacity = 0;
            });

            // 1. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø®Ø§Ø·Ø¦ Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„)
            if (!isReviewing) {
                 questionsToReview.push(currentQ);
            }

            // 2. Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…Ù†ØµØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            if(originalPlatformIndex > 0){
                let prevIndex = originalPlatformIndex - 1;
                currentPlatformIndex = prevIndex;
                
                moveCat(scene, prevIndex, false);
                
                // 3. Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…ÙƒØ±Ø± (Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„ØªÙˆ) Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
                scene.time.delayedCall(1500, ()=>{
                    document.querySelectorAll('.option-button').forEach(btn=>btn.disabled=false);
                    showQuestion(prevIndex); 
                });
                
            } else {
                // Ø§Ù„Ø®Ø·Ø£ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø­ØªÙ‰ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
                document.querySelectorAll('.option-button').forEach(btn=>btn.disabled=false);
            }
        }
    }

    // Ø¯Ø§Ù„Ø© Ø­Ø±ÙƒØ© Ø§Ù„Ù‚Ø·Ø©
    function moveCat(scene,targetIndex,isCorrect){
        if(isMoving) return;
        isMoving=true;

        if(catBreathingTween) catBreathingTween.pause();

        const targetPlatform = platforms.getChildren()[targetIndex];
        const startX = cat.x;
        const startY = cat.y;
        const targetX = targetPlatform.x;
        const targetY = targetPlatform.y - targetPlatform.displayHeight/2 - cat.displayHeight/2;

        const distance = Phaser.Math.Distance.Between(startX,startY,targetX,targetY);
        const duration = distance*3;

        const apexY = Math.min(startY,targetY)-70;

        scene.tweens.add({
            targets: cat,
            duration: duration,
            ease: 'Linear',
            x: targetX,
            onUpdate: (tween,target)=>{
                const progress=tween.progress;
                const factor=1-Math.pow(2*progress-1,2);
                const linearY=Phaser.Math.Interpolation.Linear([startY,targetY],progress);
                target.y=linearY-(startY-apexY)*factor;
            },
            onComplete: ()=>{
                cat.x=targetX;
                cat.y=targetY;
                isMoving=false;
                cat.setVelocity(0);

                if(catBreathingTween){
                    catBreathingTween.remove();
                    catBreathingTween = scene.tweens.add({targets:cat,y:targetY-5,duration:1000,yoyo:true,repeat:-1,ease:'Sine.easeInOut'});
                }

                if(isCorrect) showQuestion(currentPlatformIndex);
                if(!isCorrect) document.querySelectorAll('.option-button').forEach(btn=>btn.disabled=false);
            }
        });
    }
</script>
</body>
</html>
