<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„Ø¹Ø¨Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© - Phaser + Supabase</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<style>
Â  body { margin:0; background:#ccf2ff; overflow:hidden; }
Â  #questionBox {Â 
Â  Â  position:absolute; top:10px; width:100%; text-align:center;Â 
Â  Â  font-family:'Arial',sans-serif; font-size:20px; color:#000;Â 
Â  Â  background: rgba(255,255,255,0.9); padding:15px 0; z-index:1000;Â 
Â  Â  border-radius: 10px;
Â  }
Â  .option {Â 
Â  Â  margin:5px; padding:8px 15px; border:2px solid #000;Â 
Â  Â  display:inline-block; cursor:pointer; background:#fff;
Â  Â  border-radius: 8px; transition: background 0.2s;
Â  }
Â  .option:hover { background:#f0f0f0; }
</style>
</head>
<body>
<div id="questionBox"></div>
<script>
// =======================================================
// ** ğŸš¨ Ù‡Ø§Ù…: Ù‚Ù… Ø¨ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ù…ÙØ§ØªÙŠØ­ Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ğŸš¨ **
// =======================================================
const SUPABASE_URL = 'https://zjacblvmrhmakxynffay.supabase.co'; 
const SUPABASE_ANON_KEY = 'sb_publishable_7Uk7Kd1xhmb7HCxla38F_g_DXVEsg9V'; 

// *Ø§Ù„Ø­Ù„:* ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… window.supabase ÙˆØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¥Ù„Ù‰ supabaseClient
const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
// =======================================================

// Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
let questions = []; 
let currentQuestion=0, currentPlatformIndex=0;
const PLATFORM_SCALE_X = 0.2;
const PLATFORM_SCALE_Y = 0.05;

const config = {
Â  type: Phaser.CANVAS,
Â  width:600, height:600,
Â  physics:{ default:'arcade', arcade:{ gravity:{y:600}, debug:true } },
Â  scene:{ preload, create, update }
};

const game = new Phaser.Game(config);
let player, platforms, sceneRef, redOverlay, correctSound, wrongSound;

function preload() {
Â  this.load.image('player','assets/cat.png');Â 
Â  this.load.image('platform','assets/platform.png');Â 
Â  this.load.audio('correct','assets/correct.mp3');
Â  this.load.audio('wrong','assets/wrong.mp3');
}

function create() {
Â  sceneRef = this;
Â  platforms = this.physics.add.staticGroup();

Â  const positions = [
Â  Â  {x:300, y:500}, {x:200, y:400}, {x:400, y:300}, {x:250, y:200}
Â  ];

Â  positions.forEach(pos=>{
Â  Â  const plat = platforms.create(pos.x, pos.y, 'platform');
Â  Â  plat.setScale(PLATFORM_SCALE_X, PLATFORM_SCALE_Y).refreshBody();
Â  });
Â  
Â  const firstPlatform = platforms.getChildren()[0];
Â  player = this.physics.add.sprite(firstPlatform.x, firstPlatform.y - firstPlatform.displayHeight/2 - 20,'player').setScale(0.2);
Â  player.setCollideWorldBounds(true);
Â  this.physics.add.collider(player, platforms);

Â  redOverlay = this.add.rectangle(300,300,600,600,0xff0000,0);
Â  redOverlay.setDepth(1000);

Â  correctSound = this.sound.add('correct');
Â  wrongSound = this.sound.add('wrong');

Â  // Ø§Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ù‡Ø¯
Â  getQuestionsFromSupabase(); 
}

// Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Supabase
async function getQuestionsFromSupabase() {
    document.getElementById("questionBox").innerHTML = "<h2>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©... Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h2>";
    
    let { data, error } = await supabaseClient // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ø¯Ù„
        .from('questions')
        .select('text, options, answer_index'); 

    if (error) {
        console.error('Error fetching questions:', error);
        document.getElementById("questionBox").innerHTML = "<h2>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ÙˆÙ‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù† (RLS).</h2>";
        return;
    }

    if (data && data.length > 0) {
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (q, c, a)
        questions = data.map(q => ({
            q: q.text,
            c: q.options, 
            a: q.answer_index,
        }));
        
        console.log(`Successfully loaded ${questions.length} questions.`);
        
        // Ø¨Ù…Ø¬Ø±Ø¯ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø§Ø¨Ø¯Ø£ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„
        showQuestion(); 
    } else {
         document.getElementById("questionBox").innerHTML = "<h2>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</h2>";
    }
}


function showQuestion(){
Â  if(currentQuestion>=questions.length){
Â  Â  document.getElementById("questionBox").innerHTML="<h2>Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª!</h2>";
Â  Â  return;
Â  }
Â  const q = questions[currentQuestion];
Â  const box = document.getElementById("questionBox");
Â  let html = `<h2>${q.q}</h2>`;
Â  q.c.forEach((opt,i)=>{
Â  Â  html += `<div class="option" onclick="answer(${i})">${opt}</div>`;
Â  });
Â  box.innerHTML = html;
}

function answer(selected){
Â  if(currentQuestion>=questions.length) return;
Â  const q = questions[currentQuestion];
Â  
Â  if (sceneRef.tweens.isTweening(player)) return; 

Â  if(selected===q.a){
Â  Â  currentPlatformIndex = Math.min(currentPlatformIndex+1, platforms.getChildren().length-1);
Â  Â  currentQuestion++;
Â  Â  correctSound.play();
Â  } else {
Â  Â  if(currentPlatformIndex>0) currentPlatformIndex--;
Â  Â  
Â  Â  redOverlay.alpha = 0.5;
Â  Â  sceneRef.tweens.add({
Â  Â  Â  targets:redOverlay,
Â  Â  Â  alpha:0,
Â  Â  Â  duration:300
Â  Â  });
Â  Â  wrongSound.play();
Â  }
Â  movePlayerToPlatform(currentPlatformIndex);
Â  setTimeout(showQuestion,500); 
}

function movePlayerToPlatform(index){
Â  const target = platforms.getChildren()[index];
Â  const startY = player.y;
Â  const endX = target.x;
Â  const endY = target.y - target.displayHeight/2 - player.displayHeight/2;
Â  const peak = Math.min(startY, endY) - 70; 
Â  
Â  player.body.setAllowGravity(false);
Â  player.body.setVelocity(0, 0); 
Â  
Â  sceneRef.tweens.timeline({
Â  Â  targets:player,
Â  Â  ease:'Power1',
Â  Â  tweens:[
Â  Â  Â  { y:peak, duration:200 }, 
Â  Â  Â  { x:endX, duration:400 }, 
Â  Â  Â  { 
Â  Â  Â  Â  y:endY, 
Â  Â  Â  Â  duration:200,
Â  Â  Â  Â  onComplete: () => {
Â  Â  Â  Â  Â  player.body.setAllowGravity(true);
Â  Â  Â  Â  }
Â  Â  Â  }Â  
Â  Â  ]
Â  });
}

function update(){}
</script>
</body>
</html>

