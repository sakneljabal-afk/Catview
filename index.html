<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>لعبة تعليمية - Phaser</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
<style>
  body { margin:0; background:#ccf2ff; overflow:hidden; }
  #questionBox { 
    position:absolute; top:10px; width:100%; text-align:center; 
    font-family:'Arial',sans-serif; font-size:20px; color:#000; 
    background: rgba(255,255,255,0.9); padding:15px 0; z-index:1000; 
    border-radius: 10px;
  }
  .option { 
    margin:5px; padding:8px 15px; border:2px solid #000; 
    display:inline-block; cursor:pointer; background:#fff;
    border-radius: 8px; transition: background 0.2s;
  }
  .option:hover { background:#f0f0f0; }
</style>
</head>
<body>
<div id="questionBox"></div>
<script>
const questions = [
  { q:"ما لون السماء؟", c:["أحمر","أزرق","أصفر"], a:1 },
  { q:"كم عدد أرجل القط؟", c:["2","4","6"], a:1 },
  { q:"هل الشمس نجمة؟", c:["نعم","لا","ممكن"], a:0 },
  { q:"أين تشرق الشمس؟", c:["الجنوب","الشرق","الغرب"], a:1 },
];

let currentQuestion=0, currentPlatformIndex=0;

const PLATFORM_SCALE_X = 0.2;
const PLATFORM_SCALE_Y = 0.05;

const config = {
  type: Phaser.CANVAS,
  width:600, height:600,
  physics:{ default:'arcade', arcade:{ gravity:{y:0}, debug:false } }, // جاذبية صفر
  scene:{ preload, create, update }
};

const game = new Phaser.Game(config);
let player, platforms, sceneRef, redOverlay;

function preload() {
  this.load.image('player','assets/cat.png'); 
  this.load.image('platform','assets/platform.png'); 
}

function create() {
  sceneRef = this;
  platforms = this.add.group();

  const positions = [
    {x:300, y:500}, {x:200, y:400}, {x:400, y:300}, {x:250, y:200}
  ];

  positions.forEach(pos=>{
    const plat = this.add.image(pos.x,pos.y,'platform');
    plat.setScale(PLATFORM_SCALE_X, PLATFORM_SCALE_Y);
    platforms.add(plat);
  });

  // وضع القطة على أول منصة
  const firstPlatform = platforms.getChildren()[0];
  player = this.add.sprite(firstPlatform.x, firstPlatform.y - firstPlatform.displayHeight/2 - 20,'player').setScale(0.2);

  // حركة رأس القطة خفيفة
  this.tweens.add({
    targets:player,
    y:player.y-5,
    duration:500,
    yoyo:true,
    repeat:-1
  });

  // overlay أحمر للفيدباك
  redOverlay = this.add.rectangle(300,300,600,600,0xff0000,0);
  redOverlay.setDepth(1000);

  showQuestion();
}

function showQuestion(){
  if(currentQuestion>=questions.length){
    document.getElementById("questionBox").innerHTML="<h2>أحسنت! لقد أنهيت جميع التحديات!</h2>";
    return;
  }
  const q = questions[currentQuestion];
  const box = document.getElementById("questionBox");
  let html = `<h2>${q.q}</h2>`;
  q.c.forEach((opt,i)=>{
    html += `<div class="option" onclick="answer(${i})">${opt}</div>`;
  });
  box.innerHTML = html;
}

function answer(selected){
  if(currentQuestion>=questions.length) return;
  const q = questions[currentQuestion];
  if(selected===q.a){
    currentPlatformIndex = Math.min(currentPlatformIndex+1, platforms.getChildren().length-1);
    currentQuestion++;
  } else {
    if(currentPlatformIndex>0) currentPlatformIndex--;
    // فيدباك أحمر عند الخطأ
    redOverlay.alpha = 0.5;
    sceneRef.tweens.add({
      targets:redOverlay,
      alpha:0,
      duration:300
    });
  }
  movePlayerToPlatform(currentPlatformIndex);
  setTimeout(showQuestion,400);
}

function movePlayerToPlatform(index){
  const target = platforms.getChildren()[index];
  const targetX = target.x;
  const targetY = target.y - target.displayHeight/2 - player.displayHeight/2;

  sceneRef.tweens.add({
    targets:player,
    x:targetX,
    y:targetY,
    duration:400,
    ease:'Power1'
  });
}

function update(){}
</script>
</body>
</html>
